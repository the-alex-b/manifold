class Ps{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(r);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let a=0,c=s.length;a<c;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class vr extends Ps{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Rh extends Ps{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new vr(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Br(){return Br=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Br.apply(this,arguments)}function xs(t){return t instanceof vr}function $r(t){return Array.isArray(t)&&t[0]instanceof vr}function Pr(t){return!!(Ah(t)&&bh(t)instanceof vr)}function bh(t){for(const e in t)return t[e]}function Ah(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const we=Symbol("attributes"),dr=Symbol("immutableKeys");class ks extends Ps{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[we]=void 0,this[dr]=void 0,this.graph=e,this[dr]=new Set,this[we]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof ks){const a=this.graph.createEdge(n,this,s);a.addEventListener("dispose",()=>s.dispose()),this[dr].add(n),r[n]=a}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[we]){const s=this[we][n];if(xs(s)){const a=s;a.getChild()===e&&this.setRef(n,r,a.getAttributes())}else if($r(s)){const c=s.find(f=>f.getChild()===e);if(c){const f=c.getAttributes();this.removeRef(n,e).addRef(n,r,f)}}else if(Pr(s)){const a=s;for(const c in a){const f=a[c];f.getChild()===e&&this.setRefMap(n,c,r,f.getAttributes())}}}return this}get(e){return this[we][e]}set(e,r){return this[we][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[we][e];return r?r.getChild():null}setRef(e,r,n){if(this[dr].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[we][e];if(s&&s.dispose(),!r)return this;const a=this.graph.createEdge(e,this,r,n);return a.addEventListener("dispose",()=>{delete this[we][e],this.dispatchEvent({type:"change",attribute:e})}),this[we][e]=a,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[we][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),a=this[we][e];return a.push(s),s.addEventListener("dispose",()=>{let c;for(;(c=a.indexOf(s))!==-1;)a.splice(c,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[we][e].filter(a=>a.getChild()===r).forEach(a=>a.dispose()),this}listRefMapKeys(e){return Object.keys(this[we][e])}listRefMapValues(e){return Object.values(this[we][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[we][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const a=this[we][e],c=a[r];if(c&&c.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const f=this.graph.createEdge(e,this,n,Br({},s,{key:r}));return f.addEventListener("dispose",()=>{delete a[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),a[r]=f,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(Br({},e,{target:this})),this.graph.dispatchEvent(Br({},e,{target:this,type:`node:${e.type}`})),this}}const Oa="v3.8.0",yr="@glb.bin";var X,In,rt,ht,Qt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(X||(X={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(In||(In={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(rt||(rt={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(ht||(ht={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Qt||(Qt={}));const Sn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var vn,Ts=typeof Float32Array<"u"?Float32Array:Array;function us(t){return Math.hypot(t[0],t[1],t[2])}function Ih(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/(c=c||1),t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function Sh(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===X.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const a=s.getMesh();if(!a)return;const c=Ch(a,s.getWorldMatrix());Es(c.min,e),Es(c.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),vn=new Ts(3),Ts!=Float32Array&&(vn[0]=0,vn[1]=0,vn[2]=0);function Ch(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let a=[0,0,0],c=[0,0,0];for(let f=0;f<s.getCount();f++)a=s.getElement(f,a),c=Ih(c,a,e),Es(c,r)}return r}function Es(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class oe{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const a of e)r+=a.byteLength;const n=new Uint8Array(r);let s=0;for(const a of e)n.set(a,s),s+=a.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let a=e.byteLength;a<n;a++)s[a]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Ze=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,a]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*a<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.04045?.0773993808*n[a]:Math.pow(.9478672986*n[a]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.0031308?12.92*n[a]:1.055*Math.pow(n[a],.41666)-.055;return r}},Fa=class Da{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return oe.decodeText(e.slice(12,16))===Da.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};Fa.PNG_FRIED_CHUNK_NAME="CgBI";let yt=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function Nh(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}yt.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),Nh(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Fa};let xr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return yt.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function ta(t){return Object.prototype.toString.call(t)==="[object Object]"}function Jt(t){if(ta(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return ta(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var hs,ws;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(ws||(ws={}));let er=class kr{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=kr.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=kr.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=kr.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=kr.Verbosity.ERROR&&console.error(e)}};function Oh(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=e[9],M=e[10],A=e[11],N=e[12],m=e[13],S=e[14],T=e[15],_=r[0],b=r[1],O=r[2],P=r[3];return t[0]=_*n+b*f+O*x+P*N,t[1]=_*s+b*h+O*w+P*m,t[2]=_*a+b*d+O*M+P*S,t[3]=_*c+b*g+O*A+P*T,t[4]=(_=r[4])*n+(b=r[5])*f+(O=r[6])*x+(P=r[7])*N,t[5]=_*s+b*h+O*w+P*m,t[6]=_*a+b*d+O*M+P*S,t[7]=_*c+b*g+O*A+P*T,t[8]=(_=r[8])*n+(b=r[9])*f+(O=r[10])*x+(P=r[11])*N,t[9]=_*s+b*h+O*w+P*m,t[10]=_*a+b*d+O*M+P*S,t[11]=_*c+b*g+O*A+P*T,t[12]=(_=r[12])*n+(b=r[13])*f+(O=r[14])*x+(P=r[15])*N,t[13]=_*s+b*h+O*w+P*m,t[14]=_*a+b*d+O*M+P*S,t[15]=_*c+b*g+O*A+P*T,t}hs=er,er.Verbosity=ws,er.DEFAULT_INSTANCE=new hs(hs.Verbosity.INFO);let Ne=class Ms{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return Ms.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return Ms.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let a=us([e[0],e[1],e[2]]);const c=us([e[4],e[5],e[6]]),f=us([e[8],e[9],e[10]]);var h,d,g,x,w,M,A,N,m,S,T,_,b,O,P,V,B;((d=(h=e)[0])*(A=h[5])-(g=h[1])*(M=h[4]))*((_=h[10])*(B=h[15])-(b=h[11])*(V=h[14]))-(d*(N=h[6])-(x=h[2])*M)*((T=h[9])*B-b*(P=h[13]))+(d*(m=h[7])-(w=h[3])*M)*(T*V-_*P)+(g*N-x*A)*((S=h[8])*B-b*(O=h[12]))-(g*m-w*A)*(S*V-_*O)+(x*m-w*N)*(S*P-T*O)<0&&(a=-a),r[0]=e[12],r[1]=e[13],r[2]=e[14];const k=e.slice(),G=1/a,H=1/c,K=1/f;k[0]*=G,k[1]*=G,k[2]*=G,k[4]*=H,k[5]*=H,k[6]*=H,k[8]*=K,k[9]*=K,k[10]*=K,function(L,U){var ee=new Ts(3);(function(Ot,He){var xt=He[4],Ve=He[5],Ft=He[6],Zr=He[8],ir=He[9],Tt=He[10];Ot[0]=Math.hypot(He[0],He[1],He[2]),Ot[1]=Math.hypot(xt,Ve,Ft),Ot[2]=Math.hypot(Zr,ir,Tt)})(ee,U);var fe=1/ee[0],ie=1/ee[1],ge=1/ee[2],ve=U[0]*fe,xe=U[1]*ie,Te=U[2]*ge,Re=U[4]*fe,Ue=U[5]*ie,Ae=U[6]*ge,Ce=U[8]*fe,et=U[9]*ie,ot=U[10]*ge,Je=ve+Ue+ot,Me=0;Je>0?(Me=2*Math.sqrt(Je+1),L[3]=.25*Me,L[0]=(Ae-et)/Me,L[1]=(Ce-Te)/Me,L[2]=(xe-Re)/Me):ve>Ue&&ve>ot?(Me=2*Math.sqrt(1+ve-Ue-ot),L[3]=(Ae-et)/Me,L[0]=.25*Me,L[1]=(xe+Re)/Me,L[2]=(Ce+Te)/Me):Ue>ot?(Me=2*Math.sqrt(1+Ue-ve-ot),L[3]=(Ce-Te)/Me,L[0]=(xe+Re)/Me,L[1]=.25*Me,L[2]=(Ae+et)/Me):(Me=2*Math.sqrt(1+ot-ve-Ue),L[3]=(xe-Re)/Me,L[0]=(Ce+Te)/Me,L[1]=(Ae+et)/Me,L[2]=.25*Me)}(n,k),s[0]=a,s[1]=c,s[2]=f}static compose(e,r,n,s){const a=s,c=r[0],f=r[1],h=r[2],d=r[3],g=c+c,x=f+f,w=h+h,M=c*g,A=c*x,N=c*w,m=f*x,S=f*w,T=h*w,_=d*g,b=d*x,O=d*w,P=n[0],V=n[1],B=n[2];return a[0]=(1-(m+T))*P,a[1]=(A+O)*P,a[2]=(N-b)*P,a[3]=0,a[4]=(A-O)*V,a[5]=(1-(M+T))*V,a[6]=(S+_)*V,a[7]=0,a[8]=(N+b)*B,a[9]=(S-_)*B,a[10]=(1-(M+m))*B,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}};function Fh(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Dh(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function $h(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const a=t[s],c=e[s];if(!!a!=!!c)return!1;const f=a.getChild(),h=c.getChild();if(f!==h&&!f.equals(h))return!1}return!0}function $a(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Pa(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!Jt(t)||!Jt(e))return t===e;const r=t,n=e;let s,a=0,c=0;for(s in r)a++;for(s in n)c++;if(a!==c)return!1;for(s in r){const f=r[s],h=n[s];if(Cn(f)&&Cn(h)){if(!$a(f,h))return!1}else if(Jt(f)&&Jt(h)){if(!Pa(f,h))return!1}else if(f!==h)return!1}return!0}function Cn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const ra=new Set,Ph=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},kh=function(){for(let t=0;t<999;t++){const e=Ph();if(!ra.has(e))return ra.add(e),e}return""},na="https://null.example";let Vr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return xr.basename(new URL(e,na).pathname)}static extension(e){return xr.extension(new URL(e,na).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let a=0;a<s.length;a++)s[a]!=="."&&(s[a]===".."?n.pop():n.push(s[a]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};Vr.DEFAULT_INIT={},Vr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const It=t=>t,Uh=new Set;let Us=class extends ks{constructor(e,r=""){super(e),this[we].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,It)}copy(e,r=It){for(const n in this[we]){const s=this[we][n];if(s instanceof vr)this[dr].has(n)||s.dispose();else if($r(s))for(const a of s)a.dispose();else if(Pr(s))for(const a in s)s[a].dispose()}for(const n in e[we]){const s=this[we][n],a=e[we][n];if(a instanceof vr)this[dr].has(n)?s.getChild().copy(r(a.getChild()),r):this.setRef(n,r(a.getChild()),a.getAttributes());else if($r(a))for(const c of a)this.addRef(n,r(c.getChild()),c.getAttributes());else if(Pr(a))for(const c in a){const f=a[c];this.setRefMap(n,c,r(f.getChild()),f.getAttributes())}else this[we][n]=Jt(a)?JSON.parse(JSON.stringify(a)):Array.isArray(a)||a instanceof ArrayBuffer||ArrayBuffer.isView(a)?a.slice():a}return this}equals(e,r=Uh){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[we]){if(r.has(n))continue;const s=this[we][n],a=e[we][n];if(xs(s)||xs(a)){if(!Fh(s,a))return!1}else if($r(s)||$r(a)){if(!Dh(s,a))return!1}else if(Pr(s)||Pr(a)){if(!$h(s,a))return!1}else if(Jt(s)||Jt(a)){if(!Pa(s,a))return!1}else if(Cn(s)||Cn(a)){if(!$a(s,a))return!1}else if(s!==a)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Ke=class extends Us{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},te=class Ie extends Ke{constructor(...e){super(...e),this.i=Ne.identity,this.o=Ne.identity}init(){this.propertyType=X.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Ie.Type.SCALAR,componentType:Ie.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=It){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Ie.Type.SCALAR:return 1;case Ie.Type.VEC2:return 2;case Ie.Type.VEC3:return 3;case Ie.Type.VEC4:case Ie.Type.MAT2:return 4;case Ie.Type.MAT3:return 9;case Ie.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Ie.ComponentType.BYTE:case Ie.ComponentType.UNSIGNED_BYTE:return 1;case Ie.ComponentType.SHORT:case Ie.ComponentType.UNSIGNED_SHORT:return 2;case Ie.ComponentType.UNSIGNED_INT:case Ie.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.min(e[c],f))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=-1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.max(e[c],f))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Ie.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>Ne.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>Ne.encodeNormalizedInt(r,this.get("componentType"))):(this.o=Ne.identity,this.i=Ne.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)r[a]=this.o(s[e*n+a]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)s[e*n+a]=this.i(r[a]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return Ie.ComponentType.FLOAT;case Uint32Array:return Ie.ComponentType.UNSIGNED_INT;case Uint16Array:return Ie.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Ie.ComponentType.UNSIGNED_BYTE;case Int16Array:return Ie.ComponentType.SHORT;case Int8Array:return Ie.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Ie.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};te.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},te.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let ka=class extends Ke{init(){this.propertyType=X.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},Ls=class extends Ke{init(){this.propertyType=X.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};Ls.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let jn=class Ua extends Ke{init(){this.propertyType=X.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Ua.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:rt.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:rt.OTHER})}};jn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let La=class extends Ke{init(){this.propertyType=X.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Jr=class ja extends Ke{init(){this.propertyType=X.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ja.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Jr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let $e=class extends Us{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};$e.EXTENSION_NAME=void 0;let Oe=class _s extends Ke{init(){this.propertyType=X.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:_s.WrapMode.REPEAT,wrapT:_s.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Oe.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Oe.MagFilter={NEAREST:9728,LINEAR:9729},Oe.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:yn,G:xn,B:Tn,A:Lh}=ht;let Tr=class Ba extends Ke{init(){this.propertyType=X.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ba.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Oe(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Oe(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Oe(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Oe(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Oe(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ze.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ze.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:yn|xn|Tn|Lh,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ze.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ze.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:yn|xn|Tn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:yn|xn|Tn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:yn})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:xn|Tn})}};Tr.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let Va=class extends Ke{init(){this.propertyType=X.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},za=class extends Ke{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=X.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=It){if(r===It)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ne.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Ne.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Ne.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)Oh(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===X.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Wr=class Ga extends Ke{init(){this.propertyType=X.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Ga.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:rt.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:rt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Wr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let jh=class extends Us{init(){this.propertyType=X.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:rt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function Ye(){return Ye=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ye.apply(this,arguments)}let Ha=class extends Ke{init(){this.propertyType=X.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=It){if(r===It)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},qa=class extends Ke{init(){this.propertyType=X.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:rt.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},Wa=class extends Ke{init(){this.propertyType=X.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||yt.extensionToMimeType(xr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=yt.extensionToMimeType(xr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",oe.assertView(e))}getSize(){const e=this.get("image");return e?yt.getSize(e,this.getMimeType()):null}},Xa=class extends Ke{init(){this.propertyType=X.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Oa}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=It){if(r===It)throw new Error("Root cannot be copied.");this.set("asset",Ye({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ye({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof Ha?this.addRef("scenes",e):e instanceof za?this.addRef("nodes",e):e instanceof Jr?this.addRef("cameras",e):e instanceof qa?this.addRef("skins",e):e instanceof Va?this.addRef("meshes",e):e instanceof Tr?this.addRef("materials",e):e instanceof Wa?this.addRef("textures",e):e instanceof ka?this.addRef("animations",e):e instanceof te?this.addRef("accessors",e):e instanceof La&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},js=class Mn{static fromGraph(e){return Mn.v.get(e)||null}constructor(){this.T=new Rh,this.S=new Xa(this.T),this.M=er.DEFAULT_INSTANCE,Mn.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Mn().setLogger(this.M).merge(this)}merge(e){for(const a of e.getRoot().listExtensionsUsed()){const c=this.createExtension(a.constructor);a.isRequired()&&c.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const a of e.T.listEdges())for(const c of[a.getParent(),a.getChild()]){if(r.has(c))continue;let f;f=c.propertyType===X.TEXTURE_INFO?c:new c.constructor(this.T),n.set(c,f),r.add(c)}const s=a=>{const c=n.get(a);if(!c)throw new Error("Could resolve property.");return c};for(const a of r){const c=n.get(a);if(!c)throw new Error("Could resolve property.");c.propertyType!==X.TEXTURE_INFO&&c.copy(a,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new Ha(this.T,e)}createNode(e=""){return new za(this.T,e)}createCamera(e=""){return new Jr(this.T,e)}createSkin(e=""){return new qa(this.T,e)}createMesh(e=""){return new Va(this.T,e)}createPrimitive(){return new Wr(this.T)}createPrimitiveTarget(e=""){return new jh(this.T,e)}createMaterial(e=""){return new Tr(this.T,e)}createTexture(e=""){return new Wa(this.T,e)}createAnimation(e=""){return new ka(this.T,e)}createAnimationChannel(e=""){return new Ls(this.T,e)}createAnimationSampler(e=""){return new jn(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new te(this.T,e).setBuffer(r)}createBuffer(e=""){return new La(this.T,e)}};js.v=new WeakMap;let Se=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,a=s.target;a instanceof $e&&a.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(a),s.type==="node:dispose"&&this.O(a))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};Se.EXTENSION_NAME=void 0;let Bh=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const sa={logger:er.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Vh=class{static read(e,r=sa){const n=Ye({},sa,r),{json:s}=e,a=new js().setLogger(n.logger);this.validate(e,n);const c=new Bh(e),f=s.asset,h=a.getRoot().getAsset();f.copyright&&(h.copyright=f.copyright),f.extras&&(h.extras=f.extras),s.extras!==void 0&&a.getRoot().setExtras(Ye({},s.extras));const d=s.extensionsUsed||[],g=s.extensionsRequired||[];for(const T of n.extensions)if(d.includes(T.EXTENSION_NAME)){const _=a.createExtension(T).setRequired(g.includes(T.EXTENSION_NAME));for(const b of _.readDependencies)_.install(b,n.dependencies[b])}const x=s.buffers||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(X.BUFFER)).forEach(T=>T.preread(c,X.BUFFER)),c.buffers=x.map(T=>{const _=a.createBuffer(T.name);return T.extras&&_.setExtras(T.extras),T.uri&&T.uri.indexOf("__")!==0&&_.setURI(T.uri),_}),c.bufferViewBuffers=(s.bufferViews||[]).map((T,_)=>{if(!c.bufferViews[_]){const b=e.json.buffers[T.buffer];c.bufferViews[_]=oe.toView(b.uri?e.resources[b.uri]:e.resources[yr],T.byteOffset||0,T.byteLength)}return c.buffers[T.buffer]});const w=s.accessors||[];c.accessors=w.map(T=>{const _=a.createAccessor(T.name,c.bufferViewBuffers[T.bufferView]).setType(T.type);return T.extras&&_.setExtras(T.extras),T.normalized!==void 0&&_.setNormalized(T.normalized),T.bufferView===void 0||_.setArray(En(T,c)),_});const M=s.images||[],A=s.textures||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(X.TEXTURE)).forEach(T=>T.preread(c,X.TEXTURE)),c.textures=M.map(T=>{const _=a.createTexture(T.name);if(T.extras&&_.setExtras(T.extras),T.bufferView!==void 0){const b=s.bufferViews[T.bufferView],O=e.json.buffers[b.buffer],P=b.byteOffset||0,V=(O.uri?e.resources[O.uri]:e.resources[yr]).slice(P,P+b.byteLength);_.setImage(V)}else T.uri!==void 0&&(_.setImage(e.resources[T.uri]),T.uri.indexOf("__")!==0&&_.setURI(T.uri));if(T.mimeType!==void 0)_.setMimeType(T.mimeType);else if(T.uri){const b=xr.extension(T.uri);_.setMimeType(yt.extensionToMimeType(b))}return _}),c.materials=(s.materials||[]).map(T=>{const _=a.createMaterial(T.name);T.extras&&_.setExtras(T.extras),T.alphaMode!==void 0&&_.setAlphaMode(T.alphaMode),T.alphaCutoff!==void 0&&_.setAlphaCutoff(T.alphaCutoff),T.doubleSided!==void 0&&_.setDoubleSided(T.doubleSided);const b=T.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&_.setBaseColorFactor(b.baseColorFactor),T.emissiveFactor!==void 0&&_.setEmissiveFactor(T.emissiveFactor),b.metallicFactor!==void 0&&_.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&_.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const O=b.baseColorTexture;_.setBaseColorTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getBaseColorTextureInfo(),O)}if(T.emissiveTexture!==void 0){const O=T.emissiveTexture;_.setEmissiveTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getEmissiveTextureInfo(),O)}if(T.normalTexture!==void 0){const O=T.normalTexture;_.setNormalTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getNormalTextureInfo(),O),T.normalTexture.scale!==void 0&&_.setNormalScale(T.normalTexture.scale)}if(T.occlusionTexture!==void 0){const O=T.occlusionTexture;_.setOcclusionTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getOcclusionTextureInfo(),O),T.occlusionTexture.strength!==void 0&&_.setOcclusionStrength(T.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const O=b.metallicRoughnessTexture;_.setMetallicRoughnessTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getMetallicRoughnessTextureInfo(),O)}return _});const N=s.meshes||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(X.PRIMITIVE)).forEach(T=>T.preread(c,X.PRIMITIVE)),c.meshes=N.map(T=>{const _=a.createMesh(T.name);return T.extras&&_.setExtras(T.extras),T.weights!==void 0&&_.setWeights(T.weights),(T.primitives||[]).forEach(b=>{const O=a.createPrimitive();b.extras&&O.setExtras(b.extras),b.material!==void 0&&O.setMaterial(c.materials[b.material]),b.mode!==void 0&&O.setMode(b.mode);for(const[V,B]of Object.entries(b.attributes||{}))O.setAttribute(V,c.accessors[B]);b.indices!==void 0&&O.setIndices(c.accessors[b.indices]);const P=T.extras&&T.extras.targetNames||[];(b.targets||[]).forEach((V,B)=>{const k=P[B]||B.toString(),G=a.createPrimitiveTarget(k);for(const[H,K]of Object.entries(V))G.setAttribute(H,c.accessors[K]);O.addTarget(G)}),_.addPrimitive(O)}),_}),c.cameras=(s.cameras||[]).map(T=>{const _=a.createCamera(T.name).setType(T.type);if(T.extras&&_.setExtras(T.extras),T.type===Jr.Type.PERSPECTIVE){const b=T.perspective;_.setYFov(b.yfov),_.setZNear(b.znear),b.zfar!==void 0&&_.setZFar(b.zfar),b.aspectRatio!==void 0&&_.setAspectRatio(b.aspectRatio)}else{const b=T.orthographic;_.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return _});const m=s.nodes||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(X.NODE)).forEach(T=>T.preread(c,X.NODE)),c.nodes=m.map(T=>{const _=a.createNode(T.name);if(T.extras&&_.setExtras(T.extras),T.translation!==void 0&&_.setTranslation(T.translation),T.rotation!==void 0&&_.setRotation(T.rotation),T.scale!==void 0&&_.setScale(T.scale),T.matrix!==void 0){const b=[0,0,0],O=[0,0,0,1],P=[1,1,1];Ne.decompose(T.matrix,b,O,P),_.setTranslation(b),_.setRotation(O),_.setScale(P)}return T.weights!==void 0&&_.setWeights(T.weights),_}),c.skins=(s.skins||[]).map(T=>{const _=a.createSkin(T.name);T.extras&&_.setExtras(T.extras),T.inverseBindMatrices!==void 0&&_.setInverseBindMatrices(c.accessors[T.inverseBindMatrices]),T.skeleton!==void 0&&_.setSkeleton(c.nodes[T.skeleton]);for(const b of T.joints)_.addJoint(c.nodes[b]);return _}),m.map((T,_)=>{const b=c.nodes[_];(T.children||[]).forEach(O=>b.addChild(c.nodes[O])),T.mesh!==void 0&&b.setMesh(c.meshes[T.mesh]),T.camera!==void 0&&b.setCamera(c.cameras[T.camera]),T.skin!==void 0&&b.setSkin(c.skins[T.skin])}),c.animations=(s.animations||[]).map(T=>{const _=a.createAnimation(T.name);T.extras&&_.setExtras(T.extras);const b=(T.samplers||[]).map(O=>{const P=a.createAnimationSampler().setInput(c.accessors[O.input]).setOutput(c.accessors[O.output]).setInterpolation(O.interpolation||jn.Interpolation.LINEAR);return O.extras&&P.setExtras(O.extras),_.addSampler(P),P});return(T.channels||[]).forEach(O=>{const P=a.createAnimationChannel().setSampler(b[O.sampler]).setTargetPath(O.target.path);O.target.node!==void 0&&P.setTargetNode(c.nodes[O.target.node]),O.extras&&P.setExtras(O.extras),_.addChannel(P)}),_});const S=s.scenes||[];return a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(X.SCENE)).forEach(T=>T.preread(c,X.SCENE)),c.scenes=S.map(T=>{const _=a.createScene(T.name);return T.extras&&_.setExtras(T.extras),(T.nodes||[]).map(b=>c.nodes[b]).forEach(b=>_.addChild(b)),_}),s.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[s.scene]),a.getRoot().listExtensionsUsed().forEach(T=>T.read(c)),w.forEach((T,_)=>{const b=c.accessors[_],O=!!T.sparse,P=!T.bufferView&&!b.getArray();(O||P)&&b.setSparse(!0).setArray(function(V,B){const k=Sn[V.componentType],G=te.getElementSize(V.type);let H;H=V.bufferView!==void 0?En(V,B):new k(V.count*G);const K=V.sparse;if(!K)return H;const L=K.count,U=Ye({},V,K.indices,{count:L,type:"SCALAR"}),ee=Ye({},V,K.values,{count:L}),fe=En(U,B),ie=En(ee,B);for(let ge=0;ge<U.count;ge++)for(let ve=0;ve<G;ve++)H[fe[ge]*G+ve]=ie[ge*G+ve];return H}(T,c))}),a}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(a=>a.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(a=>a.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function En(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=Sn[t.componentType],a=te.getElementSize(t.type),c=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==a*c)return function(h,d){const g=d.bufferViews[h.bufferView],x=d.jsonDoc.json.bufferViews[h.bufferView],w=Sn[h.componentType],M=te.getElementSize(h.type),A=w.BYTES_PER_ELEMENT,N=h.byteOffset||0,m=new w(h.count*M),S=new DataView(g.buffer,g.byteOffset,g.byteLength),T=x.byteStride;for(let _=0;_<h.count;_++)for(let b=0;b<M;b++){const O=N+_*T+b*A;let P;switch(h.componentType){case te.ComponentType.FLOAT:P=S.getFloat32(O,!0);break;case te.ComponentType.UNSIGNED_INT:P=S.getUint32(O,!0);break;case te.ComponentType.UNSIGNED_SHORT:P=S.getUint16(O,!0);break;case te.ComponentType.UNSIGNED_BYTE:P=S.getUint8(O);break;case te.ComponentType.SHORT:P=S.getInt16(O,!0);break;case te.ComponentType.BYTE:P=S.getInt8(O);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}m[_*M+b]=P}return m}(t,e);const f=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(f,f+t.count*a*c))}var zr;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(zr||(zr={}));let ut=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),a=s.listBuffers().length,c=s.listTextures().length;this.bufferURIGenerator=new ia(a>1,()=>n.basename||"buffer"),this.imageURIGenerator=new ia(c>1,f=>function(h,d){const g=h.getGraph().listParentEdges(d).find(x=>x.getParent()!==h.getRoot());return g?g.getName().replace(/texture$/i,""):""}(e,f)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const a={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},c=JSON.stringify(a);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(a));const f={index:this.textureDefIndexMap.get(c)};return r.getTexCoord()!==0&&(f.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(f.extras=r.getExtras()),this.textureInfoDefMap.set(r,f),f}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Qt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=yt.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return rt.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==X.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return rt.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};ut.BufferViewTarget=zr,ut.BufferViewUsage=rt,ut.USAGE_TO_TARGET={[rt.ARRAY_BUFFER]:zr.ARRAY_BUFFER,[rt.ELEMENT_ARRAY_BUFFER]:zr.ELEMENT_ARRAY_BUFFER};let ia=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:wn}=ut,{UNSIGNED_INT:zh,UNSIGNED_SHORT:Gh,UNSIGNED_BYTE:Hh}=te.ComponentType;let qh=class{static write(e,r){const n=e.getRoot(),s={asset:Ye({generator:`glTF-Transform ${Oa}`},n.getAsset()),extras:Ye({},n.getExtras())},a={json:s,resources:{}},c=new ut(e,a,r),f=r.logger||er.DEFAULT_INSTANCE,h=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),d=e.getRoot().listExtensionsUsed().filter(m=>h.has(m.extensionName)),g=e.getRoot().listExtensionsRequired().filter(m=>h.has(m.extensionName));d.length<e.getRoot().listExtensionsUsed().length&&f.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of d)for(const S of m.writeDependencies)m.install(S,r.dependencies[S]);function x(m,S,T,_){const b=[];let O=0;for(const V of m){const B=c.createAccessorDef(V);B.bufferView=s.bufferViews.length;const k=V.getArray(),G=oe.pad(oe.toView(k));B.byteOffset=O,O+=G.byteLength,b.push(G),c.accessorIndexMap.set(V,s.accessors.length),s.accessors.push(B)}const P={buffer:S,byteOffset:T,byteLength:oe.concat(b).byteLength};return _&&(P.target=_),s.bufferViews.push(P),{buffers:b,byteLength:O}}function w(m,S,T){const _=m[0].getCount();let b=0;for(const B of m){const k=c.createAccessorDef(B);k.bufferView=s.bufferViews.length,k.byteOffset=b;const G=B.getElementSize(),H=B.getComponentSize();b+=oe.padNumber(G*H),c.accessorIndexMap.set(B,s.accessors.length),s.accessors.push(k)}const O=_*b,P=new ArrayBuffer(O),V=new DataView(P);for(let B=0;B<_;B++){let k=0;for(const G of m){const H=G.getElementSize(),K=G.getComponentSize(),L=G.getComponentType(),U=G.getArray();for(let ee=0;ee<H;ee++){const fe=B*b+k+ee*K,ie=U[B*H+ee];switch(L){case te.ComponentType.FLOAT:V.setFloat32(fe,ie,!0);break;case te.ComponentType.BYTE:V.setInt8(fe,ie);break;case te.ComponentType.SHORT:V.setInt16(fe,ie,!0);break;case te.ComponentType.UNSIGNED_BYTE:V.setUint8(fe,ie);break;case te.ComponentType.UNSIGNED_SHORT:V.setUint16(fe,ie,!0);break;case te.ComponentType.UNSIGNED_INT:V.setUint32(fe,ie,!0);break;default:throw new Error("Unexpected component type: "+L)}}k+=oe.padNumber(H*K)}}return s.bufferViews.push({buffer:S,byteOffset:T,byteLength:O,byteStride:b,target:ut.BufferViewTarget.ARRAY_BUFFER}),{byteLength:O,buffers:[new Uint8Array(P)]}}function M(m,S,T){const _=[];let b=0;const O=new Map;let P=-1/0;for(const L of m){const U=c.createAccessorDef(L);s.accessors.push(U),c.accessorIndexMap.set(L,s.accessors.length-1);const ee=[],fe=[],ie=[],ge=new Array(L.getElementSize()).fill(0);for(let Re=0,Ue=L.getCount();Re<Ue;Re++)if(L.getElement(Re,ie),!Ne.eq(ie,ge,0)){P=Math.max(Re,P),ee.push(Re);for(let Ae=0;Ae<ie.length;Ae++)fe.push(ie[Ae])}const ve=ee.length,xe={accessorDef:U,count:ve};if(O.set(L,xe),ve===0)continue;if(ve>L.getCount()/3){const Re=(100*ee.length/L.getCount()).toFixed(1);f.warn(`Sparse accessor with many non-zero elements (${Re}%) may increase file size.`)}const Te=Sn[L.getComponentType()];xe.indices=ee,xe.values=new Te(fe)}if(!Number.isFinite(P))return{buffers:_,byteLength:b};const V=P<255?Uint8Array:P<65535?Uint16Array:Uint32Array,B=P<255?Hh:P<65535?Gh:zh,k={buffer:S,byteOffset:T+b,byteLength:0};for(const L of m){const U=O.get(L);if(U.count===0)continue;U.indicesByteOffset=k.byteLength;const ee=oe.pad(oe.toView(new V(U.indices)));_.push(ee),b+=ee.byteLength,k.byteLength+=ee.byteLength}s.bufferViews.push(k);const G=s.bufferViews.length-1,H={buffer:S,byteOffset:T+b,byteLength:0};for(const L of m){const U=O.get(L);if(U.count===0)continue;U.valuesByteOffset=H.byteLength;const ee=oe.pad(oe.toView(U.values));_.push(ee),b+=ee.byteLength,H.byteLength+=ee.byteLength}s.bufferViews.push(H);const K=s.bufferViews.length-1;for(const L of m){const U=O.get(L);U.count!==0&&(U.accessorDef.sparse={count:U.count,indices:{bufferView:G,byteOffset:U.indicesByteOffset,componentType:B},values:{bufferView:K,byteOffset:U.valuesByteOffset}})}return{buffers:_,byteLength:b}}const A=new Map;for(const m of e.getGraph().listEdges()){if(m.getParent()===n)continue;const S=m.getChild();if(S instanceof te){const T=A.get(S)||[];T.push(m),A.set(S,T)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((m,S)=>{const T=c.createPropertyDef(m);m.getMimeType()&&(T.mimeType=m.getMimeType());const _=m.getImage();return _&&c.createImageData(T,_,m),c.imageIndexMap.set(m,S),T}),d.filter(m=>m.prewriteTypes.includes(X.ACCESSOR)).forEach(m=>m.prewrite(c,X.ACCESSOR)),n.listAccessors().forEach(m=>{const S=c.accessorUsageGroupedByParent,T=c.accessorParents;if(c.accessorIndexMap.has(m))return;const _=A.get(m)||[],b=c.getAccessorUsage(m);if(c.addAccessorToUsageGroup(m,b),S.has(b)){const O=_[0].getParent(),P=T.get(O)||new Set;P.add(m),T.set(O,P)}}),d.filter(m=>m.prewriteTypes.includes(X.BUFFER)).forEach(m=>m.prewrite(c,X.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||c.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((m,S)=>{const T=c.createPropertyDef(m),_=c.accessorUsageGroupedByParent,b=c.accessorParents,O=m.listParents().filter(H=>H instanceof te),P=new Set(O),V=[],B=s.buffers.length;let k=0;const G=c.listAccessorUsageGroups();for(const H in G)if(_.has(H))for(const K of Array.from(b.values())){const L=Array.from(K).filter(U=>P.has(U)).filter(U=>c.getAccessorUsage(U)===H);if(L.length)if(H!==wn.ARRAY_BUFFER||r.vertexLayout===In.INTERLEAVED){const U=H===wn.ARRAY_BUFFER?w(L,B,k):x(L,B,k);k+=U.byteLength,V.push(...U.buffers)}else for(const U of L){const ee=w([U],B,k);k+=ee.byteLength,V.push(...ee.buffers)}}else{const K=G[H].filter(ee=>P.has(ee));if(!K.length)continue;const L=H===wn.ELEMENT_ARRAY_BUFFER?ut.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,U=H===wn.SPARSE?M(K,B,k):x(K,B,k,L);k+=U.byteLength,V.push(...U.buffers)}if(c.imageBufferViews.length&&S===0){for(let H=0;H<c.imageBufferViews.length;H++)if(s.bufferViews[s.images[H].bufferView].byteOffset=k,k+=c.imageBufferViews[H].byteLength,V.push(c.imageBufferViews[H]),k%8){const K=8-k%8;k+=K,V.push(new Uint8Array(K))}}if(c.otherBufferViews.has(m))for(const H of c.otherBufferViews.get(m))s.bufferViews.push({buffer:B,byteOffset:k,byteLength:H.byteLength}),c.otherBufferViewsIndexMap.set(H,s.bufferViews.length-1),k+=H.byteLength,V.push(H);if(k){let H;r.format===Qt.GLB?H=yr:(H=c.bufferURIGenerator.createURI(m,"bin"),T.uri=H),T.byteLength=k,a.resources[H]=oe.concat(V)}s.buffers.push(T),c.bufferIndexMap.set(m,S)}),n.listAccessors().find(m=>!m.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((m,S)=>{const T=c.createPropertyDef(m);if(m.getAlphaMode()!==Tr.AlphaMode.OPAQUE&&(T.alphaMode=m.getAlphaMode()),m.getAlphaMode()===Tr.AlphaMode.MASK&&(T.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(T.doubleSided=!0),T.pbrMetallicRoughness={},Ne.eq(m.getBaseColorFactor(),[1,1,1,1])||(T.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Ne.eq(m.getEmissiveFactor(),[0,0,0])||(T.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(T.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(T.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const _=m.getBaseColorTexture(),b=m.getBaseColorTextureInfo();T.pbrMetallicRoughness.baseColorTexture=c.createTextureInfoDef(_,b)}if(m.getEmissiveTexture()){const _=m.getEmissiveTexture(),b=m.getEmissiveTextureInfo();T.emissiveTexture=c.createTextureInfoDef(_,b)}if(m.getNormalTexture()){const _=m.getNormalTexture(),b=m.getNormalTextureInfo(),O=c.createTextureInfoDef(_,b);m.getNormalScale()!==1&&(O.scale=m.getNormalScale()),T.normalTexture=O}if(m.getOcclusionTexture()){const _=m.getOcclusionTexture(),b=m.getOcclusionTextureInfo(),O=c.createTextureInfoDef(_,b);m.getOcclusionStrength()!==1&&(O.strength=m.getOcclusionStrength()),T.occlusionTexture=O}if(m.getMetallicRoughnessTexture()){const _=m.getMetallicRoughnessTexture(),b=m.getMetallicRoughnessTextureInfo();T.pbrMetallicRoughness.metallicRoughnessTexture=c.createTextureInfoDef(_,b)}return c.materialIndexMap.set(m,S),T}),s.meshes=n.listMeshes().map((m,S)=>{const T=c.createPropertyDef(m);let _=null;return T.primitives=m.listPrimitives().map(b=>{const O={attributes:{}};O.mode=b.getMode();const P=b.getMaterial();P&&(O.material=c.materialIndexMap.get(P)),Object.keys(b.getExtras()).length&&(O.extras=b.getExtras());const V=b.getIndices();V&&(O.indices=c.accessorIndexMap.get(V));for(const B of b.listSemantics())O.attributes[B]=c.accessorIndexMap.get(b.getAttribute(B));for(const B of b.listTargets()){const k={};for(const G of B.listSemantics())k[G]=c.accessorIndexMap.get(B.getAttribute(G));O.targets=O.targets||[],O.targets.push(k)}return b.listTargets().length&&!_&&(_=b.listTargets().map(B=>B.getName())),O}),m.getWeights().length&&(T.weights=m.getWeights()),_&&(T.extras=T.extras||{},T.extras.targetNames=_),c.meshIndexMap.set(m,S),T}),s.cameras=n.listCameras().map((m,S)=>{const T=c.createPropertyDef(m);if(T.type=m.getType(),T.type===Jr.Type.PERSPECTIVE){T.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const _=m.getAspectRatio();_!==null&&(T.perspective.aspectRatio=_)}else T.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return c.cameraIndexMap.set(m,S),T}),s.nodes=n.listNodes().map((m,S)=>{const T=c.createPropertyDef(m);return Ne.eq(m.getTranslation(),[0,0,0])||(T.translation=m.getTranslation()),Ne.eq(m.getRotation(),[0,0,0,1])||(T.rotation=m.getRotation()),Ne.eq(m.getScale(),[1,1,1])||(T.scale=m.getScale()),m.getWeights().length&&(T.weights=m.getWeights()),c.nodeIndexMap.set(m,S),T}),s.skins=n.listSkins().map((m,S)=>{const T=c.createPropertyDef(m),_=m.getInverseBindMatrices();_&&(T.inverseBindMatrices=c.accessorIndexMap.get(_));const b=m.getSkeleton();return b&&(T.skeleton=c.nodeIndexMap.get(b)),T.joints=m.listJoints().map(O=>c.nodeIndexMap.get(O)),c.skinIndexMap.set(m,S),T}),n.listNodes().forEach((m,S)=>{const T=s.nodes[S],_=m.getMesh();_&&(T.mesh=c.meshIndexMap.get(_));const b=m.getCamera();b&&(T.camera=c.cameraIndexMap.get(b));const O=m.getSkin();O&&(T.skin=c.skinIndexMap.get(O)),m.listChildren().length>0&&(T.children=m.listChildren().map(P=>c.nodeIndexMap.get(P)))}),s.animations=n.listAnimations().map((m,S)=>{const T=c.createPropertyDef(m),_=new Map;return T.samplers=m.listSamplers().map((b,O)=>{const P=c.createPropertyDef(b);return P.input=c.accessorIndexMap.get(b.getInput()),P.output=c.accessorIndexMap.get(b.getOutput()),P.interpolation=b.getInterpolation(),_.set(b,O),P}),T.channels=m.listChannels().map(b=>{const O=c.createPropertyDef(b);return O.sampler=_.get(b.getSampler()),O.target={node:c.nodeIndexMap.get(b.getTargetNode()),path:b.getTargetPath()},O}),c.animationIndexMap.set(m,S),T}),s.scenes=n.listScenes().map((m,S)=>{const T=c.createPropertyDef(m);return T.nodes=m.listChildren().map(_=>c.nodeIndexMap.get(_)),c.sceneIndexMap.set(m,S),T});const N=n.getDefaultScene();return N&&(s.scene=n.listScenes().indexOf(N)),s.extensionsUsed=d.map(m=>m.extensionName),s.extensionsRequired=g.map(m=>m.extensionName),d.forEach(m=>m.write(c)),function(m){const S=[];for(const T in m){const _=m[T];(Array.isArray(_)&&_.length===0||_===null||_===""||_&&typeof _=="object"&&Object.keys(_).length===0)&&S.push(T)}for(const T of S)delete m[T]}(s),a}};var Nn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Nn||(Nn={}));let Wh=class{constructor(){this.M=er.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=In.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=aa(r)?this.L(r):{json:JSON.parse(oe.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Vh.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(oe.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)&&c.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(oe.assertView(e)))}async writeJSON(e,r={}){if(r.format===Qt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return qh.write(e,{format:r.format||Qt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:Ye({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Qt.GLB}),s=new Uint32Array([1179937895,2,12]),a=JSON.stringify(r),c=oe.pad(oe.encodeText(a),32),f=oe.toView(new Uint32Array([c.byteLength,1313821514])),h=oe.concat([f,c]);s[s.length-1]+=h.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return oe.concat([oe.toView(s),h]);const g=oe.pad(d,0),x=oe.toView(new Uint32Array([g.byteLength,5130562])),w=oe.concat([x,g]);return s[s.length-1]+=w.byteLength,oe.concat([oe.toView(s),h,w])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(r,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)oe.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${kh()}.${xr.extension(n.uri)}`;e.resources[s]=oe.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:Ye({},e.json),resources:Ye({},e.resources)},r&&(e.json.images=r.map(s=>Ye({},s))),n&&(e.json.buffers=n.map(s=>Ye({},s))),e}L(e){if(!aa(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Nn.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=oe.decodeText(oe.toView(e,20,n)),a=JSON.parse(s),c=20+n;if(e.byteLength<=c)return{json:a,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+c,2);if(f[1]!==Nn.BIN)throw new Error("Expected GLB BIN in second chunk.");const h=oe.toView(e,c+8,f[0]);return{json:a,resources:{[yr]:h}}}};function aa(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let Xh=class extends Wh{constructor(e=Vr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return Vr.resolve(e,r)}dirname(e){return Vr.dirname(e)}};const Yh=0,Kh=0,Jh=0,Zh=2,Qh=0,ed=163,td=166,rd=0,nd=2,sd=1,id=64,ad=0;class od{constructor(){this.vkFormat=ad,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Yh,this.levels=[],this.dataFormatDescriptor=[{vendorId:Jh,descriptorType:Kh,descriptorBlockSize:0,versionNumber:Zh,colorModel:Qh,colorPrimaries:sd,transferFunction:nd,flags:rd,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Nr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const We=[171,75,84,88,32,50,48,187,13,10,26,10];function oa(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function ds(t){const e=new Uint8Array(t.buffer,t.byteOffset,We.length);if(e[0]!==We[0]||e[1]!==We[1]||e[2]!==We[2]||e[3]!==We[3]||e[4]!==We[4]||e[5]!==We[5]||e[6]!==We[6]||e[7]!==We[7]||e[8]!==We[8]||e[9]!==We[9]||e[10]!==We[10]||e[11]!==We[11])throw new Error("Missing KTX 2.0 identifier.");const r=new od,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Nr(t,We.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const a=s._nextUint32();r.supercompressionScheme=s._nextUint32();const c=s._nextUint32(),f=s._nextUint32(),h=s._nextUint32(),d=s._nextUint32(),g=s._nextUint64(),x=s._nextUint64(),w=a*3*8,M=new Nr(t,We.length+n,w,!0);for(let xe=0;xe<a;xe++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+M._nextUint64(),M._nextUint64()),uncompressedByteLength:M._nextUint64()});const A=new Nr(t,c,f,!0),N={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},m=6,S=4,T=(N.descriptorBlockSize/4-m)/S;for(let xe=0;xe<T;xe++){const Te={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Te.channelType&id?(Te.sampleLower=A._nextInt32(),Te.sampleUpper=A._nextInt32()):(Te.sampleLower=A._nextUint32(),Te.sampleUpper=A._nextUint32()),N.samples[xe]=Te}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(N);const _=new Nr(t,h,d,!0);for(;_._offset<d;){const xe=_._nextUint32(),Te=_._scan(xe),Re=oa(Te);if(r.keyValue[Re]=_._nextUint8Array(xe-Te.byteLength-1),Re.match(/^ktx/i)){const Ae=oa(r.keyValue[Re]);r.keyValue[Re]=Ae.substring(0,Ae.lastIndexOf("\0"))}const Ue=xe%4?4-xe%4:0;_._skip(Ue)}if(x<=0)return r;const b=new Nr(t,g,x,!0),O=b._nextUint16(),P=b._nextUint16(),V=b._nextUint32(),B=b._nextUint32(),k=b._nextUint32(),G=b._nextUint32(),H=[];for(let xe=0;xe<a;xe++)H.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const K=g+b._offset,L=K+V,U=L+B,ee=U+k,fe=new Uint8Array(t.buffer,t.byteOffset+K,V),ie=new Uint8Array(t.buffer,t.byteOffset+L,B),ge=new Uint8Array(t.buffer,t.byteOffset+U,k),ve=new Uint8Array(t.buffer,t.byteOffset+ee,G);return r.globalData={endpointCount:O,selectorCount:P,imageDescs:H,endpointsData:fe,selectorsData:ie,tablesData:ge,extendedData:ve},r}const Bs="EXT_mesh_gpu_instancing",Rs="EXT_meshopt_compression",Ya="KHR_draco_mesh_compression",Vs="KHR_lights_punctual",zs="KHR_materials_anisotropy",Gs="KHR_materials_clearcoat",Hs="KHR_materials_emissive_strength",qs="KHR_materials_ior",Ws="KHR_materials_iridescence",Xs="KHR_materials_pbrSpecularGlossiness",Ys="KHR_materials_sheen",Ks="KHR_materials_specular",Js="KHR_materials_transmission",Zs="KHR_materials_unlit",Qs="KHR_materials_volume",sr="KHR_materials_variants",ei="KHR_texture_transform",On="KHR_xmp_json_ld",bs="INSTANCE_ATTRIBUTE";class Ka extends $e{init(){this.extensionName=Bs,this.propertyType="InstancedMesh",this.parentTypes=[X.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:bs})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Ka.EXTENSION_NAME=Bs;const Ut=Bs;class Ja extends Se{constructor(...e){super(...e),this.extensionName=Ut,this.provideTypes=[X.NODE],this.prewriteTypes=[X.ACCESSOR]}createInstancedMesh(){return new Ka(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[Ut])return;const s=r.extensions[Ut],a=this.createInstancedMesh();for(const c in s.attributes)a.setAttribute(c,e.accessors[s.attributes[c]]);e.nodes[n].setExtension(Ut,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(bs);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,bs);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(Ut);if(s){const a=e.nodeIndexMap.get(n),c=r.json.nodes[a],f={attributes:{}};s.listSemantics().forEach(h=>{const d=s.getAttribute(h);f.attributes[h]=e.accessorIndexMap.get(d)}),c.extensions=c.extensions||{},c.extensions[Ut]=f}}),this}}function At(){return At=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},At.apply(this,arguments)}var Xr,gr,De;Ja.EXTENSION_NAME=Ut,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Xr||(Xr={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(gr||(gr={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(De||(De={}));const{BYTE:cd,SHORT:ca,FLOAT:ld}=te.ComponentType,{encodeNormalizedInt:la,decodeNormalizedInt:ps}=Ne;function fd(t,e,r,n){const{filter:s,bits:a}=n,c={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==gr.ATTRIBUTES)return c;if(s!==De.NONE){let f=t.getNormalized()?function(h){const d=h.getComponentType(),g=h.getArray(),x=new Float32Array(g.length);for(let w=0;w<g.length;w++)x[w]=ps(g[w],d);return x}(t):new Float32Array(c.array);switch(s){case De.EXPONENTIAL:c.byteStride=4*t.getElementSize(),c.componentType=ld,c.normalized=!1,c.array=e.encodeFilterExp(f,t.getCount(),c.byteStride,a);break;case De.OCTAHEDRAL:c.byteStride=a>8?8:4,c.componentType=a>8?ca:cd,c.normalized=!0,f=t.getElementSize()===3?function(h){const d=new Float32Array(4*h.length/3);for(let g=0,x=h.length/3;g<x;g++)d[4*g]=h[3*g],d[4*g+1]=h[3*g+1],d[4*g+2]=h[3*g+2];return d}(f):f,c.array=e.encodeFilterOct(f,t.getCount(),c.byteStride,a);break;case De.QUATERNION:c.byteStride=8,c.componentType=ca,c.normalized=!0,c.array=e.encodeFilterQuat(f,t.getCount(),c.byteStride,a);break;default:throw new Error("Invalid filter.")}c.min=t.getMin([]),c.max=t.getMax([]),t.getNormalized()&&(c.min=c.min.map(h=>ps(h,t.getComponentType())),c.max=c.max.map(h=>ps(h,t.getComponentType()))),c.normalized&&(c.min=c.min.map(h=>la(h,c.componentType)),c.max=c.max.map(h=>la(h,c.componentType)))}else c.byteStride%4&&(c.array=function(f,h){const d=oe.padNumber(f.BYTES_PER_ELEMENT*h)/f.BYTES_PER_ELEMENT,g=new f.constructor(f.length/h*d);for(let x=0;x*h<f.length;x++)for(let w=0;w<h;w++)g[x*d+w]=f[x*h+w];return g}(c.array,t.getElementSize()),c.byteStride=c.array.byteLength/t.getCount());return c}function ud(t,e){return e===ut.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Wr&&r.getMode()===Wr.Mode.TRIANGLES)?gr.TRIANGLES:gr.INDICES:gr.ATTRIBUTES}function hd(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Xa));for(const n of r){const s=n.getName(),a=n.getAttributes().key||"",c=n.getParent().propertyType===X.PRIMITIVE_TARGET;if(s==="indices")return{filter:De.NONE};if(s==="attributes"){if(a==="POSITION")return{filter:De.NONE};if(a==="TEXCOORD_0")return{filter:De.NONE};if(a.startsWith("JOINTS_"))return{filter:De.NONE};if(a.startsWith("WEIGHTS_"))return{filter:De.NONE};if(a==="NORMAL"||a==="TANGENT")return c?{filter:De.NONE}:{filter:De.OCTAHEDRAL,bits:8}}if(s==="output"){const f=Za(t);return f==="rotation"?{filter:De.QUATERNION,bits:16}:f==="translation"||f==="scale"?{filter:De.EXPONENTIAL,bits:12}:{filter:De.NONE}}if(s==="input")return{filter:De.NONE};if(s==="inverseBindMatrices")return{filter:De.NONE}}return{filter:De.NONE}}function Za(t){for(const e of t.listParents())if(e instanceof jn){for(const r of e.listParents())if(r instanceof Ls)return r.getTargetPath()}return null}const Xe=Rs,fa={method:Xr.QUANTIZE};class As extends Se{constructor(...e){super(...e),this.extensionName=Xe,this.prereadTypes=[X.BUFFER,X.PRIMITIVE],this.prewriteTypes=[X.BUFFER,X.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=fa,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=At({},fa,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Xe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Xe}]: Missing WASM support.`)}return r===X.BUFFER?this._prereadBuffers(e):r===X.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Xe])return;const a=n.extensions[Xe],c=a.byteOffset||0,f=a.byteLength||0,h=a.count,d=a.byteStride,g=new Uint8Array(h*d),x=r.json.buffers[a.buffer],w=oe.toView(x.uri?r.resources[x.uri]:r.resources[yr],c,f);this._decoder.decodeGltfBuffer(g,h,d,w,a.mode,a.filter),e.bufferViews[s]=g})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Xe]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[Rs]&&s.extensions[Rs].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Xe].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof te&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===X.ACCESSOR?this._prewriteAccessors(e):r===X.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,a=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(a);this._encoderFallbackBuffer=a,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if(Za(f)==="weights"||f.getSparse())continue;const h=e.getAccessorUsage(f),d=ud(f,h),g=s.method===Xr.FILTER?hd(f,this.document):{filter:De.NONE},x=fd(f,n,d,g),{array:w,byteStride:M}=x,A=f.getBuffer();if(!A)throw new Error(`${Xe}: Missing buffer for accessor.`);const N=this.document.getRoot().listBuffers().indexOf(A),m=[h,d,g.filter,M,N].join(":");let S=this._encoderBufferViews[m],T=this._encoderBufferViewData[m],_=this._encoderBufferViewAccessors[m];S&&T||(_=this._encoderBufferViewAccessors[m]=[],T=this._encoderBufferViewData[m]=[],S=this._encoderBufferViews[m]={buffer:c,target:ut.USAGE_TO_TARGET[h],byteOffset:0,byteLength:0,byteStride:h===ut.BufferViewUsage.ARRAY_BUFFER?M:void 0,extensions:{[Xe]:{buffer:N,byteOffset:0,byteLength:0,mode:d,filter:g.filter!==De.NONE?g.filter:void 0,byteStride:M,count:0}}});const b=e.createAccessorDef(f);b.componentType=x.componentType,b.normalized=x.normalized,b.byteOffset=S.byteLength,b.min&&x.min&&(b.min=x.min),b.max&&x.max&&(b.max=x.max),e.accessorIndexMap.set(f,r.accessors.length),r.accessors.push(b),_.push(b),T.push(new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),S.byteLength+=w.byteLength,S.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],a=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[s.extensions[Xe].buffer],f=e.otherBufferViews.get(c)||[],{count:h,byteStride:d,mode:g}=s.extensions[Xe],x=oe.concat(a),w=r.encodeGltfBuffer(x,h,d,g),M=oe.pad(w);s.extensions[Xe].byteLength=w.byteLength,a.length=0,a.push(M),f.push(M),e.otherBufferViews.set(c,f)}}write(e){let r=0;for(const c in this._encoderBufferViews){const f=this._encoderBufferViews[c],h=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),d=this._encoderBufferViewAccessors[c];for(const w of d)w.bufferView=h;const g=e.jsonDoc.json.bufferViews[h],x=g.byteOffset||0;Object.assign(g,f),g.byteOffset=r,g.extensions[Xe].byteOffset=x,r+=oe.padNumber(f.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),a=e.jsonDoc.json.buffers[s];return a.byteLength=r,a.extensions={[Xe]:{fallback:!0}},n.dispose(),this}}As.EXTENSION_NAME=Xe,As.EncoderMethod=Xr;const Ur="EXT_texture_avif";class dd{match(e){return e.length>=12&&oe.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=ua(r,0);if(!n)return null;let s=n.end;for(;n=ua(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class Qa extends Se{constructor(...e){super(...e),this.extensionName=Ur,this.prereadTypes=[X.TEXTURE]}static register(){yt.registerFormat("image/avif",new dd)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Ur]&&(r.source=r.extensions[Ur].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Ur]={source:a.source},delete a.source)})}}),this}}function ua(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:oe.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}Qa.EXTENSION_NAME=Ur;const Lr="EXT_texture_webp";class pd{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=oe.decodeText(e.slice(0,4)),n=oe.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let a=12;for(;a<s.byteLength;){const c=oe.decodeText(new Uint8Array([s.getUint8(a),s.getUint8(a+1),s.getUint8(a+2),s.getUint8(a+3)])),f=s.getUint32(a+4,!0);if(c==="VP8 ")return[16383&s.getInt16(a+14,!0),16383&s.getInt16(a+16,!0)];if(c==="VP8L"){const h=s.getUint8(a+9),d=s.getUint8(a+10),g=s.getUint8(a+11);return[1+((63&d)<<8|h),1+((15&s.getUint8(a+12))<<10|g<<2|(192&d)>>6)]}a+=8+f+f%2}return null}getChannels(e){return 4}}class eo extends Se{constructor(...e){super(...e),this.extensionName=Lr,this.prereadTypes=[X.TEXTURE]}static register(){yt.registerFormat("image/webp",new pd)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Lr]&&(r.source=r.extensions[Lr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Lr]={source:a.source},delete a.source)})}}),this}}eo.EXTENSION_NAME=Lr;const ha=Ya;let Le,to,ro,it;function gd(t,e){const r=new Le.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Le.TRIANGULAR_MESH)throw new Error(`[${ha}] Unknown geometry type.`);const n=new Le.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${ha}] Decoding failure.`);return n}finally{Le.destroy(r)}}function md(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const a=r*Uint16Array.BYTES_PER_ELEMENT;n=Le._malloc(a),t.GetTrianglesUInt16Array(e,a,n),s=new Uint16Array(Le.HEAPU16.buffer,n,r).slice()}else{const a=r*Uint32Array.BYTES_PER_ELEMENT;n=Le._malloc(a),t.GetTrianglesUInt32Array(e,a,n),s=new Uint32Array(Le.HEAPU32.buffer,n,r).slice()}return Le._free(n),s}function vd(t,e,r,n){const s=ro[n.componentType],a=to[n.componentType],c=r.num_components(),f=e.num_points()*c,h=f*a.BYTES_PER_ELEMENT,d=Le._malloc(h);t.GetAttributeDataArrayForAllPoints(e,r,s,h,d);const g=new a(Le.HEAPF32.buffer,d,f).slice();return Le._free(d),g}var Yr,at;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(Yr||(Yr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(at||(at={}));const no={[at.POSITION]:14,[at.NORMAL]:10,[at.COLOR]:8,[at.TEX_COORD]:12,[at.GENERIC]:12},da={decodeSpeed:5,encodeSpeed:5,method:Yr.EDGEBREAKER,quantizationBits:no,quantizationVolume:"mesh"};function yd(t,e=da){const r=At({},da,e);r.quantizationBits=At({},no,e.quantizationBits);const n=new it.MeshBuilder,s=new it.Mesh,a=new it.ExpertEncoder(s),c={},f=new it.DracoInt8Array,h=t.listTargets().length>0;let d=!1;for(const N of t.listSemantics()){const m=t.getAttribute(N);if(m.getSparse()){d=!0;continue}const S=xd(N),T=Td(n,m.getComponentType(),s,it[S],m.getCount(),m.getElementSize(),m.getArray());if(T===-1)throw new Error(`Error compressing "${N}" attribute.`);if(c[N]=T,r.quantizationVolume==="mesh"||N!=="POSITION")a.SetAttributeQuantization(T,r.quantizationBits[S]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:_}=r,b=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);a.SetAttributeExplicitQuantization(T,r.quantizationBits[S],m.getElementSize(),_.min,b)}}}const g=t.getIndices();if(!g)throw new Is("Primitive must have indices.");n.AddFacesToMesh(s,g.getCount()/3,g.getArray()),a.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),a.SetTrackEncodedProperties(!0),a.SetEncodingMethod(r.method===Yr.SEQUENTIAL||h||d?it.MESH_SEQUENTIAL_ENCODING:it.MESH_EDGEBREAKER_ENCODING);const x=a.EncodeToDracoBuffer(!(h||d),f);if(x<=0)throw new Is("Error applying Draco compression.");const w=new Uint8Array(x);for(let N=0;N<x;++N)w[N]=f.GetValue(N);const M=a.GetNumberOfEncodedPoints(),A=3*a.GetNumberOfEncodedFaces();return it.destroy(f),it.destroy(s),it.destroy(n),it.destroy(a),{numVertices:M,numIndices:A,data:w,attributeIDs:c}}function xd(t){return t==="POSITION"?at.POSITION:t==="NORMAL"?at.NORMAL:t.startsWith("COLOR_")?at.COLOR:t.startsWith("TEXCOORD_")?at.TEX_COORD:at.GENERIC}function Td(t,e,r,n,s,a,c){switch(e){case te.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,a,c);case te.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,a,c);case te.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,a,c);case te.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,a,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class Is extends Error{}const Fe=Ya;class Ss extends Se{constructor(...e){super(...e),this.extensionName=Fe,this.prereadTypes=[X.PRIMITIVE],this.prewriteTypes=[X.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Le=this._decoderModule,to={[te.ComponentType.FLOAT]:Float32Array,[te.ComponentType.UNSIGNED_INT]:Uint32Array,[te.ComponentType.UNSIGNED_SHORT]:Uint16Array,[te.ComponentType.UNSIGNED_BYTE]:Uint8Array,[te.ComponentType.SHORT]:Int16Array,[te.ComponentType.BYTE]:Int8Array},ro={[te.ComponentType.FLOAT]:Le.DT_FLOAT32,[te.ComponentType.UNSIGNED_INT]:Le.DT_UINT32,[te.ComponentType.UNSIGNED_SHORT]:Le.DT_UINT16,[te.ComponentType.UNSIGNED_BYTE]:Le.DT_UINT8,[te.ComponentType.SHORT]:Le.DT_INT16,[te.ComponentType.BYTE]:Le.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,it=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Fe}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const a=n.json.meshes||[];for(const c of a)for(const f of c.primitives){if(!f.extensions||!f.extensions[Fe])continue;const h=f.extensions[Fe];let[d,g]=s.get(h.bufferView)||[];if(!g||!d){const x=n.json.bufferViews[h.bufferView],w=n.json.buffers[x.buffer],M=oe.toView(w.uri?n.resources[w.uri]:n.resources[yr],x.byteOffset||0,x.byteLength);d=new this._decoderModule.Decoder,g=gd(d,M),s.set(h.bufferView,[d,g]),r.debug(`[${Fe}] Decompressed ${M.byteLength} bytes.`)}for(const x in f.attributes){const w=e.jsonDoc.json.accessors[f.attributes[x]],M=d.GetAttributeByUniqueId(g,h.attributes[x]),A=vd(d,g,M,w);e.accessors[f.attributes[x]].setArray(A)}f.indices!==void 0&&e.accessors[f.indices].setArray(md(d,g))}}finally{for(const[a,c]of Array.from(s.values()))this._decoderModule.destroy(a),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Fe}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Fe}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(f){const h=f.getLogger(),d=new Set,g=new Set;for(const m of f.getRoot().listMeshes())for(const S of m.listPrimitives())S.getIndices()?S.getMode()!==Wr.Mode.TRIANGLES?(g.add(S),h.warn(`[${Fe}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(S):(g.add(S),h.warn(`[${Fe}] Skipping Draco compression on non-indexed primitive.`));const x=f.getRoot().listAccessors(),w=new Map;for(let m=0;m<x.length;m++)w.set(x[m],m);const M=new Map,A=new Set,N=new Map;for(const m of Array.from(d)){let S=pa(m,w);if(A.has(S))N.set(m,S);else{if(M.has(m.getIndices())){const T=m.getIndices(),_=T.clone();w.set(_,f.getRoot().listAccessors().length-1),m.swap(T,_)}for(const T of m.listAttributes())if(M.has(T)){const _=T.clone();w.set(_,f.getRoot().listAccessors().length-1),m.swap(T,_)}S=pa(m,w),A.add(S),N.set(m,S),M.set(m.getIndices(),S);for(const T of m.listAttributes())M.set(T,S)}}for(const m of Array.from(M.keys())){const S=new Set(m.listParents().map(T=>T.propertyType));if(S.size!==2||!S.has(X.PRIMITIVE)||!S.has(X.ROOT))throw new Error(`[${Fe}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const m of Array.from(d)){const S=N.get(m),T=m.getIndices();if(M.get(T)!==S||m.listAttributes().some(_=>M.get(_)!==S))throw new Error(`[${Fe}] Draco primitives must share all, or no, accessors.`)}for(const m of Array.from(g)){const S=m.getIndices();if(M.has(S)||m.listAttributes().some(T=>M.has(T)))throw new Error(`[${Fe}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return N}(this.document),a=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Fe}]: quantizationVolume=scene requires exactly 1 scene.`):c=Sh(this.document.getRoot().listScenes().pop()));for(const f of Array.from(s.keys())){const h=s.get(f);if(!h)throw new Error("Unexpected primitive.");if(a.has(h)){a.set(h,a.get(h));continue}const d=f.getIndices(),g=e.jsonDoc.json.accessors;let x;try{x=yd(f,At({},this._encoderOptions,{quantizationVolume:c}))}catch(A){if(A instanceof Is){n.warn(`[${Fe}]: ${A.message} Skipping primitive compression.`);continue}throw A}a.set(h,x);const w=e.createAccessorDef(d);w.count=x.numIndices,e.accessorIndexMap.set(d,g.length),g.push(w);for(const A of f.listSemantics()){const N=f.getAttribute(A);if(x.attributeIDs[A]===void 0)continue;const m=e.createAccessorDef(N);m.count=x.numVertices,e.accessorIndexMap.set(N,g.length),g.push(m)}const M=f.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(M)||e.otherBufferViews.set(M,[]),e.otherBufferViews.get(M).push(x.data)}return n.debug(`[${Fe}] Compressed ${s.size} primitives.`),e.extensionData[Fe]={primitiveHashMap:s,primitiveEncodingMap:a},this}write(e){const r=e.extensionData[Fe];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let a=0;a<n.listPrimitives().length;a++){const c=n.listPrimitives()[a],f=s.primitives[a],h=r.primitiveHashMap.get(c);if(!h)continue;const d=r.primitiveEncodingMap.get(h);d&&(f.extensions=f.extensions||{},f.extensions[Fe]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Fe),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Fe)}return this}}function pa(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}Ss.EXTENSION_NAME=Fe,Ss.EncoderMethod=Yr;class Er extends $e{init(){this.extensionName=Vs,this.propertyType="Light",this.parentTypes=[X.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Er.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ze.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Ze.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}Er.EXTENSION_NAME=Vs,Er.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const gt=Vs;class so extends Se{constructor(...e){super(...e),this.extensionName=gt}createLight(e=""){return new Er(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[gt])return this;const n=(r.json.extensions[gt].lights||[]).map(s=>{var a,c;const f=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&f.setColor(s.color),s.intensity!==void 0&&f.setIntensity(s.intensity),s.range!==void 0&&f.setRange(s.range),((a=s.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(s.spot.innerConeAngle),((c=s.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(s.spot.outerConeAngle),f});return r.json.nodes.forEach((s,a)=>{s.extensions&&s.extensions[gt]&&e.nodes[a].setExtension(gt,n[s.extensions[gt].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const a of this.properties){const c=a,f={type:c.getType()};Ne.eq(c.getColor(),[1,1,1])||(f.color=c.getColor()),c.getIntensity()!==1&&(f.intensity=c.getIntensity()),c.getRange()!=null&&(f.range=c.getRange()),c.getName()&&(f.name=c.getName()),c.getType()===Er.Type.SPOT&&(f.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(f),s.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(a=>{const c=a.getExtension(gt);if(c){const f=e.nodeIndexMap.get(a),h=r.json.nodes[f];h.extensions=h.extensions||{},h.extensions[gt]={light:s.get(c)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[gt]={lights:n},this}}so.EXTENSION_NAME=gt;const{R:Ed,G:wd,B:Md}=ht;class io extends $e{init(){this.extensionName=zs,this.propertyType="Anisotropy",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Oe(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Ed|wd|Md})}}io.EXTENSION_NAME=zs;const Lt=zs;class ao extends Se{constructor(...e){super(...e),this.extensionName=Lt}createAnisotropy(){return new io(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Lt]){const c=this.createAnisotropy();e.materials[a].setExtension(Lt,c);const f=s.extensions[Lt];if(f.anisotropyStrength!==void 0&&c.setAnisotropyStrength(f.anisotropyStrength),f.anisotropyRotation!==void 0&&c.setAnisotropyRotation(f.anisotropyRotation),f.anisotropyTexture!==void 0){const h=f.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Lt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Lt]={};if(s.getAnisotropyStrength()>0&&(f.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(f.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const h=s.getAnisotropyTexture(),d=s.getAnisotropyTextureInfo();f.anisotropyTexture=e.createTextureInfoDef(h,d)}}}),this}}ao.EXTENSION_NAME=Lt;const{R:ga,G:ma,B:_d}=ht;class oo extends $e{init(){this.extensionName=Gs,this.propertyType="Clearcoat",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Oe(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Oe(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Oe(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ga})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ma})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ga|ma|_d})}}oo.EXTENSION_NAME=Gs;const jt=Gs;class co extends Se{constructor(...e){super(...e),this.extensionName=jt}createClearcoat(){return new oo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[jt]){const c=this.createClearcoat();e.materials[a].setExtension(jt,c);const f=s.extensions[jt];if(f.clearcoatFactor!==void 0&&c.setClearcoatFactor(f.clearcoatFactor),f.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(f.clearcoatRoughnessFactor),f.clearcoatTexture!==void 0){const h=f.clearcoatTexture;c.setClearcoatTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),h)}if(f.clearcoatRoughnessTexture!==void 0){const h=f.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),h)}if(f.clearcoatNormalTexture!==void 0){const h=f.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),h),h.scale!==void 0&&c.setClearcoatNormalScale(h.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(jt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[jt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const h=s.getClearcoatTexture(),d=s.getClearcoatTextureInfo();f.clearcoatTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatRoughnessTexture()){const h=s.getClearcoatRoughnessTexture(),d=s.getClearcoatRoughnessTextureInfo();f.clearcoatRoughnessTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatNormalTexture()){const h=s.getClearcoatNormalTexture(),d=s.getClearcoatNormalTextureInfo();f.clearcoatNormalTexture=e.createTextureInfoDef(h,d),s.getClearcoatNormalScale()!==1&&(f.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}co.EXTENSION_NAME=jt;class lo extends $e{init(){this.extensionName=Hs,this.propertyType="EmissiveStrength",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}lo.EXTENSION_NAME=Hs;const Bt=Hs;class fo extends Se{constructor(...e){super(...e),this.extensionName=Bt}createEmissiveStrength(){return new lo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Bt]){const s=this.createEmissiveStrength();e.materials[n].setExtension(Bt,s);const a=r.extensions[Bt];a.emissiveStrength!==void 0&&s.setEmissiveStrength(a.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Bt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Bt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}fo.EXTENSION_NAME=Bt;class uo extends $e{init(){this.extensionName=qs,this.propertyType="IOR",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}uo.EXTENSION_NAME=qs;const Vt=qs;class ho extends Se{constructor(...e){super(...e),this.extensionName=Vt}createIOR(){return new uo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Vt]){const s=this.createIOR();e.materials[n].setExtension(Vt,s);const a=r.extensions[Vt];a.ior!==void 0&&s.setIOR(a.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Vt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Vt]={ior:s.getIOR()}}}),this}}ho.EXTENSION_NAME=Vt;const{R:Rd,G:bd}=ht;class po extends $e{init(){this.extensionName=Ws,this.propertyType="Iridescence",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Oe(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Oe(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Rd})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:bd})}}po.EXTENSION_NAME=Ws;const zt=Ws;class go extends Se{constructor(...e){super(...e),this.extensionName=zt}createIridescence(){return new po(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[zt]){const c=this.createIridescence();e.materials[a].setExtension(zt,c);const f=s.extensions[zt];if(f.iridescenceFactor!==void 0&&c.setIridescenceFactor(f.iridescenceFactor),f.iridescenceIor!==void 0&&c.setIridescenceIOR(f.iridescenceIor),f.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(f.iridescenceThicknessMaximum),f.iridescenceTexture!==void 0){const h=f.iridescenceTexture;c.setIridescenceTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),h)}if(f.iridescenceThicknessTexture!==void 0){const h=f.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(zt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[zt]={};if(s.getIridescenceFactor()>0&&(f.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(f.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(f.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(f.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const h=s.getIridescenceTexture(),d=s.getIridescenceTextureInfo();f.iridescenceTexture=e.createTextureInfoDef(h,d)}if(s.getIridescenceThicknessTexture()){const h=s.getIridescenceThicknessTexture(),d=s.getIridescenceThicknessTextureInfo();f.iridescenceThicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}go.EXTENSION_NAME=zt;const{R:va,G:ya,B:xa,A:Ta}=ht;class mo extends $e{init(){this.extensionName=Xs,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Oe(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Oe(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ze.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ze.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:va|ya|xa|Ta,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:va|ya|xa|Ta})}}mo.EXTENSION_NAME=Xs;const Gt=Xs;class vo extends Se{constructor(...e){super(...e),this.extensionName=Gt}createPBRSpecularGlossiness(){return new mo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Gt]){const c=this.createPBRSpecularGlossiness();e.materials[a].setExtension(Gt,c);const f=s.extensions[Gt];if(f.diffuseFactor!==void 0&&c.setDiffuseFactor(f.diffuseFactor),f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.glossinessFactor!==void 0&&c.setGlossinessFactor(f.glossinessFactor),f.diffuseTexture!==void 0){const h=f.diffuseTexture;c.setDiffuseTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),h)}if(f.specularGlossinessTexture!==void 0){const h=f.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Gt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Gt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const h=s.getDiffuseTexture(),d=s.getDiffuseTextureInfo();f.diffuseTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularGlossinessTexture()){const h=s.getSpecularGlossinessTexture(),d=s.getSpecularGlossinessTextureInfo();f.specularGlossinessTexture=e.createTextureInfoDef(h,d)}}}),this}}vo.EXTENSION_NAME=Gt;const{R:Ad,G:Id,B:Sd,A:Cd}=ht;class yo extends $e{init(){this.extensionName=Ys,this.propertyType="Sheen",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Oe(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Oe(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ze.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ze.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Ad|Id|Sd,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Cd})}}yo.EXTENSION_NAME=Ys;const Ht=Ys;class xo extends Se{constructor(...e){super(...e),this.extensionName=Ht}createSheen(){return new yo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Ht]){const c=this.createSheen();e.materials[a].setExtension(Ht,c);const f=s.extensions[Ht];if(f.sheenColorFactor!==void 0&&c.setSheenColorFactor(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(f.sheenRoughnessFactor),f.sheenColorTexture!==void 0){const h=f.sheenColorTexture;c.setSheenColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),h)}if(f.sheenRoughnessTexture!==void 0){const h=f.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ht);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Ht]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const h=s.getSheenColorTexture(),d=s.getSheenColorTextureInfo();f.sheenColorTexture=e.createTextureInfoDef(h,d)}if(s.getSheenRoughnessTexture()){const h=s.getSheenRoughnessTexture(),d=s.getSheenRoughnessTextureInfo();f.sheenRoughnessTexture=e.createTextureInfoDef(h,d)}}}),this}}xo.EXTENSION_NAME=Ht;const{R:Nd,G:Od,B:Fd,A:Dd}=ht;class To extends $e{init(){this.extensionName=Ks,this.propertyType="Specular",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Oe(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Oe(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ze.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ze.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Dd})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Nd|Od|Fd,isColor:!0})}}To.EXTENSION_NAME=Ks;const qt=Ks;class Eo extends Se{constructor(...e){super(...e),this.extensionName=qt}createSpecular(){return new To(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[qt]){const c=this.createSpecular();e.materials[a].setExtension(qt,c);const f=s.extensions[qt];if(f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.specularColorFactor!==void 0&&c.setSpecularColorFactor(f.specularColorFactor),f.specularTexture!==void 0){const h=f.specularTexture;c.setSpecularTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),h)}if(f.specularColorTexture!==void 0){const h=f.specularColorTexture;c.setSpecularColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(qt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[qt]={};if(s.getSpecularFactor()!==1&&(f.specularFactor=s.getSpecularFactor()),Ne.eq(s.getSpecularColorFactor(),[1,1,1])||(f.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const h=s.getSpecularTexture(),d=s.getSpecularTextureInfo();f.specularTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularColorTexture()){const h=s.getSpecularColorTexture(),d=s.getSpecularColorTextureInfo();f.specularColorTexture=e.createTextureInfoDef(h,d)}}}),this}}Eo.EXTENSION_NAME=qt;const{R:$d}=ht;class wo extends $e{init(){this.extensionName=Js,this.propertyType="Transmission",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Oe(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:$d})}}wo.EXTENSION_NAME=Js;const Wt=Js;class Mo extends Se{constructor(...e){super(...e),this.extensionName=Wt}createTransmission(){return new wo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Wt]){const c=this.createTransmission();e.materials[a].setExtension(Wt,c);const f=s.extensions[Wt];if(f.transmissionFactor!==void 0&&c.setTransmissionFactor(f.transmissionFactor),f.transmissionTexture!==void 0){const h=f.transmissionTexture;c.setTransmissionTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Wt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Wt]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const h=s.getTransmissionTexture(),d=s.getTransmissionTextureInfo();f.transmissionTexture=e.createTextureInfoDef(h,d)}}}),this}}Mo.EXTENSION_NAME=Wt;class _o extends $e{init(){this.extensionName=Zs,this.propertyType="Unlit",this.parentTypes=[X.MATERIAL]}}_o.EXTENSION_NAME=Zs;const hr=Zs;class ti extends Se{constructor(...e){super(...e),this.extensionName=hr}createUnlit(){return new _o(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[hr]&&e.materials[n].setExtension(hr,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(hr)){const s=e.materialIndexMap.get(n),a=r.json.materials[s];a.extensions=a.extensions||{},a.extensions[hr]={}}}),this}}ti.EXTENSION_NAME=hr;class Ro extends $e{init(){this.extensionName=sr,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Ro.EXTENSION_NAME=sr;class bo extends $e{init(){this.extensionName=sr,this.propertyType="MappingList",this.parentTypes=[X.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}bo.EXTENSION_NAME=sr;class Cs extends $e{init(){this.extensionName=sr,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Cs.EXTENSION_NAME=sr;const mt=sr;class Ao extends Se{constructor(...e){super(...e),this.extensionName=mt}createMappingList(){return new bo(this.document.getGraph())}createVariant(e=""){return new Cs(this.document.getGraph(),e)}createMapping(){return new Ro(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Cs)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[mt])return this;const n=(r.json.extensions[mt].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,a)=>{const c=e.meshes[a];(s.primitives||[]).forEach((f,h)=>{if(!f.extensions||!f.extensions[mt])return;const d=this.createMappingList(),g=f.extensions[mt];for(const x of g.mappings){const w=this.createMapping();x.material!==void 0&&w.setMaterial(e.materials[x.material]);for(const M of x.variants||[])w.addVariant(n[M]);d.addMapping(w)}c.listPrimitives()[h].setExtension(mt,d)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],a=new Map;for(const c of n)a.set(c,s.length),s.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const f=e.meshIndexMap.get(c);c.listPrimitives().forEach((h,d)=>{const g=h.getExtension(mt);if(!g)return;const x=e.jsonDoc.json.meshes[f].primitives[d],w=g.listMappings().map(M=>{const A=e.createPropertyDef(M),N=M.getMaterial();return N&&(A.material=e.materialIndexMap.get(N)),A.variants=M.listVariants().map(m=>a.get(m)),A});x.extensions=x.extensions||{},x.extensions[mt]={mappings:w}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[mt]={variants:s},this}}Ao.EXTENSION_NAME=mt;const{G:Pd}=ht;class Io extends $e{init(){this.extensionName=Qs,this.propertyType="Volume",this.parentTypes=[X.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Oe(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Pd})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ze.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Ze.hexToFactor(e,r))}}Io.EXTENSION_NAME=Qs;const Xt=Qs;class So extends Se{constructor(...e){super(...e),this.extensionName=Xt}createVolume(){return new Io(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Xt]){const c=this.createVolume();e.materials[a].setExtension(Xt,c);const f=s.extensions[Xt];if(f.thicknessFactor!==void 0&&c.setThicknessFactor(f.thicknessFactor),f.attenuationDistance!==void 0&&c.setAttenuationDistance(f.attenuationDistance),f.attenuationColor!==void 0&&c.setAttenuationColor(f.attenuationColor),f.thicknessTexture!==void 0){const h=f.thicknessTexture;c.setThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Xt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Xt]={};if(s.getThicknessFactor()>0&&(f.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(f.attenuationDistance=s.getAttenuationDistance()),Ne.eq(s.getAttenuationColor(),[1,1,1])||(f.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const h=s.getThicknessTexture(),d=s.getThicknessTextureInfo();f.thicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}So.EXTENSION_NAME=Xt;const Co="KHR_mesh_quantization";class No extends Se{constructor(...e){super(...e),this.extensionName=Co}read(e){return this}write(e){return this}}No.EXTENSION_NAME=Co;const jr="KHR_texture_basisu";class kd{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=ds(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=ds(e).dataFormatDescriptor[0];if(r.colorModel===ed)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===td)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=ds(e),n=this.getChannels(e)>3;let s=0;for(let a=0;a<r.levels.length;a++){const c=r.levels[a];s+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,a)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,a)))/4)*(n?16:8)}return s}}class Oo extends Se{constructor(...e){super(...e),this.extensionName=jr,this.prereadTypes=[X.TEXTURE]}static register(){yt.registerFormat("image/ktx2",new kd)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[jr]&&(r.source=r.extensions[jr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[jr]={source:a.source},delete a.source)})}}),this}}Oo.EXTENSION_NAME=jr;class Fo extends $e{init(){this.extensionName=ei,this.propertyType="Transform",this.parentTypes=[X.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Fo.EXTENSION_NAME=ei;const Yt=ei;class Do extends Se{constructor(...e){super(...e),this.extensionName=Yt}createTransform(){return new Fo(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Yt])continue;const s=this.createTransform(),a=n.extensions[Yt];a.offset!==void 0&&s.setOffset(a.offset),a.rotation!==void 0&&s.setRotation(a.rotation),a.scale!==void 0&&s.setScale(a.scale),a.texCoord!==void 0&&s.setTexCoord(a.texCoord),r.setExtension(Yt,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const a=n.getExtension(Yt);if(!a)continue;s.extensions=s.extensions||{};const c={},f=Ne.eq;f(a.getOffset(),[0,0])||(c.offset=a.getOffset()),a.getRotation()!==0&&(c.rotation=a.getRotation()),f(a.getScale(),[1,1])||(c.scale=a.getScale()),a.getTexCoord()!=null&&(c.texCoord=a.getTexCoord()),s.extensions[Yt]=c}return this}}Do.EXTENSION_NAME=Yt;const Ud=[X.ROOT,X.SCENE,X.NODE,X.MESH,X.MATERIAL,X.TEXTURE,X.ANIMATION];class $o extends $e{init(){this.extensionName=On,this.propertyType="Packet",this.parentTypes=Ud}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",At({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=At({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return At({"@context":gs(this.get("context"))},gs(this.get("properties")))}fromJSONLD(e){const r=(e=gs(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${On}: Missing context for term, "${e}".`)}}function gs(t){return JSON.parse(JSON.stringify(t))}$o.EXTENSION_NAME=On;const bt=On;class Po extends Se{constructor(...e){super(...e),this.extensionName=bt}createPacket(){return new $o(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[bt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,a=this.document.getRoot(),c=n.packets.map(d=>this.createPacket().fromJSONLD(d)),f=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],h=[[a],a.listScenes(),a.listNodes(),a.listMeshes(),a.listMaterials(),a.listTextures(),a.listAnimations()];for(let d=0;d<f.length;d++){const g=f[d]||[];for(let x=0;x<g.length;x++){const w=g[x];w.extensions&&w.extensions[bt]&&h[d][x].setExtension(bt,c[w.extensions[bt].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const a of s.listParents()){let c;switch(a.propertyType){case X.ROOT:c=r.asset;break;case X.SCENE:c=r.scenes[e.sceneIndexMap.get(a)];break;case X.NODE:c=r.nodes[e.nodeIndexMap.get(a)];break;case X.MESH:c=r.meshes[e.meshIndexMap.get(a)];break;case X.MATERIAL:c=r.materials[e.materialIndexMap.get(a)];break;case X.TEXTURE:c=r.images[e.imageIndexMap.get(a)];break;case X.ANIMATION:c=r.animations[e.animationIndexMap.get(a)];break;default:c=null,this.document.getLogger().warn(`[${bt}]: Unsupported parent property, "${a.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[bt]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[bt]={packets:n}),this}}Po.EXTENSION_NAME=bt;const ko=[Ss,so,ao,co,fo,ho,go,vo,Eo,xo,Mo,ti,Ao,So,No,Oo,Do,Po];[...ko];const Uo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Lo=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},Ld=(t=1,e=Uo)=>`    <item objectid="${t}" transform="${Lo(e)}" />
`,Ea=t=>t?t.toISOString().substring(0,10):"";function jd(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:a="jscad",creationDate:c=new Date,license:f="",modificationDate:h}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${f}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${Ea(c)}</metadata>
  <metadata name="ModificationDate">${Ea(h||c)}</metadata>
  <metadata name="Application">${a}</metadata>
   `)}function Bd(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:a})=>{Vd(t,s,a)}),t.push(` </components>
`),t.push(`</object>
`)}const Vd=(t,e=1,r=Uo)=>{t.push(`    <component objectid="${e}" transform="${Lo(r)}" />
`)};function zd(t,e,r,n,s,a){t.push(`  <object id="${e}" type="model"${a?' name="'+a+'"':""}>
   <mesh>
    <vertices>
`);for(let c=0;c<r.length;c+=3)t.push(`     <vertex x="${r[c].toPrecision(s)}" y="${r[c+1].toPrecision(s)}" z="${r[c+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let c=0;c<n.length;c+=3)t.push(`     <triangle v1="${n[c]}" v2="${n[c+1]}" v3="${n[c+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const wa={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Gd({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const a=[];return jd(a,s),a.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:c,vertices:f,indices:h,name:d})=>zd(a,c,f,h,n,d)),e.forEach(({id:c,children:f,name:h})=>{Bd(a,c,f,h)}),a.push(`  </resources>
`),a.push(`<build>
`),r.forEach(({objectID:c,transform:f})=>{a.push(Ld(c,f))}),a.push(`</build>
`),a.push(`</model>
`),a.join("")}class Hd{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var Ge=Uint8Array,tt=Uint16Array,ri=Int32Array,ni=new Ge([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),si=new Ge([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ma=new Ge([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jo=function(t,e){for(var r=new tt(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new ri(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return{b:r,r:s}},Bo=jo(ni,2),qd=Bo.b,Ns=Bo.r;qd[28]=258,Ns[258]=28;var Wd=jo(si,0),_a=Wd.r,Os=new tt(32768);for(var be=0;be<32768;++be){var Nt=(be&43690)>>1|(be&21845)<<1;Nt=(Nt&52428)>>2|(Nt&13107)<<2,Nt=(Nt&61680)>>4|(Nt&3855)<<4,Os[be]=((Nt&65280)>>8|(Nt&255)<<8)>>1}var Gr=function(t,e,r){for(var n=t.length,s=0,a=new tt(e);s<n;++s)t[s]&&++a[t[s]-1];var c=new tt(e);for(s=1;s<e;++s)c[s]=c[s-1]+a[s-1]<<1;var f;if(r){f=new tt(1<<e);var h=15-e;for(s=0;s<n;++s)if(t[s])for(var d=s<<4|t[s],g=e-t[s],x=c[t[s]-1]++<<g,w=x|(1<<g)-1;x<=w;++x)f[Os[x]>>h]=d}else for(f=new tt(n),s=0;s<n;++s)t[s]&&(f[s]=Os[c[t[s]-1]++]>>15-t[s]);return f},rr=new Ge(288);for(var be=0;be<144;++be)rr[be]=8;for(var be=144;be<256;++be)rr[be]=9;for(var be=256;be<280;++be)rr[be]=7;for(var be=280;be<288;++be)rr[be]=8;var Fn=new Ge(32);for(var be=0;be<32;++be)Fn[be]=5;var Xd=Gr(rr,9,0),Yd=Gr(Fn,5,0),Vo=function(t){return(t+7)/8|0},zo=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new Ge(r-e);return n.set(t.subarray(e,r)),n},Kd=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Bn=function(t,e,r){var n=new Error(e||Kd[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Bn),!r)throw n;return n},Rt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Or=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},ms=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,a=r.slice();if(!s)return{t:Ho,l:0};if(s==1){var c=new Ge(r[0].s+1);return c[r[0].s]=1,{t:c,l:1}}r.sort(function(O,P){return O.f-P.f}),r.push({s:-1,f:25001});var f=r[0],h=r[1],d=0,g=1,x=2;for(r[0]={s:-1,f:f.f+h.f,l:f,r:h};g!=s-1;)f=r[r[d].f<r[x].f?d++:x++],h=r[d!=g&&r[d].f<r[x].f?d++:x++],r[g++]={s:-1,f:f.f+h.f,l:f,r:h};for(var w=a[0].s,n=1;n<s;++n)a[n].s>w&&(w=a[n].s);var M=new tt(w+1),A=Fs(r[g-1],M,0);if(A>e){var n=0,N=0,m=A-e,S=1<<m;for(a.sort(function(P,V){return M[V.s]-M[P.s]||P.f-V.f});n<s;++n){var T=a[n].s;if(M[T]>e)N+=S-(1<<A-M[T]),M[T]=e;else break}for(N>>=m;N>0;){var _=a[n].s;M[_]<e?N-=1<<e-M[_]++-1:++n}for(;n>=0&&N;--n){var b=a[n].s;M[b]==e&&(--M[b],++N)}A=e}return{t:new Ge(M),l:A}},Fs=function(t,e,r){return t.s==-1?Math.max(Fs(t.l,e,r+1),Fs(t.r,e,r+1)):e[t.s]=r},Ra=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new tt(++e),n=0,s=t[0],a=1,c=function(h){r[n++]=h},f=1;f<=e;++f)if(t[f]==s&&f!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)c(32754);a>2&&(c(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(c(s),--a;a>6;a-=6)c(8304);a>2&&(c(a-3<<5|8208),a=0)}for(;a--;)c(s);a=1,s=t[f]}return{c:r.subarray(0,n),n:e}},Fr=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Go=function(t,e,r){var n=r.length,s=Vo(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var a=0;a<n;++a)t[s+a+4]=r[a];return(s+4+n)*8},ba=function(t,e,r,n,s,a,c,f,h,d,g){Rt(e,g++,r),++s[256];for(var x=ms(s,15),w=x.t,M=x.l,A=ms(a,15),N=A.t,m=A.l,S=Ra(w),T=S.c,_=S.n,b=Ra(N),O=b.c,P=b.n,V=new tt(19),B=0;B<T.length;++B)++V[T[B]&31];for(var B=0;B<O.length;++B)++V[O[B]&31];for(var k=ms(V,7),G=k.t,H=k.l,K=19;K>4&&!G[Ma[K-1]];--K);var L=d+5<<3,U=Fr(s,rr)+Fr(a,Fn)+c,ee=Fr(s,w)+Fr(a,N)+c+14+3*K+Fr(V,G)+2*V[16]+3*V[17]+7*V[18];if(h>=0&&L<=U&&L<=ee)return Go(e,g,t.subarray(h,h+d));var fe,ie,ge,ve;if(Rt(e,g,1+(ee<U)),g+=2,ee<U){fe=Gr(w,M,0),ie=w,ge=Gr(N,m,0),ve=N;var xe=Gr(G,H,0);Rt(e,g,_-257),Rt(e,g+5,P-1),Rt(e,g+10,K-4),g+=14;for(var B=0;B<K;++B)Rt(e,g+3*B,G[Ma[B]]);g+=3*K;for(var Te=[T,O],Re=0;Re<2;++Re)for(var Ue=Te[Re],B=0;B<Ue.length;++B){var Ae=Ue[B]&31;Rt(e,g,xe[Ae]),g+=G[Ae],Ae>15&&(Rt(e,g,Ue[B]>>5&127),g+=Ue[B]>>12)}}else fe=Xd,ie=rr,ge=Yd,ve=Fn;for(var B=0;B<f;++B){var Ce=n[B];if(Ce>255){var Ae=Ce>>18&31;Or(e,g,fe[Ae+257]),g+=ie[Ae+257],Ae>7&&(Rt(e,g,Ce>>23&31),g+=ni[Ae]);var et=Ce&31;Or(e,g,ge[et]),g+=ve[et],et>3&&(Or(e,g,Ce>>5&8191),g+=si[et])}else Or(e,g,fe[Ce]),g+=ie[Ce]}return Or(e,g,fe[256]),g+ie[256]},Jd=new ri([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ho=new Ge(0),Zd=function(t,e,r,n,s,a){var c=a.z||t.length,f=new Ge(n+c+5*(1+Math.ceil(c/7e3))+s),h=f.subarray(n,f.length-s),d=a.l,g=(a.r||0)&7;if(e){g&&(h[0]=a.r>>3);for(var x=Jd[e-1],w=x>>13,M=x&8191,A=(1<<r)-1,N=a.p||new tt(32768),m=a.h||new tt(A+1),S=Math.ceil(r/3),T=2*S,_=function(Ft){return(t[Ft]^t[Ft+1]<<S^t[Ft+2]<<T)&A},b=new ri(25e3),O=new tt(288),P=new tt(32),V=0,B=0,k=a.i||0,G=0,H=a.w||0,K=0;k+2<c;++k){var L=_(k),U=k&32767,ee=m[L];if(N[U]=ee,m[L]=U,H<=k){var fe=c-k;if((V>7e3||G>24576)&&(fe>423||!d)){g=ba(t,h,0,b,O,P,B,G,K,k-K,g),G=V=B=0,K=k;for(var ie=0;ie<286;++ie)O[ie]=0;for(var ie=0;ie<30;++ie)P[ie]=0}var ge=2,ve=0,xe=M,Te=U-ee&32767;if(fe>2&&L==_(k-Te))for(var Re=Math.min(w,fe)-1,Ue=Math.min(32767,k),Ae=Math.min(258,fe);Te<=Ue&&--xe&&U!=ee;){if(t[k+ge]==t[k+ge-Te]){for(var Ce=0;Ce<Ae&&t[k+Ce]==t[k+Ce-Te];++Ce);if(Ce>ge){if(ge=Ce,ve=Te,Ce>Re)break;for(var et=Math.min(Te,Ce-2),ot=0,ie=0;ie<et;++ie){var Je=k-Te+ie&32767,Me=N[Je],Ot=Je-Me&32767;Ot>ot&&(ot=Ot,ee=Je)}}}U=ee,ee=N[U],Te+=U-ee&32767}if(ve){b[G++]=268435456|Ns[ge]<<18|_a[ve];var He=Ns[ge]&31,xt=_a[ve]&31;B+=ni[He]+si[xt],++O[257+He],++P[xt],H=k+ge,++V}else b[G++]=t[k],++O[t[k]]}}for(k=Math.max(k,H);k<c;++k)b[G++]=t[k],++O[t[k]];g=ba(t,h,d,b,O,P,B,G,K,k-K,g),d||(a.r=g&7|h[g/8|0]<<3,g-=7,a.h=m,a.p=N,a.i=k,a.w=H)}else{for(var k=a.w||0;k<c+d;k+=65535){var Ve=k+65535;Ve>=c&&(h[g/8|0]=d,Ve=c),g=Go(h,g+1,t.subarray(k,Ve))}a.i=c}return zo(f,0,n+Vo(g)+s)},Qd=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),ep=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Qd[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},tp=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),c=new Ge(a.length+t.length);c.set(a),c.set(t,a.length),t=c,s.w=a.length}return Zd(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,s)},qo=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},ze=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function rp(t,e){return tp(t,e||{},0,0)}var Wo=function(t,e,r,n){for(var s in t){var a=t[s],c=e+s,f=n;Array.isArray(a)&&(f=qo(n,a[1]),a=a[0]),a instanceof Ge?r[c]=[a,f]:(r[c+="/"]=[new Ge(0),f],Wo(a,c,r,n))}},Aa=typeof TextEncoder<"u"&&new TextEncoder,np=typeof TextDecoder<"u"&&new TextDecoder,sp=0;try{np.decode(Ho,{stream:!0}),sp=1}catch{}function Hr(t,e){if(e){for(var r=new Ge(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(Aa)return Aa.encode(t);for(var s=t.length,a=new Ge(t.length+(t.length>>1)),c=0,f=function(g){a[c++]=g},n=0;n<s;++n){if(c+5>a.length){var h=new Ge(c+8+(s-n<<1));h.set(a),a=h}var d=t.charCodeAt(n);d<128||e?f(d):d<2048?(f(192|d>>6),f(128|d&63)):d>55295&&d<57344?(d=65536+(d&1047552)|t.charCodeAt(++n)&1023,f(240|d>>18),f(128|d>>12&63),f(128|d>>6&63),f(128|d&63)):(f(224|d>>12),f(128|d>>6&63),f(128|d&63))}return zo(a,0,c)}var Ds=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&Bn(9),e+=n+4}return e},Ia=function(t,e,r,n,s,a,c,f){var h=n.length,d=r.extra,g=f&&f.length,x=Ds(d);ze(t,e,c!=null?33639248:67324752),e+=4,c!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var w=new Date(r.mtime==null?Date.now():r.mtime),M=w.getFullYear()-1980;if((M<0||M>119)&&Bn(10),ze(t,e,M<<25|w.getMonth()+1<<21|w.getDate()<<16|w.getHours()<<11|w.getMinutes()<<5|w.getSeconds()>>1),e+=4,a!=-1&&(ze(t,e,r.crc),ze(t,e+4,a<0?-a-2:a),ze(t,e+8,r.size)),ze(t,e+12,h),ze(t,e+14,x),e+=16,c!=null&&(ze(t,e,g),ze(t,e+6,r.attrs),ze(t,e+10,c),e+=14),t.set(n,e),e+=h,x)for(var A in d){var N=d[A],m=N.length;ze(t,e,+A),ze(t,e+2,m),t.set(N,e+4),e+=4+m}return g&&(t.set(f,e),e+=g),e},ip=function(t,e,r,n,s){ze(t,e,101010256),ze(t,e+8,r),ze(t,e+10,r),ze(t,e+12,n),ze(t,e+16,s)};function ap(t,e){e||(e={});var r={},n=[];Wo(t,"",r,e);var s=0,a=0;for(var c in r){var f=r[c],h=f[0],d=f[1],g=d.level==0?0:8,x=Hr(c),w=x.length,M=d.comment,A=M&&Hr(M),N=A&&A.length,m=Ds(d.extra);w>65535&&Bn(11);var S=g?rp(h,d):h,T=S.length,_=ep();_.p(h),n.push(qo(d,{size:h.length,crc:_.d(),c:S,f:x,m:A,u:w!=c.length||A&&M.length!=N,o:s,compression:g})),s+=30+w+m+T,a+=76+2*(w+m)+(N||0)+T}for(var b=new Ge(a+22),O=s,P=a-s,V=0;V<n.length;++V){var x=n[V];Ia(b,x.o,x,x.f,x.u,x.c.length);var B=30+x.f.length+Ds(x.extra);b.set(x.c,x.o+B),Ia(b,s,x,x.f,x.u,x.c.length,x.o,x.m),s+=16+B+(x.m?x.m.length:0)}return ip(b,s,n.length,P,O),b}var Q=1e-6,le=typeof Float32Array<"u"?Float32Array:Array,ft=Math.random;function Xo(t){le=t}var op=Math.PI/180;function cp(t){return t*op}function lp(t,e){return Math.abs(t-e)<=Q*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var fp=Object.freeze({__proto__:null,get ARRAY_TYPE(){return le},EPSILON:Q,RANDOM:ft,equals:lp,setMatrixArrayType:Xo,toRadian:cp});function up(){var t=new le(4);return le!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function hp(t){var e=new le(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function dp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function pp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function gp(t,e,r,n){var s=new le(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function mp(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function vp(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function yp(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*a-s*n;return c?(c=1/c,t[0]=a*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t):null}function xp(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function Tp(t){return t[0]*t[3]-t[2]*t[1]}function Yo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*f+a*h,t[1]=s*f+c*h,t[2]=n*d+a*g,t[3]=s*d+c*g,t}function Ep(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+a*f,t[1]=s*h+c*f,t[2]=n*-f+a*h,t[3]=s*-f+c*h,t}function wp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1];return t[0]=n*f,t[1]=s*f,t[2]=a*h,t[3]=c*h,t}function Mp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function _p(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Rp(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function bp(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ap(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function Ip(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Ko(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Sp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Cp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=Q*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=Q*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=Q*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=Q*Math.max(1,Math.abs(a),Math.abs(d))}function Np(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Op(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var Fp=Yo,Dp=Ko,$p=Object.freeze({__proto__:null,LDU:Ap,add:Ip,adjoint:xp,clone:hp,copy:dp,create:up,determinant:Tp,equals:Cp,exactEquals:Sp,frob:bp,fromRotation:Mp,fromScaling:_p,fromValues:gp,identity:pp,invert:yp,mul:Fp,multiply:Yo,multiplyScalar:Np,multiplyScalarAndAdd:Op,rotate:Ep,scale:wp,set:mp,str:Rp,sub:Dp,subtract:Ko,transpose:vp});function Pp(){var t=new le(6);return le!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function kp(t){var e=new le(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Up(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Lp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function jp(t,e,r,n,s,a){var c=new le(6);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=a,c}function Bp(t,e,r,n,s,a,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t}function Vp(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=r*a-n*s;return h?(h=1/h,t[0]=a*h,t[1]=-n*h,t[2]=-s*h,t[3]=r*h,t[4]=(s*f-a*c)*h,t[5]=(n*c-r*f)*h,t):null}function zp(t){return t[0]*t[3]-t[1]*t[2]}function Jo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1],x=r[2],w=r[3],M=r[4],A=r[5];return t[0]=n*d+a*g,t[1]=s*d+c*g,t[2]=n*x+a*w,t[3]=s*x+c*w,t[4]=n*M+a*A+f,t[5]=s*M+c*A+h,t}function Gp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=Math.sin(r),g=Math.cos(r);return t[0]=n*g+a*d,t[1]=s*g+c*d,t[2]=n*-d+a*g,t[3]=s*-d+c*g,t[4]=f,t[5]=h,t}function Hp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n*d,t[1]=s*d,t[2]=a*g,t[3]=c*g,t[4]=f,t[5]=h,t}function qp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=n*d+a*g+f,t[5]=s*d+c*g+h,t}function Wp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function Xp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Yp(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Kp(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Jp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Zp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Zo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Qp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function eg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function tg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function rg(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=e[0],d=e[1],g=e[2],x=e[3],w=e[4],M=e[5];return Math.abs(r-h)<=Q*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=Q*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-g)<=Q*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-x)<=Q*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(c-w)<=Q*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-M)<=Q*Math.max(1,Math.abs(f),Math.abs(M))}var ng=Jo,sg=Zo,ig=Object.freeze({__proto__:null,add:Zp,clone:kp,copy:Up,create:Pp,determinant:zp,equals:rg,exactEquals:tg,frob:Jp,fromRotation:Wp,fromScaling:Xp,fromTranslation:Yp,fromValues:jp,identity:Lp,invert:Vp,mul:ng,multiply:Jo,multiplyScalar:Qp,multiplyScalarAndAdd:eg,rotate:Gp,scale:Hp,set:Bp,str:Kp,sub:sg,subtract:Zo,translate:qp});function Qo(){var t=new le(9);return le!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ag(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function og(t){var e=new le(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function cg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function lg(t,e,r,n,s,a,c,f,h){var d=new le(9);return d[0]=t,d[1]=e,d[2]=r,d[3]=n,d[4]=s,d[5]=a,d[6]=c,d[7]=f,d[8]=h,d}function fg(t,e,r,n,s,a,c,f,h,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t}function ug(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function hg(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function dg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=g*c-f*d,w=-g*a+f*h,M=d*a-c*h,A=r*x+n*w+s*M;return A?(A=1/A,t[0]=x*A,t[1]=(-g*n+s*d)*A,t[2]=(f*n-s*c)*A,t[3]=w*A,t[4]=(g*r-s*h)*A,t[5]=(-f*r+s*a)*A,t[6]=M*A,t[7]=(-d*r+n*h)*A,t[8]=(c*r-n*a)*A,t):null}function pg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8];return t[0]=c*g-f*d,t[1]=s*d-n*g,t[2]=n*f-s*c,t[3]=f*h-a*g,t[4]=r*g-s*h,t[5]=s*a-r*f,t[6]=a*d-c*h,t[7]=n*h-r*d,t[8]=r*c-n*a,t}function gg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8];return e*(d*a-c*h)+r*(-d*s+c*f)+n*(h*s-a*f)}function ec(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=r[0],M=r[1],A=r[2],N=r[3],m=r[4],S=r[5],T=r[6],_=r[7],b=r[8];return t[0]=w*n+M*c+A*d,t[1]=w*s+M*f+A*g,t[2]=w*a+M*h+A*x,t[3]=N*n+m*c+S*d,t[4]=N*s+m*f+S*g,t[5]=N*a+m*h+S*x,t[6]=T*n+_*c+b*d,t[7]=T*s+_*f+b*g,t[8]=T*a+_*h+b*x,t}function mg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=r[0],M=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=f,t[5]=h,t[6]=w*n+M*c+d,t[7]=w*s+M*f+g,t[8]=w*a+M*h+x,t}function vg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=Math.sin(r),M=Math.cos(r);return t[0]=M*n+w*c,t[1]=M*s+w*f,t[2]=M*a+w*h,t[3]=M*c-w*n,t[4]=M*f-w*s,t[5]=M*h-w*a,t[6]=d,t[7]=g,t[8]=x,t}function yg(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function xg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Tg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Eg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Mg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,x=n*f,w=s*c,M=s*f,A=s*h,N=a*c,m=a*f,S=a*h;return t[0]=1-x-A,t[3]=g-S,t[6]=w+m,t[1]=g+S,t[4]=1-d-A,t[7]=M-N,t[2]=w-m,t[5]=M+N,t[8]=1-d-x,t}function _g(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],N=e[13],m=e[14],S=e[15],T=r*f-n*c,_=r*h-s*c,b=r*d-a*c,O=n*h-s*f,P=n*d-a*f,V=s*d-a*h,B=g*N-x*A,k=g*m-w*A,G=g*S-M*A,H=x*m-w*N,K=x*S-M*N,L=w*S-M*m,U=T*L-_*K+b*H+O*G-P*k+V*B;return U?(U=1/U,t[0]=(f*L-h*K+d*H)*U,t[1]=(h*G-c*L-d*k)*U,t[2]=(c*K-f*G+d*B)*U,t[3]=(s*K-n*L-a*H)*U,t[4]=(r*L-s*G+a*k)*U,t[5]=(n*G-r*K-a*B)*U,t[6]=(N*V-m*P+S*O)*U,t[7]=(m*b-A*V-S*_)*U,t[8]=(A*P-N*b+S*T)*U,t):null}function Rg(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function bg(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Ag(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ig(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function tc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Sg(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Cg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Ng(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Og(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],x=e[0],w=e[1],M=e[2],A=e[3],N=e[4],m=e[5],S=e[6],T=e[7],_=e[8];return Math.abs(r-x)<=Q*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-w)<=Q*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(s-M)<=Q*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(a-A)<=Q*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-N)<=Q*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(f-m)<=Q*Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(h-S)<=Q*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-T)<=Q*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(g-_)<=Q*Math.max(1,Math.abs(g),Math.abs(_))}var Fg=ec,Dg=tc,$g=Object.freeze({__proto__:null,add:Ig,adjoint:pg,clone:og,copy:cg,create:Qo,determinant:gg,equals:Og,exactEquals:Ng,frob:Ag,fromMat2d:wg,fromMat4:ag,fromQuat:Mg,fromRotation:Tg,fromScaling:Eg,fromTranslation:xg,fromValues:lg,identity:ug,invert:dg,mul:Fg,multiply:ec,multiplyScalar:Sg,multiplyScalarAndAdd:Cg,normalFromMat4:_g,projection:Rg,rotate:vg,scale:yg,set:fg,str:bg,sub:Dg,subtract:tc,translate:mg,transpose:hg});function Pg(){var t=new le(16);return le!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function kg(t){var e=new le(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ug(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Lg(t,e,r,n,s,a,c,f,h,d,g,x,w,M,A,N){var m=new le(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=s,m[5]=a,m[6]=c,m[7]=f,m[8]=h,m[9]=d,m[10]=g,m[11]=x,m[12]=w,m[13]=M,m[14]=A,m[15]=N,m}function jg(t,e,r,n,s,a,c,f,h,d,g,x,w,M,A,N,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t[9]=g,t[10]=x,t[11]=w,t[12]=M,t[13]=A,t[14]=N,t[15]=m,t}function rc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bg(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],a=e[6],c=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=s,t[13]=c,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Vg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],N=e[13],m=e[14],S=e[15],T=r*f-n*c,_=r*h-s*c,b=r*d-a*c,O=n*h-s*f,P=n*d-a*f,V=s*d-a*h,B=g*N-x*A,k=g*m-w*A,G=g*S-M*A,H=x*m-w*N,K=x*S-M*N,L=w*S-M*m,U=T*L-_*K+b*H+O*G-P*k+V*B;return U?(U=1/U,t[0]=(f*L-h*K+d*H)*U,t[1]=(s*K-n*L-a*H)*U,t[2]=(N*V-m*P+S*O)*U,t[3]=(w*P-x*V-M*O)*U,t[4]=(h*G-c*L-d*k)*U,t[5]=(r*L-s*G+a*k)*U,t[6]=(m*b-A*V-S*_)*U,t[7]=(g*V-w*b+M*_)*U,t[8]=(c*K-f*G+d*B)*U,t[9]=(n*G-r*K-a*B)*U,t[10]=(A*P-N*b+S*T)*U,t[11]=(x*b-g*P-M*T)*U,t[12]=(f*k-c*H-h*B)*U,t[13]=(r*H-n*k+s*B)*U,t[14]=(N*_-A*O-m*T)*U,t[15]=(g*O-x*_+w*T)*U,t):null}function zg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],N=e[13],m=e[14],S=e[15];return t[0]=f*(w*S-M*m)-x*(h*S-d*m)+N*(h*M-d*w),t[1]=-(n*(w*S-M*m)-x*(s*S-a*m)+N*(s*M-a*w)),t[2]=n*(h*S-d*m)-f*(s*S-a*m)+N*(s*d-a*h),t[3]=-(n*(h*M-d*w)-f*(s*M-a*w)+x*(s*d-a*h)),t[4]=-(c*(w*S-M*m)-g*(h*S-d*m)+A*(h*M-d*w)),t[5]=r*(w*S-M*m)-g*(s*S-a*m)+A*(s*M-a*w),t[6]=-(r*(h*S-d*m)-c*(s*S-a*m)+A*(s*d-a*h)),t[7]=r*(h*M-d*w)-c*(s*M-a*w)+g*(s*d-a*h),t[8]=c*(x*S-M*N)-g*(f*S-d*N)+A*(f*M-d*x),t[9]=-(r*(x*S-M*N)-g*(n*S-a*N)+A*(n*M-a*x)),t[10]=r*(f*S-d*N)-c*(n*S-a*N)+A*(n*d-a*f),t[11]=-(r*(f*M-d*x)-c*(n*M-a*x)+g*(n*d-a*f)),t[12]=-(c*(x*m-w*N)-g*(f*m-h*N)+A*(f*w-h*x)),t[13]=r*(x*m-w*N)-g*(n*m-s*N)+A*(n*w-s*x),t[14]=-(r*(f*m-h*N)-c*(n*m-s*N)+A*(n*h-s*f)),t[15]=r*(f*w-h*x)-c*(n*w-s*x)+g*(n*h-s*f),t}function Gg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8],g=t[9],x=t[10],w=t[11],M=t[12],A=t[13],N=t[14],m=t[15],S=e*c-r*a,T=e*f-n*a,_=e*h-s*a,b=r*f-n*c,O=r*h-s*c,P=n*h-s*f,V=d*A-g*M,B=d*N-x*M,k=d*m-w*M,G=g*N-x*A,H=g*m-w*A,K=x*m-w*N;return S*K-T*H+_*G+b*k-O*B+P*V}function nc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=e[9],M=e[10],A=e[11],N=e[12],m=e[13],S=e[14],T=e[15],_=r[0],b=r[1],O=r[2],P=r[3];return t[0]=_*n+b*f+O*x+P*N,t[1]=_*s+b*h+O*w+P*m,t[2]=_*a+b*d+O*M+P*S,t[3]=_*c+b*g+O*A+P*T,_=r[4],b=r[5],O=r[6],P=r[7],t[4]=_*n+b*f+O*x+P*N,t[5]=_*s+b*h+O*w+P*m,t[6]=_*a+b*d+O*M+P*S,t[7]=_*c+b*g+O*A+P*T,_=r[8],b=r[9],O=r[10],P=r[11],t[8]=_*n+b*f+O*x+P*N,t[9]=_*s+b*h+O*w+P*m,t[10]=_*a+b*d+O*M+P*S,t[11]=_*c+b*g+O*A+P*T,_=r[12],b=r[13],O=r[14],P=r[15],t[12]=_*n+b*f+O*x+P*N,t[13]=_*s+b*h+O*w+P*m,t[14]=_*a+b*d+O*M+P*S,t[15]=_*c+b*g+O*A+P*T,t}function Hg(t,e,r){var n=r[0],s=r[1],a=r[2],c,f,h,d,g,x,w,M,A,N,m,S;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*a+e[12],t[13]=e[1]*n+e[5]*s+e[9]*a+e[13],t[14]=e[2]*n+e[6]*s+e[10]*a+e[14],t[15]=e[3]*n+e[7]*s+e[11]*a+e[15]):(c=e[0],f=e[1],h=e[2],d=e[3],g=e[4],x=e[5],w=e[6],M=e[7],A=e[8],N=e[9],m=e[10],S=e[11],t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=g,t[5]=x,t[6]=w,t[7]=M,t[8]=A,t[9]=N,t[10]=m,t[11]=S,t[12]=c*n+g*s+A*a+e[12],t[13]=f*n+x*s+N*a+e[13],t[14]=h*n+w*s+m*a+e[14],t[15]=d*n+M*s+S*a+e[15]),t}function qg(t,e,r){var n=r[0],s=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Wg(t,e,r,n){var s=n[0],a=n[1],c=n[2],f=Math.hypot(s,a,c),h,d,g,x,w,M,A,N,m,S,T,_,b,O,P,V,B,k,G,H,K,L,U,ee;return f<Q?null:(f=1/f,s*=f,a*=f,c*=f,h=Math.sin(r),d=Math.cos(r),g=1-d,x=e[0],w=e[1],M=e[2],A=e[3],N=e[4],m=e[5],S=e[6],T=e[7],_=e[8],b=e[9],O=e[10],P=e[11],V=s*s*g+d,B=a*s*g+c*h,k=c*s*g-a*h,G=s*a*g-c*h,H=a*a*g+d,K=c*a*g+s*h,L=s*c*g+a*h,U=a*c*g-s*h,ee=c*c*g+d,t[0]=x*V+N*B+_*k,t[1]=w*V+m*B+b*k,t[2]=M*V+S*B+O*k,t[3]=A*V+T*B+P*k,t[4]=x*G+N*H+_*K,t[5]=w*G+m*H+b*K,t[6]=M*G+S*H+O*K,t[7]=A*G+T*H+P*K,t[8]=x*L+N*U+_*ee,t[9]=w*L+m*U+b*ee,t[10]=M*L+S*U+O*ee,t[11]=A*L+T*U+P*ee,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Xg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[4],c=e[5],f=e[6],h=e[7],d=e[8],g=e[9],x=e[10],w=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*s+d*n,t[5]=c*s+g*n,t[6]=f*s+x*n,t[7]=h*s+w*n,t[8]=d*s-a*n,t[9]=g*s-c*n,t[10]=x*s-f*n,t[11]=w*s-h*n,t}function Yg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[8],g=e[9],x=e[10],w=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s-d*n,t[1]=c*s-g*n,t[2]=f*s-x*n,t[3]=h*s-w*n,t[8]=a*n+d*s,t[9]=c*n+g*s,t[10]=f*n+x*s,t[11]=h*n+w*s,t}function Kg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[4],g=e[5],x=e[6],w=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s+d*n,t[1]=c*s+g*n,t[2]=f*s+x*n,t[3]=h*s+w*n,t[4]=d*s-a*n,t[5]=g*s-c*n,t[6]=x*s-f*n,t[7]=w*s-h*n,t}function Jg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Zg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qg(t,e,r){var n=r[0],s=r[1],a=r[2],c=Math.hypot(n,s,a),f,h,d;return c<Q?null:(c=1/c,n*=c,s*=c,a*=c,f=Math.sin(e),h=Math.cos(e),d=1-h,t[0]=n*n*d+h,t[1]=s*n*d+a*f,t[2]=a*n*d-s*f,t[3]=0,t[4]=n*s*d-a*f,t[5]=s*s*d+h,t[6]=a*s*d+n*f,t[7]=0,t[8]=n*a*d+s*f,t[9]=s*a*d-n*f,t[10]=a*a*d+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function e1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function t1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=n+n,h=s+s,d=a+a,g=n*f,x=n*h,w=n*d,M=s*h,A=s*d,N=a*d,m=c*f,S=c*h,T=c*d;return t[0]=1-(M+N),t[1]=x+T,t[2]=w-S,t[3]=0,t[4]=x-T,t[5]=1-(g+N),t[6]=A+m,t[7]=0,t[8]=w+S,t[9]=A-m,t[10]=1-(g+M),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function n1(t,e){var r=new le(3),n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=n*n+s*s+a*a+c*c;return x>0?(r[0]=(f*c+g*n+h*a-d*s)*2/x,r[1]=(h*c+g*s+d*n-f*a)*2/x,r[2]=(d*c+g*a+f*s-h*n)*2/x):(r[0]=(f*c+g*n+h*a-d*s)*2,r[1]=(h*c+g*s+d*n-f*a)*2,r[2]=(d*c+g*a+f*s-h*n)*2),sc(t,e,r),t}function ic(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ac(t,e){var r=e[0],n=e[1],s=e[2],a=e[4],c=e[5],f=e[6],h=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(a,c,f),t[2]=Math.hypot(h,d,g),t}function oc(t,e){var r=new le(3);ac(r,e);var n=1/r[0],s=1/r[1],a=1/r[2],c=e[0]*n,f=e[1]*s,h=e[2]*a,d=e[4]*n,g=e[5]*s,x=e[6]*a,w=e[8]*n,M=e[9]*s,A=e[10]*a,N=c+g+A,m=0;return N>0?(m=Math.sqrt(N+1)*2,t[3]=.25*m,t[0]=(x-M)/m,t[1]=(w-h)/m,t[2]=(f-d)/m):c>g&&c>A?(m=Math.sqrt(1+c-g-A)*2,t[3]=(x-M)/m,t[0]=.25*m,t[1]=(f+d)/m,t[2]=(w+h)/m):g>A?(m=Math.sqrt(1+g-c-A)*2,t[3]=(w-h)/m,t[0]=(f+d)/m,t[1]=.25*m,t[2]=(x+M)/m):(m=Math.sqrt(1+A-c-g)*2,t[3]=(f-d)/m,t[0]=(w+h)/m,t[1]=(x+M)/m,t[2]=.25*m),t}function s1(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=s+s,d=a+a,g=c+c,x=s*h,w=s*d,M=s*g,A=a*d,N=a*g,m=c*g,S=f*h,T=f*d,_=f*g,b=n[0],O=n[1],P=n[2];return t[0]=(1-(A+m))*b,t[1]=(w+_)*b,t[2]=(M-T)*b,t[3]=0,t[4]=(w-_)*O,t[5]=(1-(x+m))*O,t[6]=(N+S)*O,t[7]=0,t[8]=(M+T)*P,t[9]=(N-S)*P,t[10]=(1-(x+A))*P,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function i1(t,e,r,n,s){var a=e[0],c=e[1],f=e[2],h=e[3],d=a+a,g=c+c,x=f+f,w=a*d,M=a*g,A=a*x,N=c*g,m=c*x,S=f*x,T=h*d,_=h*g,b=h*x,O=n[0],P=n[1],V=n[2],B=s[0],k=s[1],G=s[2],H=(1-(N+S))*O,K=(M+b)*O,L=(A-_)*O,U=(M-b)*P,ee=(1-(w+S))*P,fe=(m+T)*P,ie=(A+_)*V,ge=(m-T)*V,ve=(1-(w+N))*V;return t[0]=H,t[1]=K,t[2]=L,t[3]=0,t[4]=U,t[5]=ee,t[6]=fe,t[7]=0,t[8]=ie,t[9]=ge,t[10]=ve,t[11]=0,t[12]=r[0]+B-(H*B+U*k+ie*G),t[13]=r[1]+k-(K*B+ee*k+ge*G),t[14]=r[2]+G-(L*B+fe*k+ve*G),t[15]=1,t}function a1(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,x=n*f,w=s*c,M=s*f,A=s*h,N=a*c,m=a*f,S=a*h;return t[0]=1-x-A,t[1]=g+S,t[2]=w-m,t[3]=0,t[4]=g-S,t[5]=1-d-A,t[6]=M+N,t[7]=0,t[8]=w+m,t[9]=M-N,t[10]=1-d-x,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o1(t,e,r,n,s,a,c){var f=1/(r-e),h=1/(s-n),d=1/(a-c);return t[0]=a*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(s+n)*h,t[10]=(c+a)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*a*2*d,t[15]=0,t}function cc(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=(s+n)*c,t[14]=2*s*n*c):(t[10]=-1,t[14]=-2*n),t}var c1=cc;function l1(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=s*c,t[14]=s*n*c):(t[10]=-1,t[14]=-n),t}function f1(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),h=2/(c+f),d=2/(s+a);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=-((c-f)*h*.5),t[9]=(s-a)*d*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function lc(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=(c+a)*d,t[15]=1,t}var u1=lc;function h1(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=a*d,t[15]=1,t}function d1(t,e,r,n){var s,a,c,f,h,d,g,x,w,M,A=e[0],N=e[1],m=e[2],S=n[0],T=n[1],_=n[2],b=r[0],O=r[1],P=r[2];return Math.abs(A-b)<Q&&Math.abs(N-O)<Q&&Math.abs(m-P)<Q?rc(t):(g=A-b,x=N-O,w=m-P,M=1/Math.hypot(g,x,w),g*=M,x*=M,w*=M,s=T*w-_*x,a=_*g-S*w,c=S*x-T*g,M=Math.hypot(s,a,c),M?(M=1/M,s*=M,a*=M,c*=M):(s=0,a=0,c=0),f=x*c-w*a,h=w*s-g*c,d=g*a-x*s,M=Math.hypot(f,h,d),M?(M=1/M,f*=M,h*=M,d*=M):(f=0,h=0,d=0),t[0]=s,t[1]=f,t[2]=g,t[3]=0,t[4]=a,t[5]=h,t[6]=x,t[7]=0,t[8]=c,t[9]=d,t[10]=w,t[11]=0,t[12]=-(s*A+a*N+c*m),t[13]=-(f*A+h*N+d*m),t[14]=-(g*A+x*N+w*m),t[15]=1,t)}function p1(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=n[0],h=n[1],d=n[2],g=s-r[0],x=a-r[1],w=c-r[2],M=g*g+x*x+w*w;M>0&&(M=1/Math.sqrt(M),g*=M,x*=M,w*=M);var A=h*w-d*x,N=d*g-f*w,m=f*x-h*g;return M=A*A+N*N+m*m,M>0&&(M=1/Math.sqrt(M),A*=M,N*=M,m*=M),t[0]=A,t[1]=N,t[2]=m,t[3]=0,t[4]=x*m-w*N,t[5]=w*A-g*m,t[6]=g*N-x*A,t[7]=0,t[8]=g,t[9]=x,t[10]=w,t[11]=0,t[12]=s,t[13]=a,t[14]=c,t[15]=1,t}function g1(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function m1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function v1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function fc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function y1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function x1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function T1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function E1(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],x=t[9],w=t[10],M=t[11],A=t[12],N=t[13],m=t[14],S=t[15],T=e[0],_=e[1],b=e[2],O=e[3],P=e[4],V=e[5],B=e[6],k=e[7],G=e[8],H=e[9],K=e[10],L=e[11],U=e[12],ee=e[13],fe=e[14],ie=e[15];return Math.abs(r-T)<=Q*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-_)<=Q*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=Q*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-O)<=Q*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(c-P)<=Q*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-V)<=Q*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(h-B)<=Q*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(d-k)<=Q*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(g-G)<=Q*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(x-H)<=Q*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(w-K)<=Q*Math.max(1,Math.abs(w),Math.abs(K))&&Math.abs(M-L)<=Q*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(A-U)<=Q*Math.max(1,Math.abs(A),Math.abs(U))&&Math.abs(N-ee)<=Q*Math.max(1,Math.abs(N),Math.abs(ee))&&Math.abs(m-fe)<=Q*Math.max(1,Math.abs(m),Math.abs(fe))&&Math.abs(S-ie)<=Q*Math.max(1,Math.abs(S),Math.abs(ie))}var w1=nc,M1=fc,_1=Object.freeze({__proto__:null,add:v1,adjoint:zg,clone:kg,copy:Ug,create:Pg,determinant:Gg,equals:E1,exactEquals:T1,frob:m1,fromQuat:a1,fromQuat2:n1,fromRotation:Qg,fromRotationTranslation:sc,fromRotationTranslationScale:s1,fromRotationTranslationScaleOrigin:i1,fromScaling:Zg,fromTranslation:Jg,fromValues:Lg,fromXRotation:e1,fromYRotation:t1,fromZRotation:r1,frustum:o1,getRotation:oc,getScaling:ac,getTranslation:ic,identity:rc,invert:Vg,lookAt:d1,mul:w1,multiply:nc,multiplyScalar:y1,multiplyScalarAndAdd:x1,ortho:u1,orthoNO:lc,orthoZO:h1,perspective:c1,perspectiveFromFieldOfView:f1,perspectiveNO:cc,perspectiveZO:l1,rotate:Wg,rotateX:Xg,rotateY:Yg,rotateZ:Kg,scale:qg,set:jg,str:g1,sub:M1,subtract:fc,targetTo:p1,translate:Hg,transpose:Bg});function ii(){var t=new le(3);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function R1(t){var e=new le(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function uc(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function $s(t,e,r){var n=new le(3);return n[0]=t,n[1]=e,n[2]=r,n}function b1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function A1(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function I1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function hc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function dc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function pc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function S1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function C1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function N1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function O1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function F1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function D1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function $1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function gc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function mc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function vc(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function P1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function k1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function yc(t,e){var r=e[0],n=e[1],s=e[2],a=r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ai(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _n(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2];return t[0]=s*h-a*f,t[1]=a*c-n*h,t[2]=n*f-s*c,t}function U1(t,e,r,n){var s=e[0],a=e[1],c=e[2];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t}function L1(t,e,r,n,s,a){var c=a*a,f=c*(2*a-3)+1,h=c*(a-2)+a,d=c*(a-1),g=c*(3-2*a);return t[0]=e[0]*f+r[0]*h+n[0]*d+s[0]*g,t[1]=e[1]*f+r[1]*h+n[1]*d+s[1]*g,t[2]=e[2]*f+r[2]*h+n[2]*d+s[2]*g,t}function j1(t,e,r,n,s,a){var c=1-a,f=c*c,h=a*a,d=f*c,g=3*a*f,x=3*h*c,w=h*a;return t[0]=e[0]*d+r[0]*g+n[0]*x+s[0]*w,t[1]=e[1]*d+r[1]*g+n[1]*x+s[1]*w,t[2]=e[2]*d+r[2]*g+n[2]*x+s[2]*w,t}function B1(t,e){e=e||1;var r=ft()*2*Math.PI,n=ft()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function V1(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/c,t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function z1(t,e,r){var n=e[0],s=e[1],a=e[2];return t[0]=n*r[0]+s*r[3]+a*r[6],t[1]=n*r[1]+s*r[4]+a*r[7],t[2]=n*r[2]+s*r[5]+a*r[8],t}function G1(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=s*d-a*h,x=a*f-n*d,w=n*h-s*f,M=s*w-a*x,A=a*g-n*w,N=n*x-s*g,m=c*2;return g*=m,x*=m,w*=m,M*=2,A*=2,N*=2,t[0]=f+g+M,t[1]=h+x+A,t[2]=d+w+N,t}function H1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),a[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function q1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),a[1]=s[1],a[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function W1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),a[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),a[2]=s[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function X1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2],h=Math.sqrt(r*r+n*n+s*s),d=Math.sqrt(a*a+c*c+f*f),g=h*d,x=g&&ai(t,e)/g;return Math.acos(Math.min(Math.max(x,-1),1))}function Y1(t){return t[0]=0,t[1]=0,t[2]=0,t}function K1(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function J1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Z1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2];return Math.abs(r-a)<=Q*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=Q*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-f)<=Q*Math.max(1,Math.abs(s),Math.abs(f))}var Q1=hc,e0=dc,t0=pc,r0=gc,n0=mc,xc=uc,s0=vc,i0=function(){var t=ii();return function(e,r,n,s,a,c){var f,h;for(r||(r=3),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}}(),a0=Object.freeze({__proto__:null,add:I1,angle:X1,bezier:j1,ceil:S1,clone:R1,copy:b1,create:ii,cross:_n,dist:r0,distance:gc,div:t0,divide:pc,dot:ai,equals:Z1,exactEquals:J1,floor:C1,forEach:i0,fromValues:$s,hermite:L1,inverse:k1,len:xc,length:uc,lerp:U1,max:O1,min:N1,mul:e0,multiply:dc,negate:P1,normalize:yc,random:B1,rotateX:H1,rotateY:q1,rotateZ:W1,round:F1,scale:D1,scaleAndAdd:$1,set:A1,sqrDist:n0,sqrLen:s0,squaredDistance:mc,squaredLength:vc,str:K1,sub:Q1,subtract:hc,transformMat3:z1,transformMat4:V1,transformQuat:G1,zero:Y1});function Tc(){var t=new le(4);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ec(t){var e=new le(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function wc(t,e,r,n){var s=new le(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Mc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function _c(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Rc(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function bc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Ac(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Ic(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function o0(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function c0(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function l0(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function f0(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function u0(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Sc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function h0(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Cc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,s,a)}function Nc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+s*s+a*a}function oi(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function ci(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function d0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function p0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Oc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=a*c,t}function Fc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function g0(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],c=r[0]*n[3]-r[3]*n[0],f=r[1]*n[2]-r[2]*n[1],h=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],g=e[0],x=e[1],w=e[2],M=e[3];return t[0]=x*d-w*h+M*f,t[1]=-(g*d)+w*c-M*a,t[2]=g*h-x*c+M*s,t[3]=-(g*f)+x*a-w*s,t}function Dc(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t[3]=f+n*(r[3]-f),t}function m0(t,e){e=e||1;var r,n,s,a,c,f;do r=ft()*2-1,n=ft()*2-1,c=r*r+n*n;while(c>=1);do s=ft()*2-1,a=ft()*2-1,f=s*s+a*a;while(f>=1);var h=Math.sqrt((1-c)/f);return t[0]=e*r,t[1]=e*n,t[2]=e*s*h,t[3]=e*a*h,t}function v0(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*a+r[12]*c,t[1]=r[1]*n+r[5]*s+r[9]*a+r[13]*c,t[2]=r[2]*n+r[6]*s+r[10]*a+r[14]*c,t[3]=r[3]*n+r[7]*s+r[11]*a+r[15]*c,t}function y0(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2],d=r[3],g=d*n+f*a-h*s,x=d*s+h*n-c*a,w=d*a+c*s-f*n,M=-c*n-f*s-h*a;return t[0]=g*d+M*-c+x*-h-w*-f,t[1]=x*d+M*-f+w*-c-g*-h,t[2]=w*d+M*-h+g*-f-x*-c,t[3]=e[3],t}function x0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function T0(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function $c(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Pc(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=Q*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=Q*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=Q*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=Q*Math.max(1,Math.abs(a),Math.abs(d))}var E0=bc,w0=Ac,M0=Ic,_0=Cc,R0=Nc,b0=oi,A0=ci,I0=function(){var t=Tc();return function(e,r,n,s,a,c){var f,h;for(r||(r=4),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}(),S0=Object.freeze({__proto__:null,add:Rc,ceil:o0,clone:Ec,copy:Mc,create:Tc,cross:g0,dist:_0,distance:Cc,div:M0,divide:Ic,dot:Fc,equals:Pc,exactEquals:$c,floor:c0,forEach:I0,fromValues:wc,inverse:p0,len:b0,length:oi,lerp:Dc,max:f0,min:l0,mul:w0,multiply:Ac,negate:d0,normalize:Oc,random:m0,round:u0,scale:Sc,scaleAndAdd:h0,set:_c,sqrDist:R0,sqrLen:A0,squaredDistance:Nc,squaredLength:ci,str:T0,sub:E0,subtract:bc,transformMat4:v0,transformQuat:y0,zero:x0});function Dn(){var t=new le(4);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function C0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function kc(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function N0(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>Q?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function O0(t,e){var r=fi(t,e);return Math.acos(2*r*r-1)}function Uc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,t}function Lc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+c*f,t[1]=s*h+a*f,t[2]=a*h-s*f,t[3]=c*h-n*f,t}function jc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h-a*f,t[1]=s*h+c*f,t[2]=a*h+n*f,t[3]=c*h-s*f,t}function Bc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*f,t[1]=s*h-n*f,t[2]=a*h+c*f,t[3]=c*h-a*f,t}function F0(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function Vc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=Math.exp(a),h=c>0?f*Math.sin(c)/c:0;return t[0]=r*h,t[1]=n*h,t[2]=s*h,t[3]=f*Math.cos(c),t}function zc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=c>0?Math.atan2(c,a)/c:0;return t[0]=r*f,t[1]=n*f,t[2]=s*f,t[3]=.5*Math.log(r*r+n*n+s*s+a*a),t}function D0(t,e,r){return zc(t,e),Hc(t,t,r),Vc(t,t),t}function Rn(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=r[0],d=r[1],g=r[2],x=r[3],w,M,A,N,m;return M=s*h+a*d+c*g+f*x,M<0&&(M=-M,h=-h,d=-d,g=-g,x=-x),1-M>Q?(w=Math.acos(M),A=Math.sin(w),N=Math.sin((1-n)*w)/A,m=Math.sin(n*w)/A):(N=1-n,m=n),t[0]=N*s+m*h,t[1]=N*a+m*d,t[2]=N*c+m*g,t[3]=N*f+m*x,t}function $0(t){var e=ft(),r=ft(),n=ft(),s=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function P0(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a,f=c?1/c:0;return t[0]=-r*f,t[1]=-n*f,t[2]=-s*f,t[3]=a*f,t}function k0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Gc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var a=(s+1)%3,c=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[a*3+a]-e[c*3+c]+1),t[s]=.5*n,n=.5/n,t[3]=(e[a*3+c]-e[c*3+a])*n,t[a]=(e[a*3+s]+e[s*3+a])*n,t[c]=(e[c*3+s]+e[s*3+c])*n}return t}function U0(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var a=Math.sin(e),c=Math.cos(e),f=Math.sin(r),h=Math.cos(r),d=Math.sin(n),g=Math.cos(n);return t[0]=a*h*g-c*f*d,t[1]=c*f*g+a*h*d,t[2]=c*h*d-a*f*g,t[3]=c*h*g+a*f*d,t}function L0(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var j0=Ec,B0=wc,li=Mc,V0=_c,z0=Rc,G0=Uc,Hc=Sc,fi=Fc,H0=Dc,ui=oi,q0=ui,hi=ci,W0=hi,di=Oc,X0=$c,Y0=Pc,K0=function(){var t=ii(),e=$s(1,0,0),r=$s(0,1,0);return function(n,s,a){var c=ai(s,a);return c<-.999999?(_n(t,e,s),xc(t)<1e-6&&_n(t,r,s),yc(t,t),kc(n,t,Math.PI),n):c>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_n(t,s,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+c,di(n,n))}}(),J0=function(){var t=Dn(),e=Dn();return function(r,n,s,a,c,f){return Rn(t,n,c,f),Rn(e,s,a,f),Rn(r,t,e,2*f*(1-f)),r}}(),Z0=function(){var t=Qo();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],di(e,Gc(e,t))}}(),Q0=Object.freeze({__proto__:null,add:z0,calculateW:F0,clone:j0,conjugate:k0,copy:li,create:Dn,dot:fi,equals:Y0,exactEquals:X0,exp:Vc,fromEuler:U0,fromMat3:Gc,fromValues:B0,getAngle:O0,getAxisAngle:N0,identity:C0,invert:P0,len:q0,length:ui,lerp:H0,ln:zc,mul:G0,multiply:Uc,normalize:di,pow:D0,random:$0,rotateX:Lc,rotateY:jc,rotateZ:Bc,rotationTo:K0,scale:Hc,set:V0,setAxes:Z0,setAxisAngle:kc,slerp:Rn,sqlerp:J0,sqrLen:W0,squaredLength:hi,str:L0});function em(){var t=new le(8);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function tm(t){var e=new le(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function rm(t,e,r,n,s,a,c,f){var h=new le(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=s,h[5]=a,h[6]=c,h[7]=f,h}function nm(t,e,r,n,s,a,c){var f=new le(8);f[0]=t,f[1]=e,f[2]=r,f[3]=n;var h=s*.5,d=a*.5,g=c*.5;return f[4]=h*n+d*r-g*e,f[5]=d*n+g*t-h*r,f[6]=g*n+h*e-d*t,f[7]=-h*t-d*e-g*r,f}function qc(t,e,r){var n=r[0]*.5,s=r[1]*.5,a=r[2]*.5,c=e[0],f=e[1],h=e[2],d=e[3];return t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=n*d+s*h-a*f,t[5]=s*d+a*c-n*h,t[6]=a*d+n*f-s*c,t[7]=-n*c-s*f-a*h,t}function sm(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function im(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function am(t,e){var r=Dn();oc(r,e);var n=new le(3);return ic(n,e),qc(t,r,n),t}function Wc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function om(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function cm(t,e,r,n,s,a,c,f,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t}var lm=li;function fm(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var um=li;function hm(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function dm(t,e){var r=e[4],n=e[5],s=e[6],a=e[7],c=-e[0],f=-e[1],h=-e[2],d=e[3];return t[0]=(r*d+a*c+n*h-s*f)*2,t[1]=(n*d+a*f+s*c-r*h)*2,t[2]=(s*d+a*h+r*f-n*c)*2,t}function pm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0]*.5,h=r[1]*.5,d=r[2]*.5,g=e[4],x=e[5],w=e[6],M=e[7];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=c*f+s*d-a*h+g,t[5]=c*h+a*f-n*d+x,t[6]=c*d+n*h-s*f+w,t[7]=-n*f-s*h-a*d+M,t}function gm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Lc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function mm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return jc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function vm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Bc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function ym(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=e[3];return t[0]=f*c+g*n+h*a-d*s,t[1]=h*c+g*s+d*n-f*a,t[2]=d*c+g*a+f*s-h*n,t[3]=g*c-f*n-h*s-d*a,f=e[4],h=e[5],d=e[6],g=e[7],t[4]=f*c+g*n+h*a-d*s,t[5]=h*c+g*s+d*n-f*a,t[6]=d*c+g*a+f*s-h*n,t[7]=g*c-f*n-h*s-d*a,t}function xm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,f=r[4],h=r[5],d=r[6],g=r[7],t[4]=n*g+c*f+s*d-a*h,t[5]=s*g+c*h+a*f-n*d,t[6]=a*g+c*d+n*h-s*f,t[7]=c*g-n*f-s*h-a*d,t}function Tm(t,e,r,n){if(Math.abs(n)<Q)return Wc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var a=Math.sin(n),c=a*r[0]/s,f=a*r[1]/s,h=a*r[2]/s,d=Math.cos(n),g=e[0],x=e[1],w=e[2],M=e[3];t[0]=g*d+M*c+x*h-w*f,t[1]=x*d+M*f+w*c-g*h,t[2]=w*d+M*h+g*f-x*c,t[3]=M*d-g*c-x*f-w*h;var A=e[4],N=e[5],m=e[6],S=e[7];return t[4]=A*d+S*c+N*h-m*f,t[5]=N*d+S*f+m*c-A*h,t[6]=m*d+S*h+A*f-N*c,t[7]=S*d-A*c-N*f-m*h,t}function Em(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Xc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[4],h=r[5],d=r[6],g=r[7],x=e[4],w=e[5],M=e[6],A=e[7],N=r[0],m=r[1],S=r[2],T=r[3];return t[0]=n*T+c*N+s*S-a*m,t[1]=s*T+c*m+a*N-n*S,t[2]=a*T+c*S+n*m-s*N,t[3]=c*T-n*N-s*m-a*S,t[4]=n*g+c*f+s*d-a*h+x*T+A*N+w*S-M*m,t[5]=s*g+c*h+a*f-n*d+w*T+A*m+M*N-x*S,t[6]=a*g+c*d+n*h-s*f+M*T+A*S+x*m-w*N,t[7]=c*g-n*f-s*h-a*d+A*T-x*N-w*m-M*S,t}var wm=Xc;function Mm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Yc=fi;function _m(t,e,r,n){var s=1-n;return Yc(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function Rm(t,e){var r=Vn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function bm(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Kc=ui,Am=Kc,Vn=hi,Im=Vn;function Sm(t,e){var r=Vn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,a=e[2]/r,c=e[3]/r,f=e[4],h=e[5],d=e[6],g=e[7],x=n*f+s*h+a*d+c*g;t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=(f-n*x)/r,t[5]=(h-s*x)/r,t[6]=(d-a*x)/r,t[7]=(g-c*x)/r}return t}function Cm(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Nm(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Om(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=e[0],x=e[1],w=e[2],M=e[3],A=e[4],N=e[5],m=e[6],S=e[7];return Math.abs(r-g)<=Q*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-x)<=Q*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-w)<=Q*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-M)<=Q*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-A)<=Q*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-N)<=Q*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(h-m)<=Q*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(d-S)<=Q*Math.max(1,Math.abs(d),Math.abs(S))}var Fm=Object.freeze({__proto__:null,add:Em,clone:tm,conjugate:bm,copy:Wc,create:em,dot:Yc,equals:Om,exactEquals:Nm,fromMat4:am,fromRotation:im,fromRotationTranslation:qc,fromRotationTranslationValues:nm,fromTranslation:sm,fromValues:rm,getDual:fm,getReal:lm,getTranslation:dm,identity:om,invert:Rm,len:Am,length:Kc,lerp:_m,mul:wm,multiply:Xc,normalize:Sm,rotateAroundAxis:Tm,rotateByQuatAppend:ym,rotateByQuatPrepend:xm,rotateX:gm,rotateY:mm,rotateZ:vm,scale:Mm,set:cm,setDual:hm,setReal:um,sqrLen:Im,squaredLength:Vn,str:Cm,translate:pm});function Jc(){var t=new le(2);return le!=Float32Array&&(t[0]=0,t[1]=0),t}function Dm(t){var e=new le(2);return e[0]=t[0],e[1]=t[1],e}function $m(t,e){var r=new le(2);return r[0]=t,r[1]=e,r}function Pm(t,e){return t[0]=e[0],t[1]=e[1],t}function km(t,e,r){return t[0]=e,t[1]=r,t}function Um(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Zc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Qc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function el(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Lm(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function jm(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Bm(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Vm(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function zm(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Gm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Hm(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function tl(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function rl(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function nl(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function sl(t){var e=t[0],r=t[1];return e*e+r*r}function qm(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Wm(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Xm(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Ym(t,e){return t[0]*e[0]+t[1]*e[1]}function Km(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Jm(t,e,r,n){var s=e[0],a=e[1];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t}function Zm(t,e){e=e||1;var r=ft()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Qm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function ev(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function tv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function rv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function nv(t,e,r,n){var s=e[0]-r[0],a=e[1]-r[1],c=Math.sin(n),f=Math.cos(n);return t[0]=s*f-a*c+r[0],t[1]=s*c+a*f+r[1],t}function sv(t,e){var r=t[0],n=t[1],s=e[0],a=e[1],c=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+a*a),f=c&&(r*s+n*a)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function iv(t){return t[0]=0,t[1]=0,t}function av(t){return"vec2("+t[0]+", "+t[1]+")"}function ov(t,e){return t[0]===e[0]&&t[1]===e[1]}function cv(t,e){var r=t[0],n=t[1],s=e[0],a=e[1];return Math.abs(r-s)<=Q*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=Q*Math.max(1,Math.abs(n),Math.abs(a))}var lv=nl,fv=Zc,uv=Qc,hv=el,dv=tl,pv=rl,gv=sl,mv=function(){var t=Jc();return function(e,r,n,s,a,c){var f,h;for(r||(r=2),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],a(t,t,c),e[f]=t[0],e[f+1]=t[1];return e}}(),vv=Object.freeze({__proto__:null,add:Um,angle:sv,ceil:Lm,clone:Dm,copy:Pm,create:Jc,cross:Km,dist:dv,distance:tl,div:hv,divide:el,dot:Ym,equals:cv,exactEquals:ov,floor:jm,forEach:mv,fromValues:$m,inverse:Wm,len:lv,length:nl,lerp:Jm,max:Vm,min:Bm,mul:uv,multiply:Qc,negate:qm,normalize:Xm,random:Zm,rotate:nv,round:zm,scale:Gm,scaleAndAdd:Hm,set:km,sqrDist:pv,sqrLen:gv,squaredDistance:rl,squaredLength:sl,str:av,sub:fv,subtract:Zc,transformMat2:Qm,transformMat2d:ev,transformMat3:tv,transformMat4:rv,zero:iv}),il=Object.freeze({__proto__:null,glMatrix:fp,mat2:$p,mat2d:ig,mat3:$g,mat4:_1,quat:Q0,quat2:Fm,vec2:vv,vec3:a0,vec4:S0}),yv=(()=>{var t=import.meta.url;return async function(e={}){var r=e,n,s;r.ready=new Promise((i,o)=>{n=i,s=o});var a=!1;r.setup=function(){if(a)return;a=!0;function i(C,I,$=j=>j){if(I)for(let j of I)C.push_back($(j));return C}function o(C,I=$=>$){const $=[],j=C.size();for(let J=0;J<j;J++)$.push(I(C.get(J)));return $}function l(C,I=$=>$){const $=[],j=C.size();for(let J=0;J<j;J++){const pe=C.get(J),ue=pe.size(),st=[];for(let qe=0;qe<ue;qe++)st.push(I(pe.get(qe)));$.push(st)}return $}function u(C){return C[0].length<3&&(C=[C]),i(new r.Vector2_vec2,C,I=>i(new r.Vector_vec2,I,$=>$ instanceof Array?{x:$[0],y:$[1]}:$))}function p(C){for(let I=0;I<C.size();I++)C.get(I).delete();C.delete()}function v(C){return C[0]instanceof Array?{x:C[0][0],y:C[0][1]}:typeof C[0]=="number"?{x:C[0]||0,y:C[1]||0}:C[0]}function E(C){return C[0]instanceof Array?{x:C[0][0],y:C[0][1],z:C[0][2]}:typeof C[0]=="number"?{x:C[0]||0,y:C[1]||0,z:C[2]||0}:C[0]}function R(C){return C=="EvenOdd"?0:C=="NonZero"?1:C=="Negative"?3:2}function F(C){return C=="Round"?1:C=="Miter"?2:0}const D=r.CrossSection;function z(C,I="Positive"){if(C instanceof D)return C;{const $=u(C),j=new D($,R(I));return p($),j}}r.CrossSection.prototype.translate=function(...C){return this._Translate(v(C))},r.CrossSection.prototype.scale=function(C){return typeof C=="number"?this._Scale({x:C,y:C}):this._Scale(v([C]))},r.CrossSection.prototype.mirror=function(C){return this._Mirror(v([C]))},r.CrossSection.prototype.warp=function(C){const I=Ir(function(j){const J=ct(j,"float"),pe=ct(j+4,"float"),ue=[J,pe];C(ue),ar(j,ue[0],"float"),ar(j+4,ue[1],"float")},"vi"),$=this._Warp(I);return Sr(I),$},r.CrossSection.prototype.decompose=function(){const C=this._Decompose(),I=o(C);return C.delete(),I},r.CrossSection.prototype.bounds=function(){const C=this._Bounds();return{min:["x","y"].map(I=>C.min[I]),max:["x","y"].map(I=>C.max[I])}},r.CrossSection.prototype.offset=function(C,I="Square",$=2,j=0){return this._Offset(C,F(I),$,j)},r.CrossSection.prototype.extrude=function(C,I=0,$=0,j=[1,1],J=!1){j=v([j]);const pe=r._Extrude(this,C,I,$,j);return J?pe.translate([0,0,-C/2]):pe},r.CrossSection.prototype.revolve=function(C=0,I=360){return r._Revolve(this,C,I)},r.CrossSection.prototype.add=function(C){return this._add(z(C))},r.CrossSection.prototype.subtract=function(C){return this._subtract(z(C))},r.CrossSection.prototype.intersect=function(C){return this._intersect(z(C))},r.CrossSection.prototype.toPolygons=function(){const C=this._ToPolygons(),I=l(C);return C.delete(),I},r.Manifold.prototype.warp=function(C){const I=Ir(function(J){const pe=ct(J,"float"),ue=ct(J+4,"float"),st=ct(J+8,"float"),qe=[pe,ue,st];C(qe),ar(J,qe[0],"float"),ar(J+4,qe[1],"float"),ar(J+8,qe[2],"float")},"vi"),$=this._Warp(I);Sr(I);const j=$.status();if(j.value!==0)throw new r.ManifoldError(j.value);return $},r.Manifold.prototype.setProperties=function(C,I){const $=this.numProp(),j=Ir(function(pe,ue,st){const qe=[];for(let ke=0;ke<C;++ke)qe[ke]=ct(pe+4*ke,"float");const fr=[];for(let ke=0;ke<3;++ke)fr[ke]=ct(ue+4*ke,"float");const ur=[];for(let ke=0;ke<$;++ke)ur[ke]=ct(st+4*ke,"float");I(qe,fr,ur);for(let ke=0;ke<C;++ke)ar(pe+4*ke,qe[ke],"float")},"viii"),J=this._SetProperties(C,j);return Sr(j),J},r.Manifold.prototype.translate=function(...C){return this._Translate(E(C))},r.Manifold.prototype.rotate=function(C){return this._Rotate(...C)},r.Manifold.prototype.scale=function(C){return typeof C=="number"?this._Scale({x:C,y:C,z:C}):this._Scale(E([C]))},r.Manifold.prototype.mirror=function(C){return this._Mirror(E([C]))},r.Manifold.prototype.trimByPlane=function(C,I=0){return this._TrimByPlane(E([C]),I)},r.Manifold.prototype.split=function(C){const I=this._split(C),$=o(I);return I.delete(),$},r.Manifold.prototype.splitByPlane=function(C,I=0){const $=this._splitByPlane(E([C]),I),j=o($);return $.delete(),j},r.Manifold.prototype.decompose=function(){const C=this._Decompose(),I=o(C);return C.delete(),I},r.Manifold.prototype.boundingBox=function(){const C=this._boundingBox();return{min:["x","y","z"].map(I=>C.min[I]),max:["x","y","z"].map(I=>C.max[I])}};class Y{constructor({numProp:I=3,triVerts:$=new Uint32Array,vertProperties:j=new Float32Array,mergeFromVert:J,mergeToVert:pe,runIndex:ue,runOriginalID:st,faceID:qe,halfedgeTangent:fr,runTransform:ur}={}){this.numProp=I,this.triVerts=$,this.vertProperties=j,this.mergeFromVert=J,this.mergeToVert=pe,this.runIndex=ue,this.runOriginalID=st,this.faceID=qe,this.halfedgeTangent=fr,this.runTransform=ur}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:I,mesh:$}=r._Merge(this);return Object.assign(this,{...$}),I}verts(I){return this.triVerts.subarray(3*I,3*(I+1))}position(I){return this.vertProperties.subarray(numProp*I,numProp*I+3)}extras(I){return this.vertProperties.subarray(numProp*I+3,numProp*(I+1))}tangent(I){return this.halfedgeTangent.subarray(4*I,4*(I+1))}transform(I){const $=new Array(16);for(const j of[0,1,2,3])for(const J of[0,1,2])$[4*j+J]=this.runTransform[12*I+3*j+J];return $[15]=1,$}}r.Mesh=Y,r.Manifold.prototype.getMesh=function(C=[0,0,0]){return C instanceof Array&&(C={0:C[0],1:C[1],2:C[2]}),new Y(this._GetMeshJS(C))},r.ManifoldError=function(I,...$){let j="Unknown error";switch(I){case r.status.NonFiniteVertex.value:j="Non-finite vertex";break;case r.status.NotManifold.value:j="Not manifold";break;case r.status.VertexOutOfBounds.value:j="Vertex index out of bounds";break;case r.status.PropertiesWrongLength.value:j="Properties have wrong length";break;case r.status.MissingPositionProperties.value:j="Less than three properties";break;case r.status.MergeVectorsDifferentLengths.value:j="Merge vectors have different lengths";break;case r.status.MergeIndexOutOfBounds.value:j="Merge index out of bounds";break;case r.status.TransformWrongLength.value:j="Transform vector has wrong length";break;case r.status.RunIndexWrongLength.value:j="Run index vector has wrong length";break;case r.status.FaceIDWrongLength.value:j="Face ID vector has wrong length";case r.status.InvalidConstruction.value:j="Manifold constructed with invalid parameters"}const J=Error.apply(this,[j,...$]);J.name=this.name="ManifoldError",this.message=J.message,this.stack=J.stack,this.code=I},r.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:r.ManifoldError,writable:!0,configurable:!0}}),r.CrossSection=function(C,I="Positive"){const $=u(C),j=new D($,R(I));return p($),j},r.CrossSection.ofPolygons=function(C,I="Positive"){return new r.CrossSection(C,I)},r.CrossSection.square=function(...C){let I;C.length==0?I={x:1,y:1}:typeof C[0]=="number"?I={x:C[0],y:C[0]}:I=v(C);const $=C[1]||!1;return r._Square(I,$)},r.CrossSection.circle=function(C,I=0){return r._Circle(C,I)};function q(C){return function(...I){I.length==1&&(I=I[0]);const $=new r.Vector_crossSection;for(const J of I)$.push_back(z(J));const j=r["_crossSection"+C]($);return $.delete(),j}}r.CrossSection.compose=q("Compose"),r.CrossSection.union=q("UnionN"),r.CrossSection.difference=q("DifferenceN"),r.CrossSection.intersection=q("IntersectionN");function W(C,I){i(C,I,$=>$ instanceof Array?{x:$[0],y:$[1]}:$)}r.CrossSection.hull=function(...C){C.length==1&&(C=C[0]);let I=new r.Vector_vec2;for(const j of C)if(j instanceof D)r._crossSectionCollectVertices(I,j);else if(j instanceof Array&&j.length==2&&typeof j[0]=="number")I.push_back({x:j[0],y:j[1]});else if(j.x)I.push_back(j);else{const pe=j[0].length==2&&typeof j[0][0]=="number"||j[0].x?[j]:j;for(const ue of pe)W(I,ue)}const $=r._crossSectionHullPoints(I);return I.delete(),$},r.CrossSection.prototype=Object.create(D.prototype),Object.defineProperty(r.CrossSection,Symbol.hasInstance,{get:()=>C=>C instanceof D});const Z=r.Manifold;r.Manifold=function(C){const I=new Z(C),$=I.status();if($.value!==0)throw new r.ManifoldError($.value);return I},r.Manifold.ofMesh=function(C){return new r.Manifold(C)},r.Manifold.tetrahedron=function(){return r._Tetrahedron()},r.Manifold.cube=function(...C){let I;C.length==0?I={x:1,y:1,z:1}:typeof C[0]=="number"?I={x:C[0],y:C[0],z:C[0]}:I=E(C);const $=C[1]||!1;return r._Cube(I,$)},r.Manifold.cylinder=function(C,I,$=-1,j=0,J=!1){return r._Cylinder(C,I,$,j,J)},r.Manifold.sphere=function(C,I=0){return r._Sphere(C,I)},r.Manifold.smooth=function(C,I=[]){const $=new r.Vector_smoothness;i($,I);const j=r._Smooth(C,$);return $.delete(),j},r.Manifold.extrude=function(C,I,$=0,j=0,J=[1,1],pe=!1){return(C instanceof D?C:r.CrossSection(C,"Positive")).extrude(I,$,j,J,pe)},r.Manifold.revolve=function(C,I=0,$=360){return(C instanceof D?C:r.CrossSection(C,"Positive")).revolve(I,$)},r.Manifold.reserveIDs=function(C){return r._ReserveIDs(C)},r.Manifold.compose=function(C){const I=new r.Vector_manifold;i(I,C);const $=r._manifoldCompose(I);return I.delete(),$};function he(C){return function(...I){I.length==1&&(I=I[0]);const $=new r.Vector_manifold;for(const J of I)$.push_back(J);const j=r["_manifold"+C+"N"]($);return $.delete(),j}}r.Manifold.union=he("Union"),r.Manifold.difference=he("Difference"),r.Manifold.intersection=he("Intersection"),r.Manifold.levelSet=function(C,I,$,j=0){const J={min:{x:I.min[0],y:I.min[1],z:I.min[2]},max:{x:I.max[0],y:I.max[1],z:I.max[2]}},pe=Ir(function(st){const qe=ct(st,"float"),fr=ct(st+4,"float"),ur=ct(st+8,"float");return C([qe,fr,ur])},"fi"),ue=r._LevelSet(pe,J,$,j);return Sr(pe),ue};function me(C,I){i(C,I,$=>$ instanceof Array?{x:$[0],y:$[1],z:$[2]}:$)}r.Manifold.hull=function(...C){C.length==1&&(C=C[0]);let I=new r.Vector_vec3;for(const j of C)j instanceof Z?r._manifoldCollectVertices(I,j):j instanceof Array&&j.length==3&&typeof j[0]=="number"?I.push_back({x:j[0],y:j[1],z:j[2]}):j.x?I.push_back(j):me(I,j);const $=r._manifoldHullPoints(I);return I.delete(),$},r.Manifold.prototype=Object.create(Z.prototype),Object.defineProperty(r.Manifold,Symbol.hasInstance,{get:()=>C=>C instanceof Z}),r.triangulate=function(C,I=-1){const $=u(C),j=o(r._Triangulate($,I),J=>[J[0],J[1],J[2]]);return p($),j}};var c=Object.assign({},r),f="./this.program",h=typeof window=="object",d=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",x="";function w(i){return r.locateFile?r.locateFile(i,x):x+i}var M,A,N;if(g){const{createRequire:i}=await import("./__vite-browser-external-4ed993c7.js");var m=i(import.meta.url),S=m("fs"),T=m("path");d?x=T.dirname(x)+"/":x=m("url").fileURLToPath(new URL("./",self.location)),M=(o,l)=>(o=ir(o)?new URL(o):T.normalize(o),S.readFileSync(o,l?void 0:"utf8")),N=o=>{var l=M(o,!0);return l.buffer||(l=new Uint8Array(l)),l},A=(o,l,u,p=!0)=>{o=ir(o)?new URL(o):T.normalize(o),S.readFile(o,p?void 0:"utf8",(v,E)=>{v?u(v):l(p?E.buffer:E)})},!r.thisProgram&&process.argv.length>1&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),r.inspect=()=>"[Emscripten Module object]"}else(h||d)&&(d?x=self.location.href:typeof document<"u"&&document.currentScript&&(x=document.currentScript.src),t&&(x=t),x.indexOf("blob:")!==0?x=x.substr(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1):x="",M=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.send(null),o.responseText},d&&(N=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),A=(i,o,l)=>{var u=new XMLHttpRequest;u.open("GET",i,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}l()},u.onerror=l,u.send(null)});var _=r.print||console.log.bind(console),b=r.printErr||console.error.bind(console);Object.assign(r,c),c=null,r.arguments&&r.arguments,r.thisProgram&&(f=r.thisProgram),r.quit&&r.quit;var O;r.wasmBinary&&(O=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&Ve("no native wasm support detected");var P,V=!1;function B(i,o){i||Ve(o)}var k,G,H,K,L,U,ee,fe;function ie(){var i=P.buffer;r.HEAP8=k=new Int8Array(i),r.HEAP16=H=new Int16Array(i),r.HEAPU8=G=new Uint8Array(i),r.HEAPU16=K=new Uint16Array(i),r.HEAP32=L=new Int32Array(i),r.HEAPU32=U=new Uint32Array(i),r.HEAPF32=ee=new Float32Array(i),r.HEAPF64=fe=new Float64Array(i)}var ge,ve=[],xe=[],Te=[];function Re(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Ce(r.preRun.shift());Gn(ve)}function Ue(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,Gn(xe)}function Ae(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)ot(r.postRun.shift());Gn(Te)}function Ce(i){ve.unshift(i)}function et(i){xe.unshift(i)}function ot(i){Te.unshift(i)}var Je=0,Me=null;function Ot(i){return i}function He(i){Je++,r.monitorRunDependencies&&r.monitorRunDependencies(Je)}function xt(i){if(Je--,r.monitorRunDependencies&&r.monitorRunDependencies(Je),Je==0&&Me){var o=Me;Me=null,o()}}function Ve(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",b(i),V=!0,i+=". Build with -sASSERTIONS for more info.";var o=new WebAssembly.RuntimeError(i);throw s(o),o}var Ft="data:application/octet-stream;base64,";function Zr(i){return i.startsWith(Ft)}function ir(i){return i.startsWith("file://")}var Tt;r.locateFile?(Tt="manifold.wasm",Zr(Tt)||(Tt=w(Tt))):Tt=new URL("/assets/manifold-684345bc.wasm",self.location).href;function vi(i){if(i==Tt&&O)return new Uint8Array(O);if(N)return N(i);throw"both async and sync fetching of the wasm failed"}function gl(i){if(!O&&(h||d)){if(typeof fetch=="function"&&!ir(i))return fetch(i,{credentials:"same-origin"}).then(o=>{if(!o.ok)throw"failed to load wasm binary file at '"+i+"'";return o.arrayBuffer()}).catch(()=>vi(i));if(A)return new Promise((o,l)=>{A(i,u=>o(new Uint8Array(u)),l)})}return Promise.resolve().then(()=>vi(i))}function yi(i,o,l){return gl(i).then(u=>WebAssembly.instantiate(u,o)).then(u=>u).then(l,u=>{b(`failed to asynchronously prepare wasm: ${u}`),Ve(u)})}function ml(i,o,l,u){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Zr(o)&&!ir(o)&&!g&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(p=>{var v=WebAssembly.instantiateStreaming(p,l);return v.then(u,function(E){return b(`wasm streaming compile failed: ${E}`),b("falling back to ArrayBuffer instantiation"),yi(o,l,u)})}):yi(o,l,u)}function vl(){var i={a:Ou};function o(u,p){var v=u.exports;return _e=v,P=_e.Qa,ie(),ge=_e.Sa,et(_e.Ra),xt(),v}He();function l(u){o(u.instance)}if(r.instantiateWasm)try{return r.instantiateWasm(i,o)}catch(u){b(`Module.instantiateWasm callback failed with error: ${u}`),s(u)}return ml(O,Tt,i,l).catch(s),{}}var de,je,Gn=i=>{for(;i.length>0;)i.shift()(r)};function ct(i,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return k[i>>0];case"i8":return k[i>>0];case"i16":return H[i>>1];case"i32":return L[i>>2];case"i64":Ve("to do getValue(i64) use WASM_BIGINT");case"float":return ee[i>>2];case"double":return fe[i>>3];case"*":return U[i>>2];default:Ve(`invalid type for getValue: ${o}`)}}function ar(i,o,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":k[i>>0]=o;break;case"i8":k[i>>0]=o;break;case"i16":H[i>>1]=o;break;case"i32":L[i>>2]=o;break;case"i64":Ve("to do setValue(i64) use WASM_BIGINT");case"float":ee[i>>2]=o;break;case"double":fe[i>>3]=o;break;case"*":U[i>>2]=o;break;default:Ve(`invalid type for setValue: ${l}`)}}var Qr=[],en=0,yl=i=>{var o=new Hn(i);return o.get_caught()||(o.set_caught(!0),en--),o.set_rethrown(!1),Qr.push(o),Hi(o.excPtr),o.get_exception_ptr()},Et=0,xl=()=>{re(0,0);var i=Qr.pop();Gi(i.excPtr),Et=0};function Hn(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(o){U[this.ptr+4>>2]=o},this.get_type=function(){return U[this.ptr+4>>2]},this.set_destructor=function(o){U[this.ptr+8>>2]=o},this.get_destructor=function(){return U[this.ptr+8>>2]},this.set_caught=function(o){o=o?1:0,k[this.ptr+12>>0]=o},this.get_caught=function(){return k[this.ptr+12>>0]!=0},this.set_rethrown=function(o){o=o?1:0,k[this.ptr+13>>0]=o},this.get_rethrown=function(){return k[this.ptr+13>>0]!=0},this.init=function(o,l){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(l)},this.set_adjusted_ptr=function(o){U[this.ptr+16>>2]=o},this.get_adjusted_ptr=function(){return U[this.ptr+16>>2]},this.get_exception_ptr=function(){var o=Wi(this.get_type());if(o)return U[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}var Tl=i=>{throw Et||(Et=i),Et},xi=i=>{var o=Et;if(!o)return Cr(0),0;var l=new Hn(o);l.set_adjusted_ptr(o);var u=l.get_type();if(!u)return Cr(0),o;for(var p in i){var v=i[p];if(v===0||v===u)break;var E=l.ptr+16;if(qi(v,u,E))return Cr(v),o}return Cr(u),o},El=()=>xi([]),wl=i=>xi([i]),Ml=()=>{var i=Qr.pop();i||Ve("no exception to throw");var o=i.excPtr;throw i.get_rethrown()||(Qr.push(i),i.set_rethrown(!0),i.set_caught(!1),en++),Et=o,Et},_l=(i,o,l)=>{var u=new Hn(i);throw u.init(o,l),Et=i,en++,Et},Rl=()=>en,tn={},qn=i=>{for(;i.length;){var o=i.pop(),l=i.pop();l(o)}};function Wn(i){return this.fromWireType(L[i>>2])}var or={},Dt={},rn={},Ti=void 0,nn=i=>{throw new Ti(i)},$t=(i,o,l)=>{i.forEach(function(R){rn[R]=o});function u(R){var F=l(R);F.length!==i.length&&nn("Mismatched type converter count");for(var D=0;D<i.length;++D)dt(i[D],F[D])}var p=new Array(o.length),v=[],E=0;o.forEach((R,F)=>{Dt.hasOwnProperty(R)?p[F]=Dt[R]:(v.push(R),or.hasOwnProperty(R)||(or[R]=[]),or[R].push(()=>{p[F]=Dt[R],++E,E===v.length&&u(p)}))}),v.length===0&&u(p)},bl=i=>{var o=tn[i];delete tn[i];var l=o.rawConstructor,u=o.rawDestructor,p=o.fields,v=p.map(E=>E.getterReturnType).concat(p.map(E=>E.setterArgumentType));$t([i],v,E=>{var R={};return p.forEach((F,D)=>{var z=F.fieldName,Y=E[D],q=F.getter,W=F.getterContext,Z=E[D+p.length],he=F.setter,me=F.setterContext;R[z]={read:C=>Y.fromWireType(q(W,C)),write:(C,I)=>{var $=[];he(me,C,Z.toWireType($,I)),qn($)}}}),[{name:o.name,fromWireType:F=>{var D={};for(var z in R)D[z]=R[z].read(F);return u(F),D},toWireType:(F,D)=>{for(var z in R)if(!(z in D))throw new TypeError(`Missing field: "${z}"`);var Y=l();for(z in R)R[z].write(Y,D[z]);return F!==null&&F.push(u,Y),Y},argPackAdvance:pt,readValueFromPointer:Wn,destructorFunction:u}]})},Al=(i,o,l,u,p)=>{},Il=()=>{for(var i=new Array(256),o=0;o<256;++o)i[o]=String.fromCharCode(o);Ei=i},Ei=void 0,Be=i=>{for(var o="",l=i;G[l];)o+=Ei[G[l++]];return o},cr=void 0,ye=i=>{throw new cr(i)};function Sl(i,o,l={}){var u=o.name;if(i||ye(`type "${u}" must have a positive integer typeid pointer`),Dt.hasOwnProperty(i)){if(l.ignoreDuplicateRegistrations)return;ye(`Cannot register type '${u}' twice`)}if(Dt[i]=o,delete rn[i],or.hasOwnProperty(i)){var p=or[i];delete or[i],p.forEach(v=>v())}}function dt(i,o,l={}){if(!("argPackAdvance"in o))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Sl(i,o,l)}var pt=8,Cl=(i,o,l,u)=>{o=Be(o),dt(i,{name:o,fromWireType:function(p){return!!p},toWireType:function(p,v){return v?l:u},argPackAdvance:pt,readValueFromPointer:function(p){return this.fromWireType(G[p])},destructorFunction:null})};function Nl(i){if(!(this instanceof St)||!(i instanceof St))return!1;for(var o=this.$$.ptrType.registeredClass,l=this.$$.ptr,u=i.$$.ptrType.registeredClass,p=i.$$.ptr;o.baseClass;)l=o.upcast(l),o=o.baseClass;for(;u.baseClass;)p=u.upcast(p),u=u.baseClass;return o===u&&l===p}var Ol=i=>({count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}),Xn=i=>{function o(l){return l.$$.ptrType.registeredClass.name}ye(o(i)+" instance already deleted")},Yn=!1,wi=i=>{},Fl=i=>{i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)},Mi=i=>{i.count.value-=1;var o=i.count.value===0;o&&Fl(i)},_i=(i,o,l)=>{if(o===l)return i;if(l.baseClass===void 0)return null;var u=_i(i,o,l.baseClass);return u===null?null:l.downcast(u)},Ri={},Dl=()=>Object.keys(_r).length,$l=()=>{var i=[];for(var o in _r)_r.hasOwnProperty(o)&&i.push(_r[o]);return i},wr=[],Kn=()=>{for(;wr.length;){var i=wr.pop();i.$$.deleteScheduled=!1,i.delete()}},Mr=void 0,Pl=i=>{Mr=i,wr.length&&Mr&&Mr(Kn)},kl=()=>{r.getInheritedInstanceCount=Dl,r.getLiveInheritedInstances=$l,r.flushPendingDeletes=Kn,r.setDelayFunction=Pl},_r={},Ul=(i,o)=>{for(o===void 0&&ye("ptr should not be undefined");i.baseClass;)o=i.upcast(o),i=i.baseClass;return o},Ll=(i,o)=>(o=Ul(i,o),_r[o]),sn=(i,o)=>{(!o.ptrType||!o.ptr)&&nn("makeClassHandle requires ptr and ptrType");var l=!!o.smartPtrType,u=!!o.smartPtr;return l!==u&&nn("Both smartPtrType and smartPtr must be specified"),o.count={value:1},Rr(Object.create(i,{$$:{value:o}}))};function jl(i){var o=this.getPointee(i);if(!o)return this.destructor(i),null;var l=Ll(this.registeredClass,o);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=o,l.$$.smartPtr=i,l.clone();var u=l.clone();return this.destructor(i),u}function p(){return this.isSmartPointer?sn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:o,smartPtrType:this,smartPtr:i}):sn(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var v=this.registeredClass.getActualType(o),E=Ri[v];if(!E)return p.call(this);var R;this.isConst?R=E.constPointerType:R=E.pointerType;var F=_i(o,this.registeredClass,R.registeredClass);return F===null?p.call(this):this.isSmartPointer?sn(R.registeredClass.instancePrototype,{ptrType:R,ptr:F,smartPtrType:this,smartPtr:i}):sn(R.registeredClass.instancePrototype,{ptrType:R,ptr:F})}var Rr=i=>typeof FinalizationRegistry>"u"?(Rr=o=>o,i):(Yn=new FinalizationRegistry(o=>{Mi(o.$$)}),Rr=o=>{var l=o.$$,u=!!l.smartPtr;if(u){var p={$$:l};Yn.register(o,p,o)}return o},wi=o=>Yn.unregister(o),Rr(i));function Bl(){if(this.$$.ptr||Xn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Rr(Object.create(Object.getPrototypeOf(this),{$$:{value:Ol(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i}function Vl(){this.$$.ptr||Xn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),wi(this),Mi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function zl(){return!this.$$.ptr}function Gl(){return this.$$.ptr||Xn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),wr.push(this),wr.length===1&&Mr&&Mr(Kn),this.$$.deleteScheduled=!0,this}var Hl=()=>{St.prototype.isAliasOf=Nl,St.prototype.clone=Bl,St.prototype.delete=Vl,St.prototype.isDeleted=zl,St.prototype.deleteLater=Gl};function St(){}var ql=48,Wl=57,an=i=>{if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var o=i.charCodeAt(0);return o>=ql&&o<=Wl?`_${i}`:i};function on(i,o){return i=an(i),{[i]:function(){return o.apply(this,arguments)}}[i]}var bi=(i,o,l)=>{if(i[o].overloadTable===void 0){var u=i[o];i[o]=function(){return i[o].overloadTable.hasOwnProperty(arguments.length)||ye(`Function '${l}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[o].overloadTable})!`),i[o].overloadTable[arguments.length].apply(this,arguments)},i[o].overloadTable=[],i[o].overloadTable[u.argCount]=u}},Jn=(i,o,l)=>{r.hasOwnProperty(i)?((l===void 0||r[i].overloadTable!==void 0&&r[i].overloadTable[l]!==void 0)&&ye(`Cannot register public name '${i}' twice`),bi(r,i,i),r.hasOwnProperty(l)&&ye(`Cannot register multiple overloads of a function with the same number of arguments (${l})!`),r[i].overloadTable[l]=o):(r[i]=o,l!==void 0&&(r[i].numArguments=l))};function Xl(i,o,l,u,p,v,E,R){this.name=i,this.constructor=o,this.instancePrototype=l,this.rawDestructor=u,this.baseClass=p,this.getActualType=v,this.upcast=E,this.downcast=R,this.pureVirtualFunctions=[]}var Zn=(i,o,l)=>{for(;o!==l;)o.upcast||ye(`Expected null or instance of ${l.name}, got an instance of ${o.name}`),i=o.upcast(i),o=o.baseClass;return i};function Yl(i,o){if(o===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;o.$$||ye(`Cannot pass "${rs(o)}" as a ${this.name}`),o.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=Zn(o.$$.ptr,l,this.registeredClass);return u}function Kl(i,o){var l;if(o===null)return this.isReference&&ye(`null is not a valid ${this.name}`),this.isSmartPointer?(l=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,l),l):0;o.$$||ye(`Cannot pass "${rs(o)}" as a ${this.name}`),o.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&o.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);var u=o.$$.ptrType.registeredClass;if(l=Zn(o.$$.ptr,u,this.registeredClass),this.isSmartPointer)switch(o.$$.smartPtr===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:o.$$.smartPtrType===this?l=o.$$.smartPtr:ye(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:l=o.$$.smartPtr;break;case 2:if(o.$$.smartPtrType===this)l=o.$$.smartPtr;else{var p=o.clone();l=this.rawShare(l,Pe.toHandle(()=>p.delete())),i!==null&&i.push(this.rawDestructor,l)}break;default:ye("Unsupporting sharing policy")}return l}function Jl(i,o){if(o===null)return this.isReference&&ye(`null is not a valid ${this.name}`),0;o.$$||ye(`Cannot pass "${rs(o)}" as a ${this.name}`),o.$$.ptr||ye(`Cannot pass deleted object as a pointer of type ${this.name}`),o.$$.ptrType.isConst&&ye(`Cannot convert argument of type ${o.$$.ptrType.name} to parameter type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=Zn(o.$$.ptr,l,this.registeredClass);return u}function Ai(i){return this.fromWireType(U[i>>2])}function Zl(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i}function Ql(i){this.rawDestructor&&this.rawDestructor(i)}var ef=i=>{i!==null&&i.delete()},tf=()=>{wt.prototype.getPointee=Zl,wt.prototype.destructor=Ql,wt.prototype.argPackAdvance=pt,wt.prototype.readValueFromPointer=Ai,wt.prototype.deleteObject=ef,wt.prototype.fromWireType=jl};function wt(i,o,l,u,p,v,E,R,F,D,z){this.name=i,this.registeredClass=o,this.isReference=l,this.isConst=u,this.isSmartPointer=p,this.pointeeType=v,this.sharingPolicy=E,this.rawGetPointee=R,this.rawConstructor=F,this.rawShare=D,this.rawDestructor=z,!p&&o.baseClass===void 0?u?(this.toWireType=Yl,this.destructorFunction=null):(this.toWireType=Jl,this.destructorFunction=null):this.toWireType=Kl}var Ii=(i,o,l)=>{r.hasOwnProperty(i)||nn("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&l!==void 0?r[i].overloadTable[l]=o:(r[i]=o,r[i].argCount=l)},rf=(i,o,l)=>{var u=r["dynCall_"+i];return l&&l.length?u.apply(null,[o].concat(l)):u.call(null,o)},br=[],ae=i=>{var o=br[i];return o||(i>=br.length&&(br.length=i+1),br[i]=o=ge.get(i)),o},nf=(i,o,l)=>{if(i.includes("j"))return rf(i,o,l);var u=ae(o).apply(null,l);return u},sf=(i,o)=>{var l=[];return function(){return l.length=0,Object.assign(l,arguments),nf(i,o,l)}},lt=(i,o)=>{i=Be(i);function l(){return i.includes("j")?sf(i,o):ae(o)}var u=l();return typeof u!="function"&&ye(`unknown function pointer with signature ${i}: ${o}`),u},af=(i,o)=>{var l=on(o,function(u){this.name=o,this.message=u;var p=new Error(u).stack;p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},l},Si=void 0,Ci=i=>{var o=zi(i),l=Be(o);return _t(o),l},cn=(i,o)=>{var l=[],u={};function p(v){if(!u[v]&&!Dt[v]){if(rn[v]){rn[v].forEach(p);return}l.push(v),u[v]=!0}}throw o.forEach(p),new Si(`${i}: `+l.map(Ci).join([", "]))},of=(i,o,l,u,p,v,E,R,F,D,z,Y,q)=>{z=Be(z),v=lt(p,v),R&&(R=lt(E,R)),D&&(D=lt(F,D)),q=lt(Y,q);var W=an(z);Jn(W,function(){cn(`Cannot construct ${z} due to unbound types`,[u])}),$t([i,o,l],u?[u]:[],function(Z){Z=Z[0];var he,me;u?(he=Z.registeredClass,me=he.instancePrototype):me=St.prototype;var C=on(W,function(){if(Object.getPrototypeOf(this)!==I)throw new cr("Use 'new' to construct "+z);if($.constructor_body===void 0)throw new cr(z+" has no accessible constructor");var ue=$.constructor_body[arguments.length];if(ue===void 0)throw new cr(`Tried to invoke ctor of ${z} with invalid number of parameters (${arguments.length}) - expected (${Object.keys($.constructor_body).toString()}) parameters instead!`);return ue.apply(this,arguments)}),I=Object.create(me,{constructor:{value:C}});C.prototype=I;var $=new Xl(z,C,I,q,he,v,R,D);$.baseClass&&($.baseClass.__derivedClasses===void 0&&($.baseClass.__derivedClasses=[]),$.baseClass.__derivedClasses.push($));var j=new wt(z,$,!0,!1,!1),J=new wt(z+"*",$,!1,!1,!1),pe=new wt(z+" const*",$,!1,!0,!1);return Ri[i]={pointerType:J,constPointerType:pe},Ii(W,C),[j,J,pe]})},Qn=(i,o)=>{for(var l=[],u=0;u<i;u++)l.push(U[o+u*4>>2]);return l};function Ni(i,o){if(!(i instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof i} which is not a function`);var l=on(i.name||"unknownFunctionName",function(){});l.prototype=i.prototype;var u=new l,p=i.apply(u,o);return p instanceof Object?p:u}function es(i,o,l,u,p,v){var E=o.length;E<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var R=o[1]!==null&&l!==null,F=!1,D=1;D<o.length;++D)if(o[D]!==null&&o[D].destructorFunction===void 0){F=!0;break}for(var z=o[0].name!=="void",Y="",q="",D=0;D<E-2;++D)Y+=(D!==0?", ":"")+"arg"+D,q+=(D!==0?", ":"")+"arg"+D+"Wired";var W=`
        return function ${an(i)}(${Y}) {
        if (arguments.length !== ${E-2}) {
          throwBindingError('function ${i} called with ' + arguments.length + ' arguments, expected ${E-2}');
        }`;F&&(W+=`var destructors = [];
`);var Z=F?"destructors":"null",he=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],me=[ye,u,p,qn,o[0],o[1]];R&&(W+="var thisWired = classParam.toWireType("+Z+`, this);
`);for(var D=0;D<E-2;++D)W+="var arg"+D+"Wired = argType"+D+".toWireType("+Z+", arg"+D+"); // "+o[D+2].name+`
`,he.push("argType"+D),me.push(o[D+2]);if(R&&(q="thisWired"+(q.length>0?", ":"")+q),W+=(z||v?"var rv = ":"")+"invoker(fn"+(q.length>0?", ":"")+q+`);
`,F)W+=`runDestructors(destructors);
`;else for(var D=R?1:2;D<o.length;++D){var C=D===1?"thisWired":"arg"+(D-2)+"Wired";o[D].destructorFunction!==null&&(W+=C+"_dtor("+C+"); // "+o[D].name+`
`,he.push(C+"_dtor"),me.push(o[D].destructorFunction))}return z&&(W+=`var ret = retType.fromWireType(rv);
return ret;
`),W+=`}
`,he.push(W),Ni(Function,he).apply(null,me)}var cf=(i,o,l,u,p,v)=>{var E=Qn(o,l);p=lt(u,p),$t([],[i],function(R){R=R[0];var F=`constructor ${R.name}`;if(R.registeredClass.constructor_body===void 0&&(R.registeredClass.constructor_body=[]),R.registeredClass.constructor_body[o-1]!==void 0)throw new cr(`Cannot register multiple constructors with identical number of parameters (${o-1}) for class '${R.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return R.registeredClass.constructor_body[o-1]=()=>{cn(`Cannot construct ${R.name} due to unbound types`,E)},$t([],E,D=>(D.splice(1,0,null),R.registeredClass.constructor_body[o-1]=es(F,D,null,p,v),[])),[]})},lf=(i,o,l,u,p,v,E,R,F)=>{var D=Qn(l,u);o=Be(o),v=lt(p,v),$t([],[i],function(z){z=z[0];var Y=`${z.name}.${o}`;o.startsWith("@@")&&(o=Symbol[o.substring(2)]),R&&z.registeredClass.pureVirtualFunctions.push(o);function q(){cn(`Cannot call ${Y} due to unbound types`,D)}var W=z.registeredClass.instancePrototype,Z=W[o];return Z===void 0||Z.overloadTable===void 0&&Z.className!==z.name&&Z.argCount===l-2?(q.argCount=l-2,q.className=z.name,W[o]=q):(bi(W,o,Y),W[o].overloadTable[l-2]=q),$t([],D,function(he){var me=es(Y,he,z,v,E,F);return W[o].overloadTable===void 0?(me.argCount=l-2,W[o]=me):W[o].overloadTable[l-2]=me,[]}),[]})};function ff(){Object.assign(Oi.prototype,{get(i){return this.allocated[i]},has(i){return this.allocated[i]!==void 0},allocate(i){var o=this.freelist.pop()||this.allocated.length;return this.allocated[o]=i,o},free(i){this.allocated[i]=void 0,this.freelist.push(i)}})}function Oi(){this.allocated=[void 0],this.freelist=[]}var nt=new Oi,ts=i=>{i>=nt.reserved&&--nt.get(i).refcount===0&&nt.free(i)},uf=()=>{for(var i=0,o=nt.reserved;o<nt.allocated.length;++o)nt.allocated[o]!==void 0&&++i;return i},hf=()=>{nt.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),nt.reserved=nt.allocated.length,r.count_emval_handles=uf},Pe={toValue:i=>(i||ye("Cannot use deleted val. handle = "+i),nt.get(i).value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return nt.allocate({refcount:1,value:i})}}},df=(i,o)=>{o=Be(o),dt(i,{name:o,fromWireType:l=>{var u=Pe.toValue(l);return ts(l),u},toWireType:(l,u)=>Pe.toHandle(u),argPackAdvance:pt,readValueFromPointer:Wn,destructorFunction:null})},pf=(i,o,l)=>{switch(o){case 1:return l?function(u){return this.fromWireType(k[u>>0])}:function(u){return this.fromWireType(G[u>>0])};case 2:return l?function(u){return this.fromWireType(H[u>>1])}:function(u){return this.fromWireType(K[u>>1])};case 4:return l?function(u){return this.fromWireType(L[u>>2])}:function(u){return this.fromWireType(U[u>>2])};default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},gf=(i,o,l,u)=>{o=Be(o);function p(){}p.values={},dt(i,{name:o,constructor:p,fromWireType:function(v){return this.constructor.values[v]},toWireType:(v,E)=>E.value,argPackAdvance:pt,readValueFromPointer:pf(o,l,u),destructorFunction:null}),Jn(o,p)},ln=(i,o)=>{var l=Dt[i];return l===void 0&&ye(o+" has unknown type "+Ci(i)),l},mf=(i,o,l)=>{var u=ln(i,"enum");o=Be(o);var p=u.constructor,v=Object.create(u.constructor.prototype,{value:{value:l},constructor:{value:on(`${u.name}_${o}`,function(){})}});p.values[l]=v,p[o]=v},rs=i=>{if(i===null)return"null";var o=typeof i;return o==="object"||o==="array"||o==="function"?i.toString():""+i},vf=(i,o)=>{switch(o){case 4:return function(l){return this.fromWireType(ee[l>>2])};case 8:return function(l){return this.fromWireType(fe[l>>3])};default:throw new TypeError(`invalid float width (${o}): ${i}`)}},yf=(i,o,l)=>{o=Be(o),dt(i,{name:o,fromWireType:u=>u,toWireType:(u,p)=>p,argPackAdvance:pt,readValueFromPointer:vf(o,l),destructorFunction:null})},xf=(i,o,l,u,p,v,E)=>{var R=Qn(o,l);i=Be(i),p=lt(u,p),Jn(i,function(){cn(`Cannot call ${i} due to unbound types`,R)},o-1),$t([],R,function(F){var D=[F[0],null].concat(F.slice(1));return Ii(i,es(i,D,null,p,v,E),o-1),[]})},Tf=(i,o,l)=>{switch(o){case 1:return l?u=>k[u>>0]:u=>G[u>>0];case 2:return l?u=>H[u>>1]:u=>K[u>>1];case 4:return l?u=>L[u>>2]:u=>U[u>>2];default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},Ef=(i,o,l,u,p)=>{o=Be(o);var v=z=>z;if(u===0){var E=32-8*l;v=z=>z<<E>>>E}var R=o.includes("unsigned"),F=(z,Y)=>{},D;R?D=function(z,Y){return F(Y,this.name),Y>>>0}:D=function(z,Y){return F(Y,this.name),Y},dt(i,{name:o,fromWireType:v,toWireType:D,argPackAdvance:pt,readValueFromPointer:Tf(o,l,u!==0),destructorFunction:null})},wf=(i,o,l)=>{var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],p=u[o];function v(E){var R=U[E>>2],F=U[E+4>>2];return new p(k.buffer,F,R)}l=Be(l),dt(i,{name:l,fromWireType:v,argPackAdvance:pt,readValueFromPointer:v},{ignoreDuplicateRegistrations:!0})},ns=(i,o,l,u)=>{if(!(u>0))return 0;for(var p=l,v=l+u-1,E=0;E<i.length;++E){var R=i.charCodeAt(E);if(R>=55296&&R<=57343){var F=i.charCodeAt(++E);R=65536+((R&1023)<<10)|F&1023}if(R<=127){if(l>=v)break;o[l++]=R}else if(R<=2047){if(l+1>=v)break;o[l++]=192|R>>6,o[l++]=128|R&63}else if(R<=65535){if(l+2>=v)break;o[l++]=224|R>>12,o[l++]=128|R>>6&63,o[l++]=128|R&63}else{if(l+3>=v)break;o[l++]=240|R>>18,o[l++]=128|R>>12&63,o[l++]=128|R>>6&63,o[l++]=128|R&63}}return o[l]=0,l-p},Mf=(i,o,l)=>ns(i,G,o,l),ss=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++l):o+=3}return o},Fi=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,lr=(i,o,l)=>{for(var u=o+l,p=o;i[p]&&!(p>=u);)++p;if(p-o>16&&i.buffer&&Fi)return Fi.decode(i.subarray(o,p));for(var v="";o<p;){var E=i[o++];if(!(E&128)){v+=String.fromCharCode(E);continue}var R=i[o++]&63;if((E&224)==192){v+=String.fromCharCode((E&31)<<6|R);continue}var F=i[o++]&63;if((E&240)==224?E=(E&15)<<12|R<<6|F:E=(E&7)<<18|R<<12|F<<6|i[o++]&63,E<65536)v+=String.fromCharCode(E);else{var D=E-65536;v+=String.fromCharCode(55296|D>>10,56320|D&1023)}}return v},fn=(i,o)=>i?lr(G,i,o):"",_f=(i,o)=>{o=Be(o);var l=o==="std::string";dt(i,{name:o,fromWireType:u=>{var p=U[u>>2],v=u+4,E;if(l)for(var R=v,F=0;F<=p;++F){var D=v+F;if(F==p||G[D]==0){var z=D-R,Y=fn(R,z);E===void 0?E=Y:(E+=String.fromCharCode(0),E+=Y),R=D+1}}else{for(var q=new Array(p),F=0;F<p;++F)q[F]=String.fromCharCode(G[v+F]);E=q.join("")}return _t(u),E},toWireType:(u,p)=>{p instanceof ArrayBuffer&&(p=new Uint8Array(p));var v,E=typeof p=="string";E||p instanceof Uint8Array||p instanceof Uint8ClampedArray||p instanceof Int8Array||ye("Cannot pass non-string to std::string"),l&&E?v=ss(p):v=p.length;var R=fs(4+v+1),F=R+4;if(U[R>>2]=v,l&&E)Mf(p,F,v+1);else if(E)for(var D=0;D<v;++D){var z=p.charCodeAt(D);z>255&&(_t(F),ye("String has UTF-16 code units that do not fit in 8 bits")),G[F+D]=z}else for(var D=0;D<v;++D)G[F+D]=p[D];return u!==null&&u.push(_t,R),R},argPackAdvance:pt,readValueFromPointer:Ai,destructorFunction:u=>_t(u)})},Di=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Rf=(i,o)=>{for(var l=i,u=l>>1,p=u+o/2;!(u>=p)&&K[u];)++u;if(l=u<<1,l-i>32&&Di)return Di.decode(G.subarray(i,l));for(var v="",E=0;!(E>=o/2);++E){var R=H[i+E*2>>1];if(R==0)break;v+=String.fromCharCode(R)}return v},bf=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var u=o,p=l<i.length*2?l/2:i.length,v=0;v<p;++v){var E=i.charCodeAt(v);H[o>>1]=E,o+=2}return H[o>>1]=0,o-u},Af=i=>i.length*2,If=(i,o)=>{for(var l=0,u="";!(l>=o/4);){var p=L[i+l*4>>2];if(p==0)break;if(++l,p>=65536){var v=p-65536;u+=String.fromCharCode(55296|v>>10,56320|v&1023)}else u+=String.fromCharCode(p)}return u},Sf=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<4)return 0;for(var u=o,p=u+l-4,v=0;v<i.length;++v){var E=i.charCodeAt(v);if(E>=55296&&E<=57343){var R=i.charCodeAt(++v);E=65536+((E&1023)<<10)|R&1023}if(L[o>>2]=E,o+=4,o+4>p)break}return L[o>>2]=0,o-u},Cf=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u>=55296&&u<=57343&&++l,o+=4}return o},Nf=(i,o,l)=>{l=Be(l);var u,p,v,E,R;o===2?(u=Rf,p=bf,E=Af,v=()=>K,R=1):o===4&&(u=If,p=Sf,E=Cf,v=()=>U,R=2),dt(i,{name:l,fromWireType:F=>{for(var D=U[F>>2],z=v(),Y,q=F+4,W=0;W<=D;++W){var Z=F+4+W*o;if(W==D||z[Z>>R]==0){var he=Z-q,me=u(q,he);Y===void 0?Y=me:(Y+=String.fromCharCode(0),Y+=me),q=Z+o}}return _t(F),Y},toWireType:(F,D)=>{typeof D!="string"&&ye(`Cannot pass non-string to C++ string type ${l}`);var z=E(D),Y=fs(4+z+o);return U[Y>>2]=z>>R,p(D,Y+4,z+o),F!==null&&F.push(_t,Y),Y},argPackAdvance:pt,readValueFromPointer:Wn,destructorFunction:F=>_t(F)})},Of=(i,o,l,u,p,v)=>{tn[i]={name:Be(o),rawConstructor:lt(l,u),rawDestructor:lt(p,v),fields:[]}},Ff=(i,o,l,u,p,v,E,R,F,D)=>{tn[i].fields.push({fieldName:Be(o),getterReturnType:l,getter:lt(u,p),getterContext:v,setterArgumentType:E,setter:lt(R,F),setterContext:D})},Df=(i,o)=>{o=Be(o),dt(i,{isVoid:!0,name:o,argPackAdvance:0,fromWireType:()=>{},toWireType:(l,u)=>{}})},$f=(i,o,l)=>{i=Pe.toValue(i),o=ln(o,"emval::as");var u=[],p=Pe.toHandle(u);return U[l>>2]=p,o.toWireType(u,i)},Pf=i=>{var o=[];return U[i>>2]=Pe.toHandle(o),o},kf={},is=i=>{var o=kf[i];return o===void 0?Be(i):o},un=[],Uf=(i,o,l,u,p)=>(i=un[i],o=Pe.toValue(o),l=is(l),i(o,l,Pf(u),p)),Lf=(i,o,l,u)=>{i=un[i],o=Pe.toValue(o),l=is(l),i(o,l,null,u)},jf=(i,o)=>(i=Pe.toValue(i),o=Pe.toValue(o),i==o),Bf=i=>{var o=un.length;return un.push(i),o},Vf=(i,o)=>{for(var l=new Array(i),u=0;u<i;++u)l[u]=ln(U[o+u*4>>2],"parameter "+u);return l},$i=[],zf=(i,o)=>{var l=Vf(i,o),u=l[0],p=u.name+"_$"+l.slice(1).map(function(Z){return Z.name}).join("_")+"$",v=$i[p];if(v!==void 0)return v;for(var E=["retType"],R=[u],F="",D=0;D<i-1;++D)F+=(D!==0?", ":"")+"arg"+D,E.push("argType"+D),R.push(l[1+D]);for(var z=an("methodCaller_"+p),Y="return function "+z+`(handle, name, destructors, args) {
`,q=0,D=0;D<i-1;++D)Y+="    var arg"+D+" = argType"+D+".readValueFromPointer(args"+(q?"+"+q:"")+`);
`,q+=l[D+1].argPackAdvance;Y+="    var rv = handle[name]("+F+`);
`;for(var D=0;D<i-1;++D)l[D+1].deleteObject&&(Y+="    argType"+D+".deleteObject(arg"+D+`);
`);u.isVoid||(Y+=`    return retType.toWireType(destructors, rv);
`),Y+=`};
`,E.push(Y);var W=Ni(Function,E).apply(null,R);return v=Bf(W),$i[p]=v,v},Gf=(i,o)=>(i=Pe.toValue(i),o=Pe.toValue(o),Pe.toHandle(i[o])),Hf=i=>{i>4&&(nt.get(i).refcount+=1)},qf=i=>Pe.toHandle(is(i)),Wf=()=>Pe.toHandle({}),Xf=i=>{var o=Pe.toValue(i);qn(o),ts(i)},Yf=(i,o,l)=>{i=Pe.toValue(i),o=Pe.toValue(o),l=Pe.toValue(l),i[o]=l},Kf=(i,o)=>{i=ln(i,"_emval_take_value");var l=i.readValueFromPointer(o);return Pe.toHandle(l)},Jf=()=>{Ve("")},Zf=(i,o,l)=>G.copyWithin(i,o,o+l),Qf=()=>2147483648,eu=i=>{var o=P.buffer,l=(i-o.byteLength+65535)/65536;try{return P.grow(l),ie(),1}catch{}},tu=i=>{var o=G.length;i>>>=0;var l=Qf();if(i>l)return!1;for(var u=(F,D)=>F+(D-F%D)%D,p=1;p<=4;p*=2){var v=o*(1+.2/p);v=Math.min(v,i+100663296);var E=Math.min(l,u(Math.max(i,v),65536)),R=eu(E);if(R)return!0}return!1},as={},ru=()=>f||"./this.program",Ar=()=>{if(!Ar.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:ru()};for(var l in as)as[l]===void 0?delete o[l]:o[l]=as[l];var u=[];for(var l in o)u.push(`${l}=${o[l]}`);Ar.strings=u}return Ar.strings},nu=(i,o)=>{for(var l=0;l<i.length;++l)k[o++>>0]=i.charCodeAt(l);k[o>>0]=0},Ee={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(i).slice(1)},normalizeArray:(i,o)=>{for(var l=0,u=i.length-1;u>=0;u--){var p=i[u];p==="."?i.splice(u,1):p===".."?(i.splice(u,1),l++):l&&(i.splice(u,1),l--)}if(o)for(;l;l--)i.unshift("..");return i},normalize:i=>{var o=Ee.isAbs(i),l=i.substr(-1)==="/";return i=Ee.normalizeArray(i.split("/").filter(u=>!!u),!o).join("/"),!i&&!o&&(i="."),i&&l&&(i+="/"),(o?"/":"")+i},dirname:i=>{var o=Ee.splitPath(i),l=o[0],u=o[1];return!l&&!u?".":(u&&(u=u.substr(0,u.length-1)),l+u)},basename:i=>{if(i==="/")return"/";i=Ee.normalize(i),i=i.replace(/\/$/,"");var o=i.lastIndexOf("/");return o===-1?i:i.substr(o+1)},join:function(){var i=Array.prototype.slice.call(arguments);return Ee.normalize(i.join("/"))},join2:(i,o)=>Ee.normalize(i+"/"+o)},su=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(g)try{var i=m("crypto"),o=i.randomFillSync;if(o)return u=>i.randomFillSync(u);var l=i.randomBytes;return u=>(u.set(l(u.byteLength)),u)}catch{}Ve("initRandomDevice")},Pi=i=>(Pi=su())(i),Mt={resolve:function(){for(var i="",o=!1,l=arguments.length-1;l>=-1&&!o;l--){var u=l>=0?arguments[l]:y.cwd();if(typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";i=u+"/"+i,o=Ee.isAbs(u)}return i=Ee.normalizeArray(i.split("/").filter(p=>!!p),!o).join("/"),(o?"/":"")+i||"."},relative:(i,o)=>{i=Mt.resolve(i).substr(1),o=Mt.resolve(o).substr(1);function l(D){for(var z=0;z<D.length&&D[z]==="";z++);for(var Y=D.length-1;Y>=0&&D[Y]==="";Y--);return z>Y?[]:D.slice(z,Y-z+1)}for(var u=l(i.split("/")),p=l(o.split("/")),v=Math.min(u.length,p.length),E=v,R=0;R<v;R++)if(u[R]!==p[R]){E=R;break}for(var F=[],R=E;R<u.length;R++)F.push("..");return F=F.concat(p.slice(E)),F.join("/")}},os=[];function hn(i,o,l){var u=l>0?l:ss(i)+1,p=new Array(u),v=ns(i,p,0,p.length);return o&&(p.length=v),p}var iu=()=>{if(!os.length){var i=null;if(g){var o=256,l=Buffer.alloc(o),u=0,p=process.stdin.fd;try{u=S.readSync(p,l)}catch(v){if(v.toString().includes("EOF"))u=0;else throw v}u>0?i=l.slice(0,u).toString("utf-8"):i=null}else typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`));if(!i)return null;os=hn(i,!0)}return os.shift()},Pt={ttys:[],init(){},shutdown(){},register(i,o){Pt.ttys[i]={input:[],output:[],ops:o},y.registerDevice(i,Pt.stream_ops)},stream_ops:{open(i){var o=Pt.ttys[i.node.rdev];if(!o)throw new y.ErrnoError(43);i.tty=o,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,o,l,u,p){if(!i.tty||!i.tty.ops.get_char)throw new y.ErrnoError(60);for(var v=0,E=0;E<u;E++){var R;try{R=i.tty.ops.get_char(i.tty)}catch{throw new y.ErrnoError(29)}if(R===void 0&&v===0)throw new y.ErrnoError(6);if(R==null)break;v++,o[l+E]=R}return v&&(i.node.timestamp=Date.now()),v},write(i,o,l,u,p){if(!i.tty||!i.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var v=0;v<u;v++)i.tty.ops.put_char(i.tty,o[l+v])}catch{throw new y.ErrnoError(29)}return u&&(i.node.timestamp=Date.now()),v}},default_tty_ops:{get_char(i){return iu()},put_char(i,o){o===null||o===10?(_(lr(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(_(lr(i.output,0)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,o,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,o){o===null||o===10?(b(lr(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(b(lr(i.output,0)),i.output=[])}}},ki=i=>{Ve()},ce={ops_table:null,mount(i){return ce.createNode(null,"/",16895,0)},createNode(i,o,l,u){if(y.isBlkdev(l)||y.isFIFO(l))throw new y.ErrnoError(63);ce.ops_table||(ce.ops_table={dir:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,lookup:ce.node_ops.lookup,mknod:ce.node_ops.mknod,rename:ce.node_ops.rename,unlink:ce.node_ops.unlink,rmdir:ce.node_ops.rmdir,readdir:ce.node_ops.readdir,symlink:ce.node_ops.symlink},stream:{llseek:ce.stream_ops.llseek}},file:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:{llseek:ce.stream_ops.llseek,read:ce.stream_ops.read,write:ce.stream_ops.write,allocate:ce.stream_ops.allocate,mmap:ce.stream_ops.mmap,msync:ce.stream_ops.msync}},link:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,readlink:ce.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:y.chrdev_stream_ops}});var p=y.createNode(i,o,l,u);return y.isDir(p.mode)?(p.node_ops=ce.ops_table.dir.node,p.stream_ops=ce.ops_table.dir.stream,p.contents={}):y.isFile(p.mode)?(p.node_ops=ce.ops_table.file.node,p.stream_ops=ce.ops_table.file.stream,p.usedBytes=0,p.contents=null):y.isLink(p.mode)?(p.node_ops=ce.ops_table.link.node,p.stream_ops=ce.ops_table.link.stream):y.isChrdev(p.mode)&&(p.node_ops=ce.ops_table.chrdev.node,p.stream_ops=ce.ops_table.chrdev.stream),p.timestamp=Date.now(),i&&(i.contents[o]=p,i.timestamp=p.timestamp),p},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,o){var l=i.contents?i.contents.length:0;if(!(l>=o)){var u=1024*1024;o=Math.max(o,l*(l<u?2:1.125)>>>0),l!=0&&(o=Math.max(o,256));var p=i.contents;i.contents=new Uint8Array(o),i.usedBytes>0&&i.contents.set(p.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,o){if(i.usedBytes!=o)if(o==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(o),l&&i.contents.set(l.subarray(0,Math.min(o,i.usedBytes))),i.usedBytes=o}},node_ops:{getattr(i){var o={};return o.dev=y.isChrdev(i.mode)?i.id:1,o.ino=i.id,o.mode=i.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=i.rdev,y.isDir(i.mode)?o.size=4096:y.isFile(i.mode)?o.size=i.usedBytes:y.isLink(i.mode)?o.size=i.link.length:o.size=0,o.atime=new Date(i.timestamp),o.mtime=new Date(i.timestamp),o.ctime=new Date(i.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(i,o){o.mode!==void 0&&(i.mode=o.mode),o.timestamp!==void 0&&(i.timestamp=o.timestamp),o.size!==void 0&&ce.resizeFileStorage(i,o.size)},lookup(i,o){throw y.genericErrors[44]},mknod(i,o,l,u){return ce.createNode(i,o,l,u)},rename(i,o,l){if(y.isDir(i.mode)){var u;try{u=y.lookupNode(o,l)}catch{}if(u)for(var p in u.contents)throw new y.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,o.contents[l]=i,o.timestamp=i.parent.timestamp,i.parent=o},unlink(i,o){delete i.contents[o],i.timestamp=Date.now()},rmdir(i,o){var l=y.lookupNode(i,o);for(var u in l.contents)throw new y.ErrnoError(55);delete i.contents[o],i.timestamp=Date.now()},readdir(i){var o=[".",".."];for(var l in i.contents)i.contents.hasOwnProperty(l)&&o.push(l);return o},symlink(i,o,l){var u=ce.createNode(i,o,41471,0);return u.link=l,u},readlink(i){if(!y.isLink(i.mode))throw new y.ErrnoError(28);return i.link}},stream_ops:{read(i,o,l,u,p){var v=i.node.contents;if(p>=i.node.usedBytes)return 0;var E=Math.min(i.node.usedBytes-p,u);if(E>8&&v.subarray)o.set(v.subarray(p,p+E),l);else for(var R=0;R<E;R++)o[l+R]=v[p+R];return E},write(i,o,l,u,p,v){if(o.buffer===k.buffer&&(v=!1),!u)return 0;var E=i.node;if(E.timestamp=Date.now(),o.subarray&&(!E.contents||E.contents.subarray)){if(v)return E.contents=o.subarray(l,l+u),E.usedBytes=u,u;if(E.usedBytes===0&&p===0)return E.contents=o.slice(l,l+u),E.usedBytes=u,u;if(p+u<=E.usedBytes)return E.contents.set(o.subarray(l,l+u),p),u}if(ce.expandFileStorage(E,p+u),E.contents.subarray&&o.subarray)E.contents.set(o.subarray(l,l+u),p);else for(var R=0;R<u;R++)E.contents[p+R]=o[l+R];return E.usedBytes=Math.max(E.usedBytes,p+u),u},llseek(i,o,l){var u=o;if(l===1?u+=i.position:l===2&&y.isFile(i.node.mode)&&(u+=i.node.usedBytes),u<0)throw new y.ErrnoError(28);return u},allocate(i,o,l){ce.expandFileStorage(i.node,o+l),i.node.usedBytes=Math.max(i.node.usedBytes,o+l)},mmap(i,o,l,u,p){if(!y.isFile(i.node.mode))throw new y.ErrnoError(43);var v,E,R=i.node.contents;if(!(p&2)&&R.buffer===k.buffer)E=!1,v=R.byteOffset;else{if((l>0||l+o<R.length)&&(R.subarray?R=R.subarray(l,l+o):R=Array.prototype.slice.call(R,l,l+o)),E=!0,v=ki(),!v)throw new y.ErrnoError(48);k.set(R,v)}return{ptr:v,allocated:E}},msync(i,o,l,u,p){return ce.stream_ops.write(i,o,0,u,l,!1),0}}},au=(i,o,l,u)=>{var p=u?"":`al ${i}`;A(i,v=>{B(v,`Loading data file "${i}" failed (no arrayBuffer).`),o(new Uint8Array(v)),p&&xt()},v=>{if(l)l();else throw`Loading data file "${i}" failed.`}),p&&He()},ou=r.preloadPlugins||[],cu=(i,o,l,u)=>{typeof Browser<"u"&&Browser.init();var p=!1;return ou.forEach(v=>{p||v.canHandle(o)&&(v.handle(i,o,l,u),p=!0)}),p},lu=(i,o,l,u,p,v,E,R,F,D)=>{var z=o?Mt.resolve(Ee.join2(i,o)):i;function Y(q){function W(Z){D&&D(),R||y.createDataFile(i,o,Z,u,p,F),v&&v(),xt()}cu(q,z,W,()=>{E&&E(),xt()})||W(q)}He(),typeof l=="string"?au(l,q=>Y(q),E):Y(l)},fu=i=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=o[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},cs=(i,o)=>{var l=0;return i&&(l|=365),o&&(l|=146),l},y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(i,o={}){if(i=Mt.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(o=Object.assign(l,o),o.recurse_count>8)throw new y.ErrnoError(32);for(var u=i.split("/").filter(Y=>!!Y),p=y.root,v="/",E=0;E<u.length;E++){var R=E===u.length-1;if(R&&o.parent)break;if(p=y.lookupNode(p,u[E]),v=Ee.join2(v,u[E]),y.isMountpoint(p)&&(!R||R&&o.follow_mount)&&(p=p.mounted.root),!R||o.follow)for(var F=0;y.isLink(p.mode);){var D=y.readlink(v);v=Mt.resolve(Ee.dirname(v),D);var z=y.lookupPath(v,{recurse_count:o.recurse_count+1});if(p=z.node,F++>40)throw new y.ErrnoError(32)}}return{path:v,node:p}},getPath(i){for(var o;;){if(y.isRoot(i)){var l=i.mount.mountpoint;return o?l[l.length-1]!=="/"?`${l}/${o}`:l+o:l}o=o?`${i.name}/${o}`:i.name,i=i.parent}},hashName(i,o){for(var l=0,u=0;u<o.length;u++)l=(l<<5)-l+o.charCodeAt(u)|0;return(i+l>>>0)%y.nameTable.length},hashAddNode(i){var o=y.hashName(i.parent.id,i.name);i.name_next=y.nameTable[o],y.nameTable[o]=i},hashRemoveNode(i){var o=y.hashName(i.parent.id,i.name);if(y.nameTable[o]===i)y.nameTable[o]=i.name_next;else for(var l=y.nameTable[o];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,o){var l=y.mayLookup(i);if(l)throw new y.ErrnoError(l,i);for(var u=y.hashName(i.id,o),p=y.nameTable[u];p;p=p.name_next){var v=p.name;if(p.parent.id===i.id&&v===o)return p}return y.lookup(i,o)},createNode(i,o,l,u){var p=new y.FSNode(i,o,l,u);return y.hashAddNode(p),p},destroyNode(i){y.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var o=["r","w","rw"][i&3];return i&512&&(o+="w"),o},nodePermissions(i,o){return y.ignorePermissions?0:o.includes("r")&&!(i.mode&292)||o.includes("w")&&!(i.mode&146)||o.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){var o=y.nodePermissions(i,"x");return o||(i.node_ops.lookup?0:2)},mayCreate(i,o){try{var l=y.lookupNode(i,o);return 20}catch{}return y.nodePermissions(i,"wx")},mayDelete(i,o,l){var u;try{u=y.lookupNode(i,o)}catch(v){return v.errno}var p=y.nodePermissions(i,"wx");if(p)return p;if(l){if(!y.isDir(u.mode))return 54;if(y.isRoot(u)||y.getPath(u)===y.cwd())return 10}else if(y.isDir(u.mode))return 31;return 0},mayOpen(i,o){return i?y.isLink(i.mode)?32:y.isDir(i.mode)&&(y.flagsToPermissionString(o)!=="r"||o&512)?31:y.nodePermissions(i,y.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=y.MAX_OPEN_FDS;i++)if(!y.streams[i])return i;throw new y.ErrnoError(33)},getStreamChecked(i){var o=y.getStream(i);if(!o)throw new y.ErrnoError(8);return o},getStream:i=>y.streams[i],createStream(i,o=-1){return y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get(){return this.node},set(l){this.node=l}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(l){this.shared.flags=l}},position:{get(){return this.shared.position},set(l){this.shared.position=l}}})),i=Object.assign(new y.FSStream,i),o==-1&&(o=y.nextfd()),i.fd=o,y.streams[o]=i,i},closeStream(i){y.streams[i]=null},chrdev_stream_ops:{open(i){var o=y.getDevice(i.node.rdev);i.stream_ops=o.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek(){throw new y.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,o)=>i<<8|o,registerDevice(i,o){y.devices[i]={stream_ops:o}},getDevice:i=>y.devices[i],getMounts(i){for(var o=[],l=[i];l.length;){var u=l.pop();o.push(u),l.push.apply(l,u.mounts)}return o},syncfs(i,o){typeof i=="function"&&(o=i,i=!1),y.syncFSRequests++,y.syncFSRequests>1&&b(`warning: ${y.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=y.getMounts(y.root.mount),u=0;function p(E){return y.syncFSRequests--,o(E)}function v(E){if(E)return v.errored?void 0:(v.errored=!0,p(E));++u>=l.length&&p(null)}l.forEach(E=>{if(!E.type.syncfs)return v(null);E.type.syncfs(E,i,v)})},mount(i,o,l){var u=l==="/",p=!l,v;if(u&&y.root)throw new y.ErrnoError(10);if(!u&&!p){var E=y.lookupPath(l,{follow_mount:!1});if(l=E.path,v=E.node,y.isMountpoint(v))throw new y.ErrnoError(10);if(!y.isDir(v.mode))throw new y.ErrnoError(54)}var R={type:i,opts:o,mountpoint:l,mounts:[]},F=i.mount(R);return F.mount=R,R.root=F,u?y.root=F:v&&(v.mounted=R,v.mount&&v.mount.mounts.push(R)),F},unmount(i){var o=y.lookupPath(i,{follow_mount:!1});if(!y.isMountpoint(o.node))throw new y.ErrnoError(28);var l=o.node,u=l.mounted,p=y.getMounts(u);Object.keys(y.nameTable).forEach(E=>{for(var R=y.nameTable[E];R;){var F=R.name_next;p.includes(R.mount)&&y.destroyNode(R),R=F}}),l.mounted=null;var v=l.mount.mounts.indexOf(u);l.mount.mounts.splice(v,1)},lookup(i,o){return i.node_ops.lookup(i,o)},mknod(i,o,l){var u=y.lookupPath(i,{parent:!0}),p=u.node,v=Ee.basename(i);if(!v||v==="."||v==="..")throw new y.ErrnoError(28);var E=y.mayCreate(p,v);if(E)throw new y.ErrnoError(E);if(!p.node_ops.mknod)throw new y.ErrnoError(63);return p.node_ops.mknod(p,v,o,l)},create(i,o){return o=o!==void 0?o:438,o&=4095,o|=32768,y.mknod(i,o,0)},mkdir(i,o){return o=o!==void 0?o:511,o&=1023,o|=16384,y.mknod(i,o,0)},mkdirTree(i,o){for(var l=i.split("/"),u="",p=0;p<l.length;++p)if(l[p]){u+="/"+l[p];try{y.mkdir(u,o)}catch(v){if(v.errno!=20)throw v}}},mkdev(i,o,l){return typeof l>"u"&&(l=o,o=438),o|=8192,y.mknod(i,o,l)},symlink(i,o){if(!Mt.resolve(i))throw new y.ErrnoError(44);var l=y.lookupPath(o,{parent:!0}),u=l.node;if(!u)throw new y.ErrnoError(44);var p=Ee.basename(o),v=y.mayCreate(u,p);if(v)throw new y.ErrnoError(v);if(!u.node_ops.symlink)throw new y.ErrnoError(63);return u.node_ops.symlink(u,p,i)},rename(i,o){var l=Ee.dirname(i),u=Ee.dirname(o),p=Ee.basename(i),v=Ee.basename(o),E,R,F;if(E=y.lookupPath(i,{parent:!0}),R=E.node,E=y.lookupPath(o,{parent:!0}),F=E.node,!R||!F)throw new y.ErrnoError(44);if(R.mount!==F.mount)throw new y.ErrnoError(75);var D=y.lookupNode(R,p),z=Mt.relative(i,u);if(z.charAt(0)!==".")throw new y.ErrnoError(28);if(z=Mt.relative(o,l),z.charAt(0)!==".")throw new y.ErrnoError(55);var Y;try{Y=y.lookupNode(F,v)}catch{}if(D!==Y){var q=y.isDir(D.mode),W=y.mayDelete(R,p,q);if(W)throw new y.ErrnoError(W);if(W=Y?y.mayDelete(F,v,q):y.mayCreate(F,v),W)throw new y.ErrnoError(W);if(!R.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(D)||Y&&y.isMountpoint(Y))throw new y.ErrnoError(10);if(F!==R&&(W=y.nodePermissions(R,"w"),W))throw new y.ErrnoError(W);y.hashRemoveNode(D);try{R.node_ops.rename(D,F,v)}catch(Z){throw Z}finally{y.hashAddNode(D)}}},rmdir(i){var o=y.lookupPath(i,{parent:!0}),l=o.node,u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!0);if(v)throw new y.ErrnoError(v);if(!l.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.rmdir(l,u),y.destroyNode(p)},readdir(i){var o=y.lookupPath(i,{follow:!0}),l=o.node;if(!l.node_ops.readdir)throw new y.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var o=y.lookupPath(i,{parent:!0}),l=o.node;if(!l)throw new y.ErrnoError(44);var u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!1);if(v)throw new y.ErrnoError(v);if(!l.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.unlink(l,u),y.destroyNode(p)},readlink(i){var o=y.lookupPath(i),l=o.node;if(!l)throw new y.ErrnoError(44);if(!l.node_ops.readlink)throw new y.ErrnoError(28);return Mt.resolve(y.getPath(l.parent),l.node_ops.readlink(l))},stat(i,o){var l=y.lookupPath(i,{follow:!o}),u=l.node;if(!u)throw new y.ErrnoError(44);if(!u.node_ops.getattr)throw new y.ErrnoError(63);return u.node_ops.getattr(u)},lstat(i){return y.stat(i,!0)},chmod(i,o,l){var u;if(typeof i=="string"){var p=y.lookupPath(i,{follow:!l});u=p.node}else u=i;if(!u.node_ops.setattr)throw new y.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(i,o){y.chmod(i,o,!0)},fchmod(i,o){var l=y.getStreamChecked(i);y.chmod(l.node,o)},chown(i,o,l,u){var p;if(typeof i=="string"){var v=y.lookupPath(i,{follow:!u});p=v.node}else p=i;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown(i,o,l){y.chown(i,o,l,!0)},fchown(i,o,l){var u=y.getStreamChecked(i);y.chown(u.node,o,l)},truncate(i,o){if(o<0)throw new y.ErrnoError(28);var l;if(typeof i=="string"){var u=y.lookupPath(i,{follow:!0});l=u.node}else l=i;if(!l.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(l.mode))throw new y.ErrnoError(31);if(!y.isFile(l.mode))throw new y.ErrnoError(28);var p=y.nodePermissions(l,"w");if(p)throw new y.ErrnoError(p);l.node_ops.setattr(l,{size:o,timestamp:Date.now()})},ftruncate(i,o){var l=y.getStreamChecked(i);if(!(l.flags&2097155))throw new y.ErrnoError(28);y.truncate(l.node,o)},utime(i,o,l){var u=y.lookupPath(i,{follow:!0}),p=u.node;p.node_ops.setattr(p,{timestamp:Math.max(o,l)})},open(i,o,l){if(i==="")throw new y.ErrnoError(44);o=typeof o=="string"?fu(o):o,l=typeof l>"u"?438:l,o&64?l=l&4095|32768:l=0;var u;if(typeof i=="object")u=i;else{i=Ee.normalize(i);try{var p=y.lookupPath(i,{follow:!(o&131072)});u=p.node}catch{}}var v=!1;if(o&64)if(u){if(o&128)throw new y.ErrnoError(20)}else u=y.mknod(i,l,0),v=!0;if(!u)throw new y.ErrnoError(44);if(y.isChrdev(u.mode)&&(o&=-513),o&65536&&!y.isDir(u.mode))throw new y.ErrnoError(54);if(!v){var E=y.mayOpen(u,o);if(E)throw new y.ErrnoError(E)}o&512&&!v&&y.truncate(u,0),o&=-131713;var R=y.createStream({node:u,path:y.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return R.stream_ops.open&&R.stream_ops.open(R),r.logReadFiles&&!(o&1)&&(y.readFiles||(y.readFiles={}),i in y.readFiles||(y.readFiles[i]=1)),R},close(i){if(y.isClosed(i))throw new y.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(o){throw o}finally{y.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new y.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new y.ErrnoError(28);return i.position=i.stream_ops.llseek(i,o,l),i.ungotten=[],i.position},read(i,o,l,u,p){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if((i.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.read)throw new y.ErrnoError(28);var v=typeof p<"u";if(!v)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var E=i.stream_ops.read(i,o,l,u,p);return v||(i.position+=E),E},write(i,o,l,u,p,v){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.write)throw new y.ErrnoError(28);i.seekable&&i.flags&1024&&y.llseek(i,0,2);var E=typeof p<"u";if(!E)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var R=i.stream_ops.write(i,o,l,u,p,v);return E||(i.position+=R),R},allocate(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(o<0||l<=0)throw new y.ErrnoError(28);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(i.node.mode)&&!y.isDir(i.node.mode))throw new y.ErrnoError(43);if(!i.stream_ops.allocate)throw new y.ErrnoError(138);i.stream_ops.allocate(i,o,l)},mmap(i,o,l,u,p){if(u&2&&!(p&2)&&(i.flags&2097155)!==2)throw new y.ErrnoError(2);if((i.flags&2097155)===1)throw new y.ErrnoError(2);if(!i.stream_ops.mmap)throw new y.ErrnoError(43);return i.stream_ops.mmap(i,o,l,u,p)},msync(i,o,l,u,p){return i.stream_ops.msync?i.stream_ops.msync(i,o,l,u,p):0},munmap:i=>0,ioctl(i,o,l){if(!i.stream_ops.ioctl)throw new y.ErrnoError(59);return i.stream_ops.ioctl(i,o,l)},readFile(i,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var l,u=y.open(i,o.flags),p=y.stat(i),v=p.size,E=new Uint8Array(v);return y.read(u,E,0,v,0),o.encoding==="utf8"?l=lr(E,0):o.encoding==="binary"&&(l=E),y.close(u),l},writeFile(i,o,l={}){l.flags=l.flags||577;var u=y.open(i,l.flags,l.mode);if(typeof o=="string"){var p=new Uint8Array(ss(o)+1),v=ns(o,p,0,p.length);y.write(u,p,0,v,void 0,l.canOwn)}else if(ArrayBuffer.isView(o))y.write(u,o,0,o.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");y.close(u)},cwd:()=>y.currentPath,chdir(i){var o=y.lookupPath(i,{follow:!0});if(o.node===null)throw new y.ErrnoError(44);if(!y.isDir(o.node.mode))throw new y.ErrnoError(54);var l=y.nodePermissions(o.node,"x");if(l)throw new y.ErrnoError(l);y.currentPath=o.path},createDefaultDirectories(){y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices(){y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,p,v,E,R)=>E}),y.mkdev("/dev/null",y.makedev(1,3)),Pt.register(y.makedev(5,0),Pt.default_tty_ops),Pt.register(y.makedev(6,0),Pt.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var i=new Uint8Array(1024),o=0,l=()=>(o===0&&(o=Pi(i).byteLength),i[--o]);y.createDevice("/dev","random",l),y.createDevice("/dev","urandom",l),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories(){y.mkdir("/proc");var i=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount(){var o=y.createNode(i,"fd",16895,73);return o.node_ops={lookup(l,u){var p=+u,v=y.getStreamChecked(p),E={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>v.path}};return E.parent=E,E}},o}},{},"/proc/self/fd")},createStandardStreams(){r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError(){y.ErrnoError||(y.ErrnoError=function(o,l){this.name="ErrnoError",this.node=l,this.setErrno=function(u){this.errno=u},this.setErrno(o),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(i=>{y.genericErrors[i]=new y.ErrnoError(i),y.genericErrors[i].stack="<generic error, no stack>"}))},staticInit(){y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(ce,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ce}},init(i,o,l){y.init.initialized=!0,y.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=o||r.stdout,r.stderr=l||r.stderr,y.createStandardStreams()},quit(){y.init.initialized=!1;for(var i=0;i<y.streams.length;i++){var o=y.streams[i];o&&y.close(o)}},findObject(i,o){var l=y.analyzePath(i,o);return l.exists?l.object:null},analyzePath(i,o){try{var l=y.lookupPath(i,{follow:!o});i=l.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=y.lookupPath(i,{parent:!0});u.parentExists=!0,u.parentPath=l.path,u.parentObject=l.node,u.name=Ee.basename(i),l=y.lookupPath(i,{follow:!o}),u.exists=!0,u.path=l.path,u.object=l.node,u.name=l.node.name,u.isRoot=l.path==="/"}catch(p){u.error=p.errno}return u},createPath(i,o,l,u){i=typeof i=="string"?i:y.getPath(i);for(var p=o.split("/").reverse();p.length;){var v=p.pop();if(v){var E=Ee.join2(i,v);try{y.mkdir(E)}catch{}i=E}}return E},createFile(i,o,l,u,p){var v=Ee.join2(typeof i=="string"?i:y.getPath(i),o),E=cs(u,p);return y.create(v,E)},createDataFile(i,o,l,u,p,v){var E=o;i&&(i=typeof i=="string"?i:y.getPath(i),E=o?Ee.join2(i,o):i);var R=cs(u,p),F=y.create(E,R);if(l){if(typeof l=="string"){for(var D=new Array(l.length),z=0,Y=l.length;z<Y;++z)D[z]=l.charCodeAt(z);l=D}y.chmod(F,R|146);var q=y.open(F,577);y.write(q,l,0,l.length,0,v),y.close(q),y.chmod(F,R)}return F},createDevice(i,o,l,u){var p=Ee.join2(typeof i=="string"?i:y.getPath(i),o),v=cs(!!l,!!u);y.createDevice.major||(y.createDevice.major=64);var E=y.makedev(y.createDevice.major++,0);return y.registerDevice(E,{open(R){R.seekable=!1},close(R){u&&u.buffer&&u.buffer.length&&u(10)},read(R,F,D,z,Y){for(var q=0,W=0;W<z;W++){var Z;try{Z=l()}catch{throw new y.ErrnoError(29)}if(Z===void 0&&q===0)throw new y.ErrnoError(6);if(Z==null)break;q++,F[D+W]=Z}return q&&(R.node.timestamp=Date.now()),q},write(R,F,D,z,Y){for(var q=0;q<z;q++)try{u(F[D+q])}catch{throw new y.ErrnoError(29)}return z&&(R.node.timestamp=Date.now()),q}}),y.mkdev(p,v,E)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(M)try{i.contents=hn(M(i.url),!0),i.usedBytes=i.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(i,o,l,u,p){function v(){this.lengthKnown=!1,this.chunks=[]}if(v.prototype.get=function(W){if(!(W>this.length-1||W<0)){var Z=W%this.chunkSize,he=W/this.chunkSize|0;return this.getter(he)[Z]}},v.prototype.setDataGetter=function(W){this.getter=W},v.prototype.cacheLength=function(){var W=new XMLHttpRequest;if(W.open("HEAD",l,!1),W.send(null),!(W.status>=200&&W.status<300||W.status===304))throw new Error("Couldn't load "+l+". Status: "+W.status);var Z=Number(W.getResponseHeader("Content-length")),he,me=(he=W.getResponseHeader("Accept-Ranges"))&&he==="bytes",C=(he=W.getResponseHeader("Content-Encoding"))&&he==="gzip",I=1024*1024;me||(I=Z);var $=(J,pe)=>{if(J>pe)throw new Error("invalid range ("+J+", "+pe+") or no bytes requested!");if(pe>Z-1)throw new Error("only "+Z+" bytes available! programmer error!");var ue=new XMLHttpRequest;if(ue.open("GET",l,!1),Z!==I&&ue.setRequestHeader("Range","bytes="+J+"-"+pe),ue.responseType="arraybuffer",ue.overrideMimeType&&ue.overrideMimeType("text/plain; charset=x-user-defined"),ue.send(null),!(ue.status>=200&&ue.status<300||ue.status===304))throw new Error("Couldn't load "+l+". Status: "+ue.status);return ue.response!==void 0?new Uint8Array(ue.response||[]):hn(ue.responseText||"",!0)},j=this;j.setDataGetter(J=>{var pe=J*I,ue=(J+1)*I-1;if(ue=Math.min(ue,Z-1),typeof j.chunks[J]>"u"&&(j.chunks[J]=$(pe,ue)),typeof j.chunks[J]>"u")throw new Error("doXHR failed!");return j.chunks[J]}),(C||!Z)&&(I=Z=1,Z=this.getter(0).length,I=Z,_("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Z,this._chunkSize=I,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var E=new v;Object.defineProperties(E,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var R={isDevice:!1,contents:E}}else var R={isDevice:!1,url:l};var F=y.createFile(i,o,R,u,p);R.contents?F.contents=R.contents:R.url&&(F.contents=null,F.url=R.url),Object.defineProperties(F,{usedBytes:{get:function(){return this.contents.length}}});var D={},z=Object.keys(F.stream_ops);z.forEach(q=>{var W=F.stream_ops[q];D[q]=function(){return y.forceLoadFile(F),W.apply(null,arguments)}});function Y(q,W,Z,he,me){var C=q.node.contents;if(me>=C.length)return 0;var I=Math.min(C.length-me,he);if(C.slice)for(var $=0;$<I;$++)W[Z+$]=C[me+$];else for(var $=0;$<I;$++)W[Z+$]=C.get(me+$);return I}return D.read=(q,W,Z,he,me)=>(y.forceLoadFile(F),Y(q,W,Z,he,me)),D.mmap=(q,W,Z,he,me)=>{y.forceLoadFile(F);var C=ki();if(!C)throw new y.ErrnoError(48);return Y(q,k,C,W,Z),{ptr:C,allocated:!0}},F.stream_ops=D,F}},Ct={DEFAULT_POLLMASK:5,calculateAt(i,o,l){if(Ee.isAbs(o))return o;var u;if(i===-100)u=y.cwd();else{var p=Ct.getStreamFromFD(i);u=p.path}if(o.length==0){if(!l)throw new y.ErrnoError(44);return u}return Ee.join2(u,o)},doStat(i,o,l){try{var u=i(o)}catch(R){if(R&&R.node&&Ee.normalize(o)!==Ee.normalize(y.getPath(R.node)))return-54;throw R}L[l>>2]=u.dev,L[l+4>>2]=u.mode,U[l+8>>2]=u.nlink,L[l+12>>2]=u.uid,L[l+16>>2]=u.gid,L[l+20>>2]=u.rdev,je=[u.size>>>0,(de=u.size,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+24>>2]=je[0],L[l+28>>2]=je[1],L[l+32>>2]=4096,L[l+36>>2]=u.blocks;var p=u.atime.getTime(),v=u.mtime.getTime(),E=u.ctime.getTime();return je=[Math.floor(p/1e3)>>>0,(de=Math.floor(p/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+40>>2]=je[0],L[l+44>>2]=je[1],U[l+48>>2]=p%1e3*1e3,je=[Math.floor(v/1e3)>>>0,(de=Math.floor(v/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+56>>2]=je[0],L[l+60>>2]=je[1],U[l+64>>2]=v%1e3*1e3,je=[Math.floor(E/1e3)>>>0,(de=Math.floor(E/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+72>>2]=je[0],L[l+76>>2]=je[1],U[l+80>>2]=E%1e3*1e3,je=[u.ino>>>0,(de=u.ino,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+88>>2]=je[0],L[l+92>>2]=je[1],0},doMsync(i,o,l,u,p){if(!y.isFile(o.node.mode))throw new y.ErrnoError(43);if(u&2)return 0;var v=G.slice(i,i+l);y.msync(o,v,p,l,u)},varargs:void 0,get(){var i=L[Ct.varargs>>2];return Ct.varargs+=4,i},getp(){return Ct.get()},getStr(i){var o=fn(i);return o},getStreamFromFD(i){var o=y.getStreamChecked(i);return o}},uu=(i,o)=>{var l=0;return Ar().forEach((u,p)=>{var v=o+l;U[i+p*4>>2]=v,nu(u,v),l+=u.length+1}),0},hu=(i,o)=>{var l=Ar();U[i>>2]=l.length;var u=0;return l.forEach(p=>u+=p.length+1),U[o>>2]=u,0};function du(i){try{var o=Ct.getStreamFromFD(i);return y.close(o),0}catch(l){if(typeof y>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var pu=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var E=U[o>>2],R=U[o+4>>2];o+=8;var F=y.read(i,k,E,R,u);if(F<0)return-1;if(p+=F,F<R)break;typeof u<"u"&&(u+=F)}return p};function gu(i,o,l,u){try{var p=Ct.getStreamFromFD(i),v=pu(p,o,l);return U[u>>2]=v,0}catch(E){if(typeof y>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var mu=(i,o)=>o+2097152>>>0<4194305-!!i?(i>>>0)+o*4294967296:NaN;function vu(i,o,l,u,p){var v=mu(o,l);try{if(isNaN(v))return 61;var E=Ct.getStreamFromFD(i);return y.llseek(E,v,u),je=[E.position>>>0,(de=E.position,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[p>>2]=je[0],L[p+4>>2]=je[1],E.getdents&&v===0&&u===0&&(E.getdents=null),0}catch(R){if(typeof y>"u"||R.name!=="ErrnoError")throw R;return R.errno}}var yu=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var E=U[o>>2],R=U[o+4>>2];o+=8;var F=y.write(i,k,E,R,u);if(F<0)return-1;p+=F,typeof u<"u"&&(u+=F)}return p};function xu(i,o,l,u){try{var p=Ct.getStreamFromFD(i),v=yu(p,o,l);return U[u>>2]=v,0}catch(E){if(typeof y>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var Tu=i=>i,dn=i=>i%4===0&&(i%100!==0||i%400===0),Eu=(i,o)=>{for(var l=0,u=0;u<=o;l+=i[u++]);return l},Ui=[31,29,31,30,31,30,31,31,30,31,30,31],Li=[31,28,31,30,31,30,31,31,30,31,30,31],wu=(i,o)=>{for(var l=new Date(i.getTime());o>0;){var u=dn(l.getFullYear()),p=l.getMonth(),v=(u?Ui:Li)[p];if(o>v-l.getDate())o-=v-l.getDate()+1,l.setDate(1),p<11?l.setMonth(p+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+o),l}return l},Mu=(i,o)=>{k.set(i,o)},_u=(i,o,l,u)=>{var p=U[u+40>>2],v={tm_sec:L[u>>2],tm_min:L[u+4>>2],tm_hour:L[u+8>>2],tm_mday:L[u+12>>2],tm_mon:L[u+16>>2],tm_year:L[u+20>>2],tm_wday:L[u+24>>2],tm_yday:L[u+28>>2],tm_isdst:L[u+32>>2],tm_gmtoff:L[u+36>>2],tm_zone:p?fn(p):""},E=fn(l),R={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var F in R)E=E.replace(new RegExp(F,"g"),R[F]);var D=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],z=["January","February","March","April","May","June","July","August","September","October","November","December"];function Y(I,$,j){for(var J=typeof I=="number"?I.toString():I||"";J.length<$;)J=j[0]+J;return J}function q(I,$){return Y(I,$,"0")}function W(I,$){function j(pe){return pe<0?-1:pe>0?1:0}var J;return(J=j(I.getFullYear()-$.getFullYear()))===0&&(J=j(I.getMonth()-$.getMonth()))===0&&(J=j(I.getDate()-$.getDate())),J}function Z(I){switch(I.getDay()){case 0:return new Date(I.getFullYear()-1,11,29);case 1:return I;case 2:return new Date(I.getFullYear(),0,3);case 3:return new Date(I.getFullYear(),0,2);case 4:return new Date(I.getFullYear(),0,1);case 5:return new Date(I.getFullYear()-1,11,31);case 6:return new Date(I.getFullYear()-1,11,30)}}function he(I){var $=wu(new Date(I.tm_year+1900,0,1),I.tm_yday),j=new Date($.getFullYear(),0,4),J=new Date($.getFullYear()+1,0,4),pe=Z(j),ue=Z(J);return W(pe,$)<=0?W(ue,$)<=0?$.getFullYear()+1:$.getFullYear():$.getFullYear()-1}var me={"%a":I=>D[I.tm_wday].substring(0,3),"%A":I=>D[I.tm_wday],"%b":I=>z[I.tm_mon].substring(0,3),"%B":I=>z[I.tm_mon],"%C":I=>{var $=I.tm_year+1900;return q($/100|0,2)},"%d":I=>q(I.tm_mday,2),"%e":I=>Y(I.tm_mday,2," "),"%g":I=>he(I).toString().substring(2),"%G":I=>he(I),"%H":I=>q(I.tm_hour,2),"%I":I=>{var $=I.tm_hour;return $==0?$=12:$>12&&($-=12),q($,2)},"%j":I=>q(I.tm_mday+Eu(dn(I.tm_year+1900)?Ui:Li,I.tm_mon-1),3),"%m":I=>q(I.tm_mon+1,2),"%M":I=>q(I.tm_min,2),"%n":()=>`
`,"%p":I=>I.tm_hour>=0&&I.tm_hour<12?"AM":"PM","%S":I=>q(I.tm_sec,2),"%t":()=>"	","%u":I=>I.tm_wday||7,"%U":I=>{var $=I.tm_yday+7-I.tm_wday;return q(Math.floor($/7),2)},"%V":I=>{var $=Math.floor((I.tm_yday+7-(I.tm_wday+6)%7)/7);if((I.tm_wday+371-I.tm_yday-2)%7<=2&&$++,$){if($==53){var J=(I.tm_wday+371-I.tm_yday)%7;J!=4&&(J!=3||!dn(I.tm_year))&&($=1)}}else{$=52;var j=(I.tm_wday+7-I.tm_yday-1)%7;(j==4||j==5&&dn(I.tm_year%400-1))&&$++}return q($,2)},"%w":I=>I.tm_wday,"%W":I=>{var $=I.tm_yday+7-(I.tm_wday+6)%7;return q(Math.floor($/7),2)},"%y":I=>(I.tm_year+1900).toString().substring(2),"%Y":I=>I.tm_year+1900,"%z":I=>{var $=I.tm_gmtoff,j=$>=0;return $=Math.abs($)/60,$=$/60*100+$%60,(j?"+":"-")+("0000"+$).slice(-4)},"%Z":I=>I.tm_zone,"%%":()=>"%"};E=E.replace(/%%/g,"\0\0");for(var F in me)E.includes(F)&&(E=E.replace(new RegExp(F,"g"),me[F](v)));E=E.replace(/\0\0/g,"%");var C=hn(E,!1);return C.length>o?0:(Mu(C,i),C.length-1)},Ru=(i,o,l,u,p)=>_u(i,o,l,u),ji=(i,o)=>{i<128?o.push(i):o.push(i%128|128,i>>7)},bu=i=>{for(var o={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[o[i[0]]]},u=1;u<i.length;++u)l.parameters.push(o[i[u]]);return l},Au=(i,o)=>{var l=i.slice(0,1),u=i.slice(1),p={i:127,p:127,j:126,f:125,d:124};o.push(96),ji(u.length,o);for(var v=0;v<u.length;++v)o.push(p[u[v]]);l=="v"?o.push(0):o.push(1,p[l])},Iu=(i,o)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(bu(o),i);var l=[1];Au(o,l);var u=[0,97,115,109,1,0,0,0,1];ji(l.length,u),u.push.apply(u,l),u.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var p=new WebAssembly.Module(new Uint8Array(u)),v=new WebAssembly.Instance(p,{e:{f:i}}),E=v.exports.f;return E},Su=(i,o)=>{if(kt)for(var l=i;l<i+o;l++){var u=ae(l);u&&kt.set(u,l)}},kt=void 0,Cu=i=>(kt||(kt=new WeakMap,Su(0,ge.length)),kt.get(i)||0),ls=[],Nu=()=>{if(ls.length)return ls.pop();try{ge.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return ge.length-1},Bi=(i,o)=>{ge.set(i,o),br[i]=ge.get(i)},Ir=(i,o)=>{var l=Cu(i);if(l)return l;var u=Nu();try{Bi(u,i)}catch(v){if(!(v instanceof TypeError))throw v;var p=Iu(i,o);Bi(u,p)}return kt.set(i,u),u},Sr=i=>{kt.delete(ae(i)),ls.push(i)};Ti=r.InternalError=class extends Error{constructor(o){super(o),this.name="InternalError"}},Il(),cr=r.BindingError=class extends Error{constructor(o){super(o),this.name="BindingError"}},Hl(),kl(),tf(),Si=r.UnboundTypeError=af(Error,"UnboundTypeError"),ff(),hf();var Vi=function(i,o,l,u){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=y.nextInode++,this.name=o,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=u},pn=365,gn=146;Object.defineProperties(Vi.prototype,{read:{get:function(){return(this.mode&pn)===pn},set:function(i){i?this.mode|=pn:this.mode&=~pn}},write:{get:function(){return(this.mode&gn)===gn},set:function(i){i?this.mode|=gn:this.mode&=~gn}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Vi,y.createPreloadedFile=lu,y.staticInit();var Ou={C:yl,M:xl,a:El,k:wl,U:Ml,h:_l,pa:Rl,d:Tl,Ga:bl,ea:Al,ua:Cl,x:of,w:cf,i:lf,sa:df,Q:gf,t:mf,W:yf,o:xf,z:Ef,s:wf,V:_f,O:Nf,F:Of,Ha:Ff,va:Df,Ma:$f,Ba:Uf,Ja:Lf,Oa:ts,La:jf,Fa:zf,Na:Gf,Ka:Hf,H:qf,ba:Wf,ta:Xf,Pa:Yf,y:Kf,N:Jf,ra:Zf,qa:tu,la:uu,ma:hu,na:du,oa:gu,da:vu,T:xu,xa:uh,G:Wu,J:Uu,A:$u,E:Xu,aa:Hu,R:mh,r:ch,c:ku,b:Du,n:Vu,l:Bu,P:rh,D:ph,S:gh,L:vh,ca:_h,j:qu,f:Pu,Da:Qu,g:Lu,za:lh,I:Zu,$:Ku,Ea:Ju,u:eh,ya:fh,Aa:th,e:Fu,X:dh,Ia:zu,m:ju,p:Yu,wa:hh,_:sh,B:nh,v:ah,Y:oh,q:Gu,K:yh,Z:ih,ha:Eh,ja:xh,ia:Th,fa:Mh,ga:wh,Ca:Tu,ka:Ru},_e=vl(),fs=i=>(fs=_e.Ta)(i),_t=i=>(_t=_e.Ua)(i),zi=i=>(zi=_e.Va)(i);r.__embind_initialize_bindings=()=>(r.__embind_initialize_bindings=_e.Wa)();var re=(i,o)=>(re=_e.Xa)(i,o),Cr=i=>(Cr=_e.Ya)(i),ne=()=>(ne=_e.Za)(),se=i=>(se=_e._a)(i),Gi=i=>(Gi=_e.$a)(i),Hi=i=>(Hi=_e.ab)(i),qi=(i,o,l)=>(qi=_e.bb)(i,o,l),Wi=i=>(Wi=_e.cb)(i),Xi=r.dynCall_viiji=(i,o,l,u,p,v)=>(Xi=r.dynCall_viiji=_e.db)(i,o,l,u,p,v),Yi=r.dynCall_viijii=(i,o,l,u,p,v,E)=>(Yi=r.dynCall_viijii=_e.eb)(i,o,l,u,p,v,E),Ki=r.dynCall_viiij=(i,o,l,u,p,v)=>(Ki=r.dynCall_viiij=_e.fb)(i,o,l,u,p,v),Ji=r.dynCall_vijiii=(i,o,l,u,p,v,E)=>(Ji=r.dynCall_vijiii=_e.gb)(i,o,l,u,p,v,E),Zi=r.dynCall_vijii=(i,o,l,u,p,v)=>(Zi=r.dynCall_vijii=_e.hb)(i,o,l,u,p,v);r.dynCall_jiji=(i,o,l,u,p)=>(r.dynCall_jiji=_e.ib)(i,o,l,u,p);var Qi=r.dynCall_jiiii=(i,o,l,u,p)=>(Qi=r.dynCall_jiiii=_e.jb)(i,o,l,u,p);r.dynCall_iiiiij=(i,o,l,u,p,v,E)=>(r.dynCall_iiiiij=_e.kb)(i,o,l,u,p,v,E),r.dynCall_iiiiijj=(i,o,l,u,p,v,E,R,F)=>(r.dynCall_iiiiijj=_e.lb)(i,o,l,u,p,v,E,R,F),r.dynCall_iiiiiijj=(i,o,l,u,p,v,E,R,F,D)=>(r.dynCall_iiiiiijj=_e.mb)(i,o,l,u,p,v,E,R,F,D);function Fu(i,o,l,u){var p=ne();try{ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function Du(i,o,l){var u=ne();try{return ae(i)(o,l)}catch(p){if(se(u),p!==p+0)throw p;re(1,0)}}function $u(i,o,l,u,p,v){var E=ne();try{return ae(i)(o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function Pu(i,o){var l=ne();try{ae(i)(o)}catch(u){if(se(l),u!==u+0)throw u;re(1,0)}}function ku(i,o){var l=ne();try{return ae(i)(o)}catch(u){if(se(l),u!==u+0)throw u;re(1,0)}}function Uu(i,o,l,u){var p=ne();try{return ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function Lu(i,o,l){var u=ne();try{ae(i)(o,l)}catch(p){if(se(u),p!==p+0)throw p;re(1,0)}}function ju(i,o,l,u,p){var v=ne();try{ae(i)(o,l,u,p)}catch(E){if(se(v),E!==E+0)throw E;re(1,0)}}function Bu(i,o,l,u,p){var v=ne();try{return ae(i)(o,l,u,p)}catch(E){if(se(v),E!==E+0)throw E;re(1,0)}}function Vu(i,o,l,u){var p=ne();try{return ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function zu(i,o,l,u,p,v,E){var R=ne();try{ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function Gu(i,o,l,u,p,v,E,R,F,D,z){var Y=ne();try{ae(i)(o,l,u,p,v,E,R,F,D,z)}catch(q){if(se(Y),q!==q+0)throw q;re(1,0)}}function Hu(i,o,l){var u=ne();try{return ae(i)(o,l)}catch(p){if(se(u),p!==p+0)throw p;re(1,0)}}function qu(i){var o=ne();try{ae(i)()}catch(l){if(se(o),l!==l+0)throw l;re(1,0)}}function Wu(i,o,l){var u=ne();try{return ae(i)(o,l)}catch(p){if(se(u),p!==p+0)throw p;re(1,0)}}function Xu(i,o){var l=ne();try{return ae(i)(o)}catch(u){if(se(l),u!==u+0)throw u;re(1,0)}}function Yu(i,o,l,u,p,v){var E=ne();try{ae(i)(o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function Ku(i,o,l,u,p){var v=ne();try{ae(i)(o,l,u,p)}catch(E){if(se(v),E!==E+0)throw E;re(1,0)}}function Ju(i,o,l,u,p,v,E,R,F){var D=ne();try{ae(i)(o,l,u,p,v,E,R,F)}catch(z){if(se(D),z!==z+0)throw z;re(1,0)}}function Zu(i,o,l,u,p,v){var E=ne();try{ae(i)(o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function Qu(i,o,l,u){var p=ne();try{ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function eh(i,o,l,u){var p=ne();try{ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function th(i,o,l,u,p,v,E){var R=ne();try{ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function rh(i,o,l,u,p,v){var E=ne();try{return ae(i)(o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function nh(i,o,l,u,p,v,E){var R=ne();try{ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function sh(i,o,l,u,p,v,E){var R=ne();try{ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function ih(i,o,l,u,p,v,E,R,F,D,z,Y,q,W,Z,he,me,C,I){var $=ne();try{ae(i)(o,l,u,p,v,E,R,F,D,z,Y,q,W,Z,he,me,C,I)}catch(j){if(se($),j!==j+0)throw j;re(1,0)}}function ah(i,o,l,u,p,v,E,R){var F=ne();try{ae(i)(o,l,u,p,v,E,R)}catch(D){if(se(F),D!==D+0)throw D;re(1,0)}}function oh(i,o,l,u,p,v,E,R,F,D){var z=ne();try{ae(i)(o,l,u,p,v,E,R,F,D)}catch(Y){if(se(z),Y!==Y+0)throw Y;re(1,0)}}function ch(i){var o=ne();try{return ae(i)()}catch(l){if(se(o),l!==l+0)throw l;re(1,0)}}function lh(i,o,l,u){var p=ne();try{ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function fh(i,o,l,u,p,v){var E=ne();try{ae(i)(o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function uh(i){var o=ne();try{return ae(i)()}catch(l){if(se(o),l!==l+0)throw l;re(1,0)}}function hh(i,o,l,u,p,v,E){var R=ne();try{ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function dh(i,o,l,u,p){var v=ne();try{ae(i)(o,l,u,p)}catch(E){if(se(v),E!==E+0)throw E;re(1,0)}}function ph(i,o,l,u,p,v,E){var R=ne();try{return ae(i)(o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function gh(i,o,l,u,p,v,E,R){var F=ne();try{return ae(i)(o,l,u,p,v,E,R)}catch(D){if(se(F),D!==D+0)throw D;re(1,0)}}function mh(i,o,l,u){var p=ne();try{return ae(i)(o,l,u)}catch(v){if(se(p),v!==v+0)throw v;re(1,0)}}function vh(i,o,l,u,p,v,E,R,F,D,z,Y){var q=ne();try{return ae(i)(o,l,u,p,v,E,R,F,D,z,Y)}catch(W){if(se(q),W!==W+0)throw W;re(1,0)}}function yh(i,o,l,u,p,v,E,R,F,D,z,Y,q,W,Z,he){var me=ne();try{ae(i)(o,l,u,p,v,E,R,F,D,z,Y,q,W,Z,he)}catch(C){if(se(me),C!==C+0)throw C;re(1,0)}}function xh(i,o,l,u,p,v){var E=ne();try{Xi(i,o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function Th(i,o,l,u,p,v,E){var R=ne();try{Yi(i,o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function Eh(i,o,l,u,p,v){var E=ne();try{Ki(i,o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function wh(i,o,l,u,p,v,E){var R=ne();try{Ji(i,o,l,u,p,v,E)}catch(F){if(se(R),F!==F+0)throw F;re(1,0)}}function Mh(i,o,l,u,p,v){var E=ne();try{Zi(i,o,l,u,p,v)}catch(R){if(se(E),R!==R+0)throw R;re(1,0)}}function _h(i,o,l,u,p){var v=ne();try{return Qi(i,o,l,u,p)}catch(E){if(se(v),E!==E+0)throw E;re(1,0)}}r.addFunction=Ir,r.removeFunction=Sr;var mn;Me=function i(){mn||ea(),mn||(Me=i)};function ea(){if(Je>0||(Re(),Je>0))return;function i(){mn||(mn=!0,r.calledRun=!0,!V&&(Ue(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),Ae()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return ea(),e.ready}})();const vt="EXT_mesh_manifold",Sa="MERGE";class pi extends $e{static EXTENSION_NAME=vt;init(){pi.EXTENSION_NAME=vt,this.propertyType="ManifoldPrimitive",this.parentTypes=[X.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class al extends Se{extensionName=vt;prewriteTypes=[X.ACCESSOR];static EXTENSION_NAME=vt;createManifoldPrimitive(){return new pi(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[vt])return;const c=e.meshes[a],f=this.createManifoldPrimitive();c.setExtension(vt,f);const h=s.extensions[vt];if(h.manifoldPrimitive){let d=0;const g=[];g.push(d);for(const x of c.listPrimitives()){const w=x.getIndices();if(!w){console.log("Skipping non-indexed primitive ",x.getName());continue}d+=w.getCount(),g.push(d)}f.setRunIndex(g),f.setIndices(e.accessors[h.manifoldPrimitive.indices])}h.mergeIndices!=null&&h.mergeValues!=null&&f.setMerge(e.accessors[h.mergeIndices],e.accessors[h.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(vt);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,ut.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const a=n.getMergeIndices(),c=n.getMergeValues();!a||!c||(e.addAccessorToUsageGroup(a,Sa),e.addAccessorToUsageGroup(c,Sa))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(vt);if(!s)return;const a=e.meshIndexMap.get(n),c=r.meshes[a],f=s.getRunIndex(),h=f.length-1;if(h!==c.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const d=e.accessorIndexMap.get(s.getMergeIndices()),g=e.accessorIndexMap.get(s.getMergeValues()),x=r.accessors[d],w=r.accessors[g],M=c.primitives[0],A={indices:e.accessorIndexMap.get(s.getIndices()),mode:M.mode,attributes:{POSITION:M.attributes.POSITION}},N=r.accessors[A.indices];if(N){x&&w&&(N.sparse={count:x.count,indices:{bufferView:x.bufferView,byteOffset:x.byteOffset,componentType:x.componentType},values:{bufferView:w.bufferView,byteOffset:w.byteOffset}});for(let m=0;m<h;++m){const S=r.accessors[c.primitives[m].indices];S.bufferView=N.bufferView,S.byteOffset=N.byteOffset+4*f[m],S.count=f[m+1]-f[m]}c.extensions=c.extensions||{},c.extensions[vt]={manifoldPrimitive:A,mergeIndices:d,mergeValues:g}}}),this}}const Dr={POSITION:{type:te.Type.VEC3,components:3},NORMAL:{type:te.Type.VEC3,components:3},TANGENT:{type:te.Type.VEC4,components:4},TEXCOORD_0:{type:te.Type.VEC2,components:2},TEXCOORD_1:{type:te.Type.VEC2,components:2},COLOR_0:{type:te.Type.VEC3,components:3},JOINTS_0:{type:te.Type.VEC4,components:4},WEIGHTS_0:{type:te.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function xv(t){return t.registerExtensions([al])}function Ca(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(al),a=t.createMesh(),c=[],f=[],h=new Map,d=e.runIndex.length-1;let g=-1;for(let _=0;_<d;++_){const b=e.runOriginalID[_];if(b==g)continue;g=b,c.push(e.runIndex[_]);const O=t.createAccessor("primitive indices of ID "+b).setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(1)),P=t.createPrimitive().setIndices(O),V=r.get(b);if(V){const{material:B,attributes:k}=V;if(k.length<1||k[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');P.setMaterial(B),h.set(P,k),V.attributes.forEach((G,H)=>{if(H>=f.length)f.push(G);else{const K=Dr[G].components,L=Dr[f[H]].components;if(K!=L)throw new Error("Attribute sizes do not correspond: "+G+" and "+f[H]);Dr[f[H]].type==null&&(f[H]=G)}})}else h.set(P,["POSITION"]);a.addPrimitive(P)}c.push(e.runIndex[d]);const x=e.numVert,w=e.numProp;let M=0;f.forEach((_,b)=>{const O=Dr[_];if(O==null)throw new Error(_+" is not a recognized attribute.");if(O.type==null){++M;return}const P=O.components;if(M+P>w)throw new Error("Too many attribute channels.");const V=new Float32Array(P*x);for(let k=0;k<x;++k)for(let G=0;G<P;++G){let H=e.vertProperties[w*k+M+G];_=="COLOR_0"&&(H=Math.max(0,Math.min(1,H))),V[P*k+G]=H}const B=t.createAccessor(_).setBuffer(n).setType(O.type).setArray(V);for(const k of a.listPrimitives()){const G=h.get(k);G.length>b&&Dr[G[b]].type!=null&&k.setAttribute(_,B)}M+=P});const A=s.createManifoldPrimitive();a.setExtension("EXT_mesh_manifold",A);const N=t.createAccessor("manifold indices").setBuffer(n).setType(te.Type.SCALAR).setArray(e.triVerts);A.setIndices(N),A.setRunIndex(c);const m=[...Array(e.numVert).keys()],S=[],T=[];if(e.mergeFromVert&&e.mergeToVert){for(const[_,b]of e.mergeFromVert.entries())m[b]=e.mergeToVert[_];for(const[_,b]of e.triVerts.entries()){const O=m[b];b!==O&&(S.push(_),T.push(O))}}if(S.length>0){const _=t.createAccessor("merge from").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(S)),b=t.createAccessor("merge to").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(T));A.setMerge(_,b)}return a}const Qe=await yv();Qe.setup();Xo(Array);const ol=xv(new Xh);ol.registerExtensions(ko);const Tv=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],Ev=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","refine","setProperties","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],wv=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],Mv=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],cl=["show","only","setMaterial"],_v=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","Mesh","GLTFNode","Manifold","CrossSection","setMorphStart","setMorphEnd"],Na=cl.concat(_v),$n=new Array;function zn(t,e,r){const n=Qe[t],s=r?n:n.prototype;for(const a of e){const c=s[a];s[a]=function(...f){const h=c(...f);return $n.push(h),h}}}zn("Manifold",Ev,!1);zn("Manifold",Tv,!0);zn("CrossSection",Mv,!1);zn("CrossSection",wv,!0);for(const t of cl){const e=Qe[t];Qe[t]=function(...r){const n=e(...r);return $n.push(n),n}}Qe.cleanup=function(){for(const t of $n)if(t instanceof Array)for(const e of t)e.delete();else t.delete();$n.length=0};let gi=!1;const Pn=new Map,mi=new Map,Rv=30,ll={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},bv={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},Av={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},Zt=new Array,kn=new Map,bn=new Map,tr=new Map,nr=new Map;let Kr=1,mr,qr,vs,An,Un;function Iv(){gi=!1,Pn.clear(),mi.clear(),Zt.length=0,kn.clear(),bn.clear(),tr.clear(),nr.clear(),Kr=1}class Sv{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Zt.push(this)}clone(e){const r={...this};return r._parent=e,Zt.push(r),r}get parent(){return this._parent}}Qe.GLTFNode=Sv;const Kt={...ll};Qe.setMaterial=(t,e)=>{const r=t.asOriginal();return kn.set(r.originalID(),e),r};Qe.setMorphStart=(t,e)=>{const r=nr.get(t);r!=null?r.start=e:nr.set(t,{start:e})};Qe.setMorphEnd=(t,e)=>{const r=nr.get(t);r!=null?r.end=e:nr.set(t,{end:e})};function fl(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}Qe.show=t=>fl(t,Pn);Qe.only=t=>(gi=!0,fl(t,mi));self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}function pr(...t){self.console&&self.console.log(...t)}self.onmessage=async t=>{const e=`const globalDefaults = {};
`+t.data+`
return exportModels(globalDefaults, typeof result === "undefined" ? undefined : result);
`;try{await new Function("exportModels","glMatrix","module",...Na,e)(kv,il,Qe,...Na.map(n=>Qe[n]))}catch(r){console.log(r.toString()),self.postMessage({objectURL:null})}finally{Qe.cleanup(),Iv()}};function ul(t){const{quat:e}=il,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function ys(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const a=qr.getCount(),c=e=="rotation"?4:3,f=new Float32Array(c*a);for(let x=0;x<a;++x){const w=x/(a-1),M=s(Kt.animationMode!=="ping-pong"?w:(1-Math.cos(w*2*Math.PI))/2);f.set(c===4?ul(M):M,c*x)}const h=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(f).setType(c===4?te.Type.VEC4:te.Type.VEC3),d=t.createAnimationSampler().setInput(qr).setOutput(h).setInterpolation("LINEAR"),g=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(d);return mr.addSampler(d),mr.addChannel(g),Un=!0,s(0)}function Cv(t,e,r){if(nr.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(An);mr.addChannel(n),Un=!0}}function Nv(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,a=n*t.numProp,c=r.slice(a,a+3);e.start(c);for(let f=0;f<3;++f)s[a+f]=c[f]}return r}function Ov(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((a,c)=>{if(s.end)for(let w=0;w<e.numVert;++w){const M=n.slice(3*w,3*(w+1));s.end(M),n.splice(3*w,3,...M)}const f=a.getAttribute("POSITION").getArray(),h=new Float32Array(f.length),d=e.runIndex[c];for(let w=0;w<h.length;++w)h[w]=n[d+w]-f[w];const g=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(h).setType(te.Type.VEC3),x=t.createPrimitiveTarget().setAttribute("POSITION",g);a.addTarget(x)}))}function Fv(t,e){const r=t.createNode(e.name),n=ys(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=ys(t,"rotation",e,r);s!=null&&r.setRotation(ul(s));const a=ys(t,"scale",e,r);return a!=null&&r.setScale(a),r}function hl(t){return t==null?{}:(t.material==null&&(t.material=hl(t.parent)),t.material)}function Dv(t,e={}){const r={...Kt};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:a,alpha:c,unlit:f}=r,h=t.createMaterial(e.name??"");if(f){const d=t.createExtension(ti).createUnlit();h.setExtension("KHR_materials_unlit",d)}return c<1&&h.setAlphaMode(Tr.AlphaMode.BLEND).setDoubleSided(!0),h.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...a,c])}function Ln(t,e){return bn.has(e)||bn.set(e,Dv(t,e)),bn.get(e)}function dl(t,e,r,n,s={}){const a=n.numTri();if(a==0){pr("Empty manifold, skipping.");return}pr(`Triangles: ${a.toLocaleString()}`);const c=n.boundingBox(),f=[0,0,0];for(let N=0;N<3;N++)f[N]=Math.round((c.max[N]-c.min[N])*10)/10;pr(`Bounding Box: X = ${f[0].toLocaleString()} mm, Y = ${f[1].toLocaleString()} mm, Z = ${f[2].toLocaleString()} mm`);const h=Math.round(n.getProperties().volume/10);pr(`Genus: ${n.genus().toLocaleString()}, Volume: ${(h/100).toLocaleString()} cm^3`);const d=n.getMesh(),g=new Map;for(const N of d.runOriginalID){const m=kn.get(N)||s;g.set(N,{material:Ln(t,gi?Av:m),attributes:["POSITION",...m.attributes??[]]})}const x=nr.get(n),w=Nv(d,x),M=Ca(t,d,g);M.setName(r.getName()),r.setMesh(M),Ov(t,d,M,w,x);const A=d.numProp===3?d.vertProperties:new Float32Array(d.numVert*3);if(d.numProp>3)for(let N=0;N<d.numVert;++N)for(let m=0;m<3;++m)A[N*3+m]=d.vertProperties[N*d.numProp+m];tr.set(n,Kr),e.meshes.push({vertices:A,indices:d.triVerts,id:`${Kr++}`});for(const[N,m]of d.runOriginalID.entries()){const S=Pn.has(m),T=S?Pn.get(m):mi.get(m);if(T==null)continue;g.get(m).material=Ln(t,S?bv:kn.get(m)||s);const _=t.createNode("debug").setMesh(Ca(t,T,g)).setMatrix(d.transform(N));r.addChild(_)}}function pl(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function $v(t,e,r,n,s){pl(e,r);const a=t.createMesh();e.setMesh(a),r.getMesh().listPrimitives().forEach(c=>{const f=c.clone();c.getMaterial()===s&&f.setMaterial(n),a.addPrimitive(f)})}function Pv(t,e,r,n){const s=Fv(t,r),{manifold:a}=r;if(a!=null){Cv(t,s,a);const c=hl(r),f=n.get(a);if(f==null){dl(t,e,s,a,c);const h=new Map;h.set(c,s),n.set(a,h)}else{const h=f.get(c);if(h==null){const[d,g]=f.entries().next().value;$v(t,s,g,Ln(t,c),Ln(t,d)),f.set(c,s)}else pl(s,h)}}return tr.set(r,Kr),e.components.push({id:`${Kr++}`,name:r.name,children:a==null?[]:[{objectID:`${tr.get(a)}`}]}),s}async function kv(t,e){Object.assign(Kt,ll),Object.assign(Kt,t);const r=new js,n=Math.sqrt(2)/2,s=1/1e3,a=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(a),mr=r.createAnimation(""),Un=!1;const c=Math.round(Kt.animationLength*Rv)+1,f=new Float32Array(c),h=new Float32Array(c);for(let S=0;S<c;++S){const T=S/(c-1);f[S]=T*Kt.animationLength,h[S]=Kt.animationMode!=="ping-pong"?T:(1-Math.cos(T*2*Math.PI))/2}qr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(f).setType(te.Type.SCALAR),vs=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(h).setType(te.Type.SCALAR),An=r.createAnimationSampler().setInput(qr).setOutput(vs).setInterpolation("LINEAR"),mr.addSampler(An);const d={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Zt.length>0){const S=new Map,T=new Map;let _=0;for(const b of Zt)S.set(b,Pv(r,d,b,T)),b.manifold&&++_;for(const b of Zt){const O=S.get(b),P={objectID:`${tr.get(b)}`,transform:O.getMatrix()},{parent:V}=b;V==null?(a.addChild(O),d.items.push(P)):(S.get(V).addChild(O),d.components.find(k=>k.id==`${tr.get(V)}`).children.push(P))}pr("Total glTF nodes: ",Zt.length,", Total mesh references: ",_)}else{if(e==null){pr('No output because "result" is undefined and no "GLTFNode"s were created.');return}const S=r.createNode();dl(r,d,S,e),a.addChild(S),d.items.push({objectID:`${tr.get(e)}`})}Un||(qr.dispose(),vs.dispose(),An.dispose(),mr.dispose());const g=await ol.writeBinary(r),x=new Blob([g],{type:"application/octet-stream"}),w=new Hd;w.add3dModel("3D/3dmodel.model");const M=Gd(d),A={};A["3D/3dmodel.model"]=Hr(M),A[wa.name]=Hr(wa.content),A[w.name]=Hr(w.content);const N=ap(A),m=new Blob([N],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"});self.postMessage({glbURL:URL.createObjectURL(x),threeMFURL:URL.createObjectURL(m)})}
